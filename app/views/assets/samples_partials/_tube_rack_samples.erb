<section id="samples-table" class='info-panel'>
  <header>
    <a href='#plate-samples-table-collapser' role="button" data-toggle='collapse'>
    <h3>Samples
      <%= counter_badge @asset.contained_samples.count %>
      <small class='show-hide'>Click to toggle</small>
    </h3>
    </a>
  </header>
  <div id="plate-samples-table-collapser" class="collapse in show">
    <table id="plate-samples-table" class="sortable">
      <colgroup>
        <col class="npg_aliquot_index">
      </colgroup>
      <thead>
        <tr>
          <th class="tube_location">Well</th>
          <th>Sample Name</th>
          <th>Sanger Sample Id</th>
          <th>Tag</th>
          <th>Tag2</th>
        </tr>
      </thead>
      <tbody>
        <% @asset.tubes.in_column_major_order.includes({ aliquots: [:tag, :tag2, :sample] }).each do |tube| %>
          <% tube.aliquots.each do |aliquot,i| %>
            <tr>
              <td><%= link_to tube.coordinate, receptacle_path(tube) %></td>
              <td><strong><%= link_to aliquot.sample.name, aliquot.sample -%></strong></td>
              <td><%= aliquot.sample.sanger_sample_id %></td>
              <td><%= render partial: 'shared/tag_info', locals: {tag: aliquot.tag } if aliquot.tag.present? %></td>
              <td><%= render partial: 'shared/tag_info', locals: {tag: aliquot.tag2 } if aliquot.tag2.present? %></td>
            </tr>
          <% end %>
          <% if tube.aliquots.empty? %>
            <tr class="empty-tube">
              <td><%= link_to tube.coordinate, receptacle_path(tube) %></td>
              <td>[Empty]</td>
              <td></td>
              <td></td>
              <td></td>
            </tr>
          <% end %>
        <% end %>
      </tbody>
    </table>
  </div>
</section>

