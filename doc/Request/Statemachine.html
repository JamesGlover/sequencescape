<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: Request::Statemachine
  
    &mdash; Documentation by YARD 0.9.5
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "Request::Statemachine";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../class_list.html"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (S)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../Request.html" title="Request (class)">Request</a></span></span>
     &raquo; 
    <span class="title">Statemachine</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <iframe id="search_frame" src="../class_list.html"></iframe>

      <div id="content"><h1>Module: Request::Statemachine
  
  
  
</h1>
<div class="box_info">
  

  
  
  
  
  

  
  <dl>
    <dt>Included in:</dt>
    <dd><span class='object_link'><a href="../Request.html" title="Request (class)">Request</a></span></dd>
  </dl>
  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>app/models/request/statemachine.rb</dd>
  </dl>
  
</div>

<h2>Defined Under Namespace</h2>
<p class="children">
  
    
      <strong class="modules">Modules:</strong> <span class='object_link'><a href="Statemachine/ClassMethods.html" title="Request::Statemachine::ClassMethods (module)">ClassMethods</a></span>
    
  
    
  
</p>

  <h2>Constant Summary</h2>
  <dl class="constants">
    
      <dt id="COMPLETED_STATE-constant" class="">COMPLETED_STATE =
        
      </dt>
      <dd><pre class="code"><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>passed</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>failed</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span></pre></dd>
    
      <dt id="OPENED_STATE-constant" class="">OPENED_STATE =
        
      </dt>
      <dd><pre class="code"><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>pending</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>blocked</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>started</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span></pre></dd>
    
      <dt id="ACTIVE-constant" class="">ACTIVE =
        
      </dt>
      <dd><pre class="code"><span class='const'>QUOTA_COUNTED</span> <span class='op'>=</span> <span class='qwords_beg'>%w(</span><span class='tstring_content'>passed</span><span class='words_sep'> </span><span class='tstring_content'>pending</span><span class='words_sep'> </span><span class='tstring_content'>blocked</span><span class='words_sep'> </span><span class='tstring_content'>started</span><span class='words_sep'>)</span></pre></dd>
    
      <dt id="INACTIVE-constant" class="">INACTIVE =
        
      </dt>
      <dd><pre class="code"><span class='const'>QUOTA_EXEMPTED</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>failed</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>cancelled</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span></pre></dd>
    
  </dl>







  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#included-class_method" title="included (class method)">.<strong>included</strong>(base)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#cancellable%3F-instance_method" title="#cancellable? (instance method)">#<strong>cancellable?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#change_decision%21-instance_method" title="#change_decision! (instance method)">#<strong>change_decision!</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#closed%3F-instance_method" title="#closed? (instance method)">#<strong>closed?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#failed_downstream%21-instance_method" title="#failed_downstream! (instance method)">#<strong>failed_downstream!</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#failed_upstream%21-instance_method" title="#failed_upstream! (instance method)">#<strong>failed_upstream!</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#finished%3F-instance_method" title="#finished? (instance method)">#<strong>finished?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_blocked-instance_method" title="#on_blocked (instance method)">#<strong>on_blocked</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_cancelled-instance_method" title="#on_cancelled (instance method)">#<strong>on_cancelled</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_failed-instance_method" title="#on_failed (instance method)">#<strong>on_failed</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_hold-instance_method" title="#on_hold (instance method)">#<strong>on_hold</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_passed-instance_method" title="#on_passed (instance method)">#<strong>on_passed</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_started-instance_method" title="#on_started (instance method)">#<strong>on_started</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>On starting a request the aliquots are copied from the source asset to the
target and updated with the project and study information from the request
itself.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#open%3F-instance_method" title="#open? (instance method)">#<strong>open?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#terminated%3F-instance_method" title="#terminated? (instance method)">#<strong>terminated?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#transfer_aliquots-instance_method" title="#transfer_aliquots (instance method)">#<strong>transfer_aliquots</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#transition_to-instance_method" title="#transition_to (instance method)">#<strong>transition_to</strong>(target_state)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  



  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="included-class_method">
  
    .<strong>included</strong>(base)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/request/statemachine.rb', line 49</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_extend'>extend</span> <span class='const'>ClassMethods</span>

    <span class='comment'>## State machine
</span>    <span class='id identifier rubyid_aasm'>aasm</span> <span class='label'>column:</span> <span class='symbol'>:state</span><span class='comma'>,</span> <span class='label'>whiny_persistence:</span> <span class='kw'>true</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_state'>state</span> <span class='symbol'>:pending</span><span class='comma'>,</span>   <span class='label'>initial:</span> <span class='kw'>true</span>
      <span class='id identifier rubyid_state'>state</span> <span class='symbol'>:started</span><span class='comma'>,</span>   <span class='label'>after_enter:</span> <span class='symbol'>:on_started</span>
      <span class='id identifier rubyid_state'>state</span> <span class='symbol'>:failed</span><span class='comma'>,</span>    <span class='label'>after_enter:</span> <span class='symbol'>:on_failed</span>
      <span class='id identifier rubyid_state'>state</span> <span class='symbol'>:passed</span><span class='comma'>,</span>    <span class='label'>after_enter:</span> <span class='symbol'>:on_passed</span>
      <span class='id identifier rubyid_state'>state</span> <span class='symbol'>:cancelled</span><span class='comma'>,</span> <span class='label'>after_enter:</span> <span class='symbol'>:on_cancelled</span>
      <span class='id identifier rubyid_state'>state</span> <span class='symbol'>:blocked</span><span class='comma'>,</span>   <span class='label'>after_enter:</span> <span class='symbol'>:on_blocked</span>
      <span class='id identifier rubyid_state'>state</span> <span class='symbol'>:hold</span><span class='comma'>,</span>      <span class='label'>after_enter:</span> <span class='symbol'>:on_hold</span>

      <span class='id identifier rubyid_event'>event</span> <span class='symbol'>:hold</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_transitions'>transitions</span> <span class='label'>to:</span> <span class='symbol'>:hold</span><span class='comma'>,</span> <span class='label'>from:</span> <span class='lbracket'>[</span><span class='symbol'>:pending</span><span class='rbracket'>]</span>
      <span class='kw'>end</span>

      <span class='comment'># State Machine events
</span>      <span class='id identifier rubyid_event'>event</span> <span class='symbol'>:start</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_transitions'>transitions</span> <span class='label'>to:</span> <span class='symbol'>:started</span><span class='comma'>,</span> <span class='label'>from:</span> <span class='lbracket'>[</span><span class='symbol'>:pending</span><span class='comma'>,</span> <span class='symbol'>:hold</span><span class='rbracket'>]</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_event'>event</span> <span class='symbol'>:pass</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_transitions'>transitions</span> <span class='label'>to:</span> <span class='symbol'>:passed</span><span class='comma'>,</span> <span class='label'>from:</span> <span class='lbracket'>[</span><span class='symbol'>:started</span><span class='rbracket'>]</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_event'>event</span> <span class='symbol'>:fail</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_transitions'>transitions</span> <span class='label'>to:</span> <span class='symbol'>:failed</span><span class='comma'>,</span> <span class='label'>from:</span> <span class='lbracket'>[</span><span class='symbol'>:started</span><span class='rbracket'>]</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_event'>event</span> <span class='symbol'>:retrospective_pass</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_transitions'>transitions</span> <span class='label'>to:</span> <span class='symbol'>:passed</span><span class='comma'>,</span> <span class='label'>from:</span> <span class='lbracket'>[</span><span class='symbol'>:failed</span><span class='rbracket'>]</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_event'>event</span> <span class='symbol'>:retrospective_fail</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_transitions'>transitions</span> <span class='label'>to:</span> <span class='symbol'>:failed</span><span class='comma'>,</span> <span class='label'>from:</span> <span class='lbracket'>[</span><span class='symbol'>:passed</span><span class='rbracket'>]</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_event'>event</span> <span class='symbol'>:block</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_transitions'>transitions</span> <span class='label'>to:</span> <span class='symbol'>:blocked</span><span class='comma'>,</span> <span class='label'>from:</span> <span class='lbracket'>[</span><span class='symbol'>:pending</span><span class='rbracket'>]</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_event'>event</span> <span class='symbol'>:unblock</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_transitions'>transitions</span> <span class='label'>to:</span> <span class='symbol'>:pending</span><span class='comma'>,</span> <span class='label'>from:</span> <span class='lbracket'>[</span><span class='symbol'>:blocked</span><span class='rbracket'>]</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_event'>event</span> <span class='symbol'>:detach</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_transitions'>transitions</span> <span class='label'>to:</span> <span class='symbol'>:pending</span><span class='comma'>,</span> <span class='label'>from:</span> <span class='lbracket'>[</span><span class='symbol'>:cancelled</span><span class='rbracket'>]</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_event'>event</span> <span class='symbol'>:reset</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_transitions'>transitions</span> <span class='label'>to:</span> <span class='symbol'>:pending</span><span class='comma'>,</span> <span class='label'>from:</span> <span class='lbracket'>[</span><span class='symbol'>:hold</span><span class='rbracket'>]</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_event'>event</span> <span class='symbol'>:cancel</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_transitions'>transitions</span> <span class='label'>to:</span> <span class='symbol'>:cancelled</span><span class='comma'>,</span> <span class='label'>from:</span> <span class='lbracket'>[</span><span class='symbol'>:started</span><span class='comma'>,</span> <span class='symbol'>:hold</span><span class='rbracket'>]</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_event'>event</span> <span class='symbol'>:return</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_transitions'>transitions</span> <span class='label'>to:</span> <span class='symbol'>:pending</span><span class='comma'>,</span> <span class='label'>from:</span> <span class='lbracket'>[</span><span class='symbol'>:failed</span><span class='comma'>,</span> <span class='symbol'>:passed</span><span class='rbracket'>]</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_event'>event</span> <span class='symbol'>:cancel_completed</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_transitions'>transitions</span> <span class='label'>to:</span> <span class='symbol'>:cancelled</span><span class='comma'>,</span> <span class='label'>from:</span> <span class='lbracket'>[</span><span class='symbol'>:failed</span><span class='comma'>,</span> <span class='symbol'>:passed</span><span class='rbracket'>]</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_event'>event</span> <span class='symbol'>:cancel_from_upstream</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_transitions'>transitions</span> <span class='label'>to:</span> <span class='symbol'>:cancelled</span><span class='comma'>,</span> <span class='label'>from:</span> <span class='lbracket'>[</span><span class='symbol'>:pending</span><span class='rbracket'>]</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_event'>event</span> <span class='symbol'>:cancel_before_started</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_transitions'>transitions</span> <span class='label'>to:</span> <span class='symbol'>:cancelled</span><span class='comma'>,</span> <span class='label'>from:</span> <span class='lbracket'>[</span><span class='symbol'>:pending</span><span class='comma'>,</span> <span class='symbol'>:hold</span><span class='rbracket'>]</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_event'>event</span> <span class='symbol'>:submission_cancelled</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_transitions'>transitions</span> <span class='label'>to:</span> <span class='symbol'>:cancelled</span><span class='comma'>,</span> <span class='label'>from:</span> <span class='lbracket'>[</span><span class='symbol'>:pending</span><span class='comma'>,</span> <span class='symbol'>:cancelled</span><span class='rbracket'>]</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_event'>event</span> <span class='symbol'>:fail_from_upstream</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_transitions'>transitions</span> <span class='label'>to:</span> <span class='symbol'>:cancelled</span><span class='comma'>,</span> <span class='label'>from:</span> <span class='lbracket'>[</span><span class='symbol'>:pending</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_transitions'>transitions</span> <span class='label'>to:</span> <span class='symbol'>:failed</span><span class='comma'>,</span>    <span class='label'>from:</span> <span class='lbracket'>[</span><span class='symbol'>:started</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_transitions'>transitions</span> <span class='label'>to:</span> <span class='symbol'>:failed</span><span class='comma'>,</span>    <span class='label'>from:</span> <span class='lbracket'>[</span><span class='symbol'>:passed</span><span class='rbracket'>]</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

   <span class='id identifier rubyid_scope'>scope</span> <span class='symbol'>:for_state</span><span class='comma'>,</span> <span class='tlambda'>-&gt;</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span> <span class='tlambeg'>{</span> <span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>state:</span> <span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span> <span class='rbrace'>}</span>

   <span class='id identifier rubyid_scope'>scope</span> <span class='symbol'>:completed</span><span class='comma'>,</span>        <span class='tlambda'>-&gt;</span> <span class='tlambeg'>{</span> <span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>state:</span> <span class='const'>COMPLETED_STATE</span><span class='rparen'>)</span> <span class='rbrace'>}</span>

   <span class='id identifier rubyid_scope'>scope</span> <span class='symbol'>:pipeline_pending</span><span class='comma'>,</span> <span class='tlambda'>-&gt;</span> <span class='tlambeg'>{</span> <span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>state:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pending</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='rbrace'>}</span> <span class='comment'>#  we don&#39;t want the blocked one here }
</span>   <span class='id identifier rubyid_scope'>scope</span> <span class='symbol'>:pending</span><span class='comma'>,</span>          <span class='tlambda'>-&gt;</span> <span class='tlambeg'>{</span> <span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>state:</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pending</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>blocked</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='rbrace'>}</span> <span class='comment'># block is a kind of substate of pending }
</span>
   <span class='id identifier rubyid_scope'>scope</span> <span class='symbol'>:started</span><span class='comma'>,</span>          <span class='tlambda'>-&gt;</span> <span class='tlambeg'>{</span> <span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>state:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>started</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='rbrace'>}</span>
   <span class='id identifier rubyid_scope'>scope</span> <span class='symbol'>:cancelled</span><span class='comma'>,</span>        <span class='tlambda'>-&gt;</span> <span class='tlambeg'>{</span> <span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>state:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cancelled</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='rbrace'>}</span>

   <span class='id identifier rubyid_scope'>scope</span> <span class='symbol'>:opened</span><span class='comma'>,</span>           <span class='tlambda'>-&gt;</span> <span class='tlambeg'>{</span> <span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>state:</span> <span class='const'>OPENED_STATE</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
   <span class='id identifier rubyid_scope'>scope</span> <span class='symbol'>:closed</span><span class='comma'>,</span>           <span class='tlambda'>-&gt;</span> <span class='tlambeg'>{</span> <span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>state:</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>passed</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>failed</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cancelled</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="cancellable?-instance_method">
  
    #<strong>cancellable?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


218
219
220</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/request/statemachine.rb', line 218</span>

<span class='kw'>def</span> <span class='id identifier rubyid_cancellable?'>cancellable?</span>
  <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pending</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cancelled</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="change_decision!-instance_method">
  
    #<strong>change_decision!</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>StandardError</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


171
172
173
174
175
176</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/request/statemachine.rb', line 171</span>

<span class='kw'>def</span> <span class='id identifier rubyid_change_decision!'>change_decision!</span>
  <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Change decision is being deprecated in favour of retrospective_pass and retrospective_fail!</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_retrospective_fail!'>retrospective_fail!</span> <span class='kw'>if</span> <span class='id identifier rubyid_passed?'>passed?</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_retrospective_pass!'>retrospective_pass!</span> <span class='kw'>if</span> <span class='id identifier rubyid_failed?'>failed?</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>StandardError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Can only use change decision on passed or failed requests</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="closed?-instance_method">
  
    #<strong>closed?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


210
211
212</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/request/statemachine.rb', line 210</span>

<span class='kw'>def</span> <span class='id identifier rubyid_closed?'>closed?</span>
  <span class='qwords_beg'>%w(</span><span class='tstring_content'>passed</span><span class='words_sep'> </span><span class='tstring_content'>failed</span><span class='words_sep'> </span><span class='tstring_content'>cancelled</span><span class='words_sep'> </span><span class='tstring_content'>aborted</span><span class='words_sep'>)</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="failed_downstream!-instance_method">
  
    #<strong>failed_downstream!</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


198
199
200</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/request/statemachine.rb', line 198</span>

<span class='kw'>def</span> <span class='id identifier rubyid_failed_downstream!'>failed_downstream!</span>
  <span class='comment'># Do nothing by default
</span><span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="failed_upstream!-instance_method">
  
    #<strong>failed_upstream!</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


194
195
196</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/request/statemachine.rb', line 194</span>

<span class='kw'>def</span> <span class='id identifier rubyid_failed_upstream!'>failed_upstream!</span>
  <span class='id identifier rubyid_fail_from_upstream!'>fail_from_upstream!</span> <span class='kw'>unless</span> <span class='id identifier rubyid_failed?'>failed?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="finished?-instance_method">
  
    #<strong>finished?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


202
203
204</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/request/statemachine.rb', line 202</span>

<span class='kw'>def</span> <span class='id identifier rubyid_finished?'>finished?</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_passed?'>passed?</span> <span class='op'>||</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failed?'>failed?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_blocked-instance_method">
  
    #<strong>on_blocked</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


188
189</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/request/statemachine.rb', line 188</span>

<span class='kw'>def</span> <span class='id identifier rubyid_on_blocked'>on_blocked</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_cancelled-instance_method">
  
    #<strong>on_cancelled</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


185
186</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/request/statemachine.rb', line 185</span>

<span class='kw'>def</span> <span class='id identifier rubyid_on_cancelled'>on_cancelled</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_failed-instance_method">
  
    #<strong>on_failed</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


179
180</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/request/statemachine.rb', line 179</span>

<span class='kw'>def</span> <span class='id identifier rubyid_on_failed'>on_failed</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_hold-instance_method">
  
    #<strong>on_hold</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


191
192</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/request/statemachine.rb', line 191</span>

<span class='kw'>def</span> <span class='id identifier rubyid_on_hold'>on_hold</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_passed-instance_method">
  
    #<strong>on_passed</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


182
183</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/request/statemachine.rb', line 182</span>

<span class='kw'>def</span> <span class='id identifier rubyid_on_passed'>on_passed</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_started-instance_method">
  
    #<strong>on_started</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>On starting a request the aliquots are copied from the source asset to the
target and updated with the project and study information from the request
itself.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


158
159
160</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/request/statemachine.rb', line 158</span>

<span class='kw'>def</span> <span class='id identifier rubyid_on_started'>on_started</span>
  <span class='id identifier rubyid_transfer_aliquots'>transfer_aliquots</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="open?-instance_method">
  
    #<strong>open?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


214
215
216</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/request/statemachine.rb', line 214</span>

<span class='kw'>def</span> <span class='id identifier rubyid_open?'>open?</span>
  <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pending</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>started</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="terminated?-instance_method">
  
    #<strong>terminated?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


206
207
208</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/request/statemachine.rb', line 206</span>

<span class='kw'>def</span> <span class='id identifier rubyid_terminated?'>terminated?</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failed?'>failed?</span> <span class='op'>||</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_cancelled?'>cancelled?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="transfer_aliquots-instance_method">
  
    #<strong>transfer_aliquots</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


162
163
164
165
166
167
168
169</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/request/statemachine.rb', line 162</span>

<span class='kw'>def</span> <span class='id identifier rubyid_transfer_aliquots'>transfer_aliquots</span>
  <span class='id identifier rubyid_target_asset'>target_asset</span><span class='period'>.</span><span class='id identifier rubyid_aliquots'>aliquots</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_asset'>asset</span><span class='period'>.</span><span class='id identifier rubyid_aliquots'>aliquots</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_aliquot'>aliquot</span><span class='op'>|</span>
    <span class='id identifier rubyid_aliquot'>aliquot</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span><span class='period'>.</span><span class='id identifier rubyid_tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_clone'>clone</span><span class='op'>|</span>
      <span class='id identifier rubyid_clone'>clone</span><span class='period'>.</span><span class='id identifier rubyid_study_id'>study_id</span>   <span class='op'>=</span> <span class='id identifier rubyid_initial_study_id'>initial_study_id</span>   <span class='op'>||</span> <span class='id identifier rubyid_aliquot'>aliquot</span><span class='period'>.</span><span class='id identifier rubyid_study_id'>study_id</span>
      <span class='id identifier rubyid_clone'>clone</span><span class='period'>.</span><span class='id identifier rubyid_project_id'>project_id</span> <span class='op'>=</span> <span class='id identifier rubyid_initial_project_id'>initial_project_id</span> <span class='op'>||</span> <span class='id identifier rubyid_aliquot'>aliquot</span><span class='period'>.</span><span class='id identifier rubyid_project_id'>project_id</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="transition_to-instance_method">
  
    #<strong>transition_to</strong>(target_state)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


222
223
224</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/request/statemachine.rb', line 222</span>

<span class='kw'>def</span> <span class='id identifier rubyid_transition_to'>transition_to</span><span class='lparen'>(</span><span class='id identifier rubyid_target_state'>target_state</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_suggested_transition_between'>suggested_transition_between</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_target_state'>target_state</span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Mon Dec 19 11:16:28 2016 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.5 (ruby-2.3.3).
</div>

    </div>
  </body>
</html>