<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: SequencingQcBatch
  
    &mdash; Documentation by YARD 0.9.5
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "SequencingQcBatch";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index (S)</a> &raquo;
    
    
    <span class="title">SequencingQcBatch</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <iframe id="search_frame" src="class_list.html"></iframe>

      <div id="content"><h1>Module: SequencingQcBatch
  
  
  
</h1>
<div class="box_info">
  

  
  
  
  
  

  
  <dl>
    <dt>Included in:</dt>
    <dd><span class='object_link'><a href="Batch.html" title="Batch (class)">Batch</a></span></dd>
  </dl>
  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/sequencing_qc_batch.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>This file is part of SEQUENCESCAPE is distributed under the terms of GNU
General Public License version 1 or later; Please refer to the LICENSE and
README files for information on licensing and authorship of this file.
Copyright (C) 2007-2011 Genome Research Ltd. Place to put Illumina QC code
to be refactored</p>


  </div>
</div>
<div class="tags">
  

</div>
  <h2>Constant Summary</h2>
  <dl class="constants">
    
      <dt id="VALID_QC_STATES-constant" class="">VALID_QC_STATES =
        <div class="docstring">
  <div class="discussion">
    
<p>NOTE: Be careful that the length of these do not exceed 25 characters,
otherwise you will have to alter the batches.qc_state field in the DB to
accommodate.  FYI, 25 characters is:</p>

<pre class="code ruby"><code class="ruby">&lt;-----------------------&gt;</code></pre>


  </div>
</div>
<div class="tags">
  

</div>
      </dt>
      <dd><pre class="code"><span class='qwords_beg'>%w(
</span><span class='tstring_content'>qc_pending</span><span class='words_sep'>
</span><span class='tstring_content'>qc_submitted</span><span class='words_sep'>
</span><span class='tstring_content'>qc_manual</span><span class='words_sep'>
</span><span class='tstring_content'>qc_manual_in_progress</span><span class='words_sep'>
</span><span class='tstring_content'>qc_completed</span><span class='words_sep'>
</span><span class='tstring_end'>)</span></span></pre></dd>
    
  </dl>







  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#adjacent_state_helper-class_method" title="adjacent_state_helper (class method)">.<strong>adjacent_state_helper</strong>(direction, offset, delimiter)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#included-class_method" title="included (class method)">.<strong>included</strong>(base)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#state_transition_helper-class_method" title="state_transition_helper (class method)">.<strong>state_transition_helper</strong>(name)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#formatted_batch_qc_details-instance_method" title="#formatted_batch_qc_details (instance method)">#<strong>formatted_batch_qc_details</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Format qc_info on batch for JSON.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#migrate_to_manual_qc%3F-instance_method" title="#migrate_to_manual_qc? (instance method)">#<strong>migrate_to_manual_qc?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Cron job specific checker.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#processing_in_manual_qc%3F-instance_method" title="#processing_in_manual_qc? (instance method)">#<strong>processing_in_manual_qc?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#qc_manual_in_progress-instance_method" title="#qc_manual_in_progress (instance method)">#<strong>qc_manual_in_progress</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#qc_pipeline_workflow_id-instance_method" title="#qc_pipeline_workflow_id (instance method)">#<strong>qc_pipeline_workflow_id</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#qc_previous_state%21-instance_method" title="#qc_previous_state! (instance method)">#<strong>qc_previous_state!</strong>(current_user)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#qc_ready_for_manual-instance_method" title="#qc_ready_for_manual (instance method)">#<strong>qc_ready_for_manual</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#qc_states-instance_method" title="#qc_states (instance method)">#<strong>qc_states</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns qc_states used.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#show_in_manual_qc%3F-instance_method" title="#show_in_manual_qc? (instance method)">#<strong>show_in_manual_qc?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>View based check to display batches with results.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#submit_to_qc_queue-instance_method" title="#submit_to_qc_queue (instance method)">#<strong>submit_to_qc_queue</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>POST /batches/submit_to_qc_queue/:id.xml.</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="adjacent_state_helper-class_method">
  
    .<strong>adjacent_state_helper</strong>(direction, offset, delimiter)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


72
73
74
75
76
77
78</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sequencing_qc_batch.rb', line 72</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_adjacent_state_helper'>adjacent_state_helper</span><span class='lparen'>(</span><span class='id identifier rubyid_direction'>direction</span><span class='comma'>,</span> <span class='id identifier rubyid_offset'>offset</span><span class='comma'>,</span> <span class='id identifier rubyid_delimiter'>delimiter</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='symbol'>:qc_</span><span class='embexpr_beg'>#{</span> <span class='id identifier rubyid_direction'>direction</span> <span class='embexpr_end'>}</span><span class='tstring_content'>_state</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>StandardError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Current QC state appears to be invalid: &#39;</span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_qc_state'>qc_state</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_qc_states'>qc_states</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_qc_state'>qc_state</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_qc_state'>qc_state</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>==</span> <span class='id identifier rubyid_qc_states'>qc_states</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='id identifier rubyid_delimiter'>delimiter</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_qc_states'>qc_states</span><span class='lbracket'>[</span><span class='id identifier rubyid_qc_states'>qc_states</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_qc_state'>qc_state</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='id identifier rubyid_offset'>offset</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="included-class_method">
  
    .<strong>included</strong>(base)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


18
19
20
21
22
23
24
25
26</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sequencing_qc_batch.rb', line 18</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_instance_eval'>instance_eval</span> <span class='kw'>do</span>
    <span class='comment'># TODO[xxx]: Isn&#39;t qc_state supposed to be initialised to &#39;qc_pending&#39; rather than blank?
</span>    <span class='id identifier rubyid_validates_inclusion_of'>validates_inclusion_of</span> <span class='symbol'>:qc_state</span><span class='comma'>,</span> <span class='label'>in:</span> <span class='const'>VALID_QC_STATES</span><span class='comma'>,</span> <span class='label'>allow_blank:</span> <span class='kw'>true</span>

    <span class='id identifier rubyid_belongs_to'>belongs_to</span> <span class='symbol'>:qc_pipeline</span><span class='comma'>,</span> <span class='label'>class_name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Pipeline</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_before_create'>before_create</span> <span class='symbol'>:qc_pipeline_update</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="state_transition_helper-class_method">
  
    .<strong>state_transition_helper</strong>(name)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


85
86
87
88
89
90</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sequencing_qc_batch.rb', line 85</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_state_transition_helper'>state_transition_helper</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
  <span class='comment'># TODO[xxx]: Really we should restrict the state transitions
</span>  <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='symbol'>:qc_</span><span class='embexpr_beg'>#{</span> <span class='id identifier rubyid_name'>name</span> <span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_update_attribute'>update_attribute</span><span class='lparen'>(</span><span class='symbol'>:qc_state</span><span class='comma'>,</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_qc_next_state'>qc_next_state</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_qc_next_state'>qc_next_state</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="formatted_batch_qc_details-instance_method">
  
    #<strong>formatted_batch_qc_details</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Format qc_info on batch for JSON</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sequencing_qc_batch.rb', line 159</span>

<span class='kw'>def</span> <span class='id identifier rubyid_formatted_batch_qc_details'>formatted_batch_qc_details</span>
  <span class='id identifier rubyid_batch'>batch</span> <span class='op'>=</span> <span class='kw'>self</span>
  <span class='id identifier rubyid_temp_variable'>temp_variable</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_excluding_descriptors'>excluding_descriptors</span> <span class='op'>=</span> <span class='qwords_beg'>%w(</span><span class='tstring_content'>location</span><span class='words_sep'> </span><span class='tstring_content'>item</span><span class='words_sep'> </span><span class='tstring_content'>batch</span><span class='words_sep'> </span><span class='tstring_content'>check</span><span class='words_sep'> </span><span class='tstring_content'>jobs</span><span class='words_sep'> </span><span class='tstring_content'>run_meta</span><span class='words_sep'> </span><span class='tstring_content'>check_key</span><span class='words_sep'>)</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_batch'>batch</span><span class='period'>.</span><span class='id identifier rubyid_requests'>requests</span>
    <span class='id identifier rubyid_batch'>batch</span><span class='period'>.</span><span class='id identifier rubyid_requests'>requests</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_item'>item</span><span class='op'>|</span>
      <span class='id identifier rubyid_temp_variable'>temp_variable</span><span class='lbracket'>[</span><span class='id identifier rubyid_item'>item</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_item'>item</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_batch'>batch</span><span class='period'>.</span><span class='id identifier rubyid_qc_pipeline'>qc_pipeline</span><span class='period'>.</span><span class='id identifier rubyid_previous_pipeline'>previous_pipeline</span>
        <span class='id identifier rubyid_batch'>batch</span><span class='period'>.</span><span class='id identifier rubyid_qc_pipeline'>qc_pipeline</span><span class='period'>.</span><span class='id identifier rubyid_previous_pipeline'>previous_pipeline</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='period'>.</span><span class='id identifier rubyid_tasks'>tasks</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_task'>task</span><span class='op'>|</span>
          <span class='id identifier rubyid_item'>item</span><span class='period'>.</span><span class='id identifier rubyid_lab_events'>lab_events</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>
            <span class='kw'>if</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_description'>description</span> <span class='op'>==</span> <span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
              <span class='id identifier rubyid_grouped_descriptors'>grouped_descriptors</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
              <span class='id identifier rubyid_grouped_descriptors'>grouped_descriptors</span><span class='lbracket'>[</span><span class='lparen'>(</span><span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
              <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_descriptors'>descriptors</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_descriptor'>descriptor</span><span class='op'>|</span>
                <span class='kw'>unless</span> <span class='id identifier rubyid_excluding_descriptors'>excluding_descriptors</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_descriptor'>descriptor</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
                  <span class='id identifier rubyid_grouped_descriptors'>grouped_descriptors</span><span class='lbracket'>[</span><span class='lparen'>(</span><span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='lparen'>(</span><span class='id identifier rubyid_descriptor'>descriptor</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_descriptor'>descriptor</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span>
                <span class='kw'>end</span>
              <span class='kw'>end</span>
              <span class='id identifier rubyid_temp_variable'>temp_variable</span><span class='lbracket'>[</span><span class='id identifier rubyid_item'>item</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>qc_data</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_grouped_descriptors'>grouped_descriptors</span>
            <span class='kw'>end</span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_batch'>batch</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>items</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_temp_variable'>temp_variable</span>
  <span class='id identifier rubyid_batch'>batch</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="migrate_to_manual_qc?-instance_method">
  
    #<strong>migrate_to_manual_qc?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Cron job specific checker</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


48
49
50
51
52
53
54
55</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sequencing_qc_batch.rb', line 48</span>

<span class='kw'>def</span> <span class='id identifier rubyid_migrate_to_manual_qc?'>migrate_to_manual_qc?</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_assets_qc_tasks_results'>assets_qc_tasks_results</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_answer'>answer</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_answer'>answer</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_answer'>answer</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="processing_in_manual_qc?-instance_method">
  
    #<strong>processing_in_manual_qc?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


97
98
99</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sequencing_qc_batch.rb', line 97</span>

<span class='kw'>def</span> <span class='id identifier rubyid_processing_in_manual_qc?'>processing_in_manual_qc?</span>
  <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>qc_manual_in_progress</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>qc_manual</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_qc_state'>qc_state</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="qc_manual_in_progress-instance_method">
  
    #<strong>qc_manual_in_progress</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


113
114
115
116</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sequencing_qc_batch.rb', line 113</span>

<span class='kw'>def</span> <span class='id identifier rubyid_qc_manual_in_progress'>qc_manual_in_progress</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_qc_state'>qc_state</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>qc_manual_in_progress</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="qc_pipeline_workflow_id-instance_method">
  
    #<strong>qc_pipeline_workflow_id</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


101
102
103
104</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sequencing_qc_batch.rb', line 101</span>

<span class='kw'>def</span> <span class='id identifier rubyid_qc_pipeline_workflow_id'>qc_pipeline_workflow_id</span>
  <span class='id identifier rubyid_pipeline'>pipeline</span> <span class='op'>=</span> <span class='const'>Pipeline</span><span class='period'>.</span><span class='id identifier rubyid_find_by!'>find_by!</span><span class='lparen'>(</span><span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>quality control</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>automated:</span> <span class='kw'>true</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_pipeline'>pipeline</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="qc_previous_state!-instance_method">
  
    #<strong>qc_previous_state!</strong>(current_user)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


62
63
64
65
66
67
68
69
70</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sequencing_qc_batch.rb', line 62</span>

<span class='kw'>def</span> <span class='id identifier rubyid_qc_previous_state!'>qc_previous_state!</span><span class='lparen'>(</span><span class='id identifier rubyid_current_user'>current_user</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_previous_state'>previous_state</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_qc_previous_state'>qc_previous_state</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_previous_state'>previous_state</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_lab_events'>lab_events</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='label'>description:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>QC Rollback</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>message:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Manual QC moved from </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_qc_state'>qc_state</span><span class='embexpr_end'>}</span><span class='tstring_content'> to </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_previous_state'>previous_state</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>user_id:</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_qc_state'>qc_state</span> <span class='op'>=</span> <span class='id identifier rubyid_previous_state'>previous_state</span>
  <span class='kw'>end</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>started</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="qc_ready_for_manual-instance_method">
  
    #<strong>qc_ready_for_manual</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


106
107
108
109
110
111</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sequencing_qc_batch.rb', line 106</span>

<span class='kw'>def</span> <span class='id identifier rubyid_qc_ready_for_manual'>qc_ready_for_manual</span>
  <span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>Base</span><span class='period'>.</span><span class='id identifier rubyid_transaction'>transaction</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_p'>p</span> <span class='op'>=</span> <span class='const'>Pipeline</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_qc_pipeline_id'>qc_pipeline_id</span><span class='rparen'>)</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_update_attributes!'>update_attributes!</span><span class='lparen'>(</span><span class='label'>qc_pipeline_id:</span> <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_next_pipeline_id'>next_pipeline_id</span><span class='comma'>,</span> <span class='label'>qc_state:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>qc_manual</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="qc_states-instance_method">
  
    #<strong>qc_states</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns qc_states used</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


58
59
60</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sequencing_qc_batch.rb', line 58</span>

<span class='kw'>def</span> <span class='id identifier rubyid_qc_states'>qc_states</span>
  <span class='const'>VALID_QC_STATES</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="show_in_manual_qc?-instance_method">
  
    #<strong>show_in_manual_qc?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>View based check to display batches with results</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


38
39
40
41
42
43
44
45</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sequencing_qc_batch.rb', line 38</span>

<span class='kw'>def</span> <span class='id identifier rubyid_show_in_manual_qc?'>show_in_manual_qc?</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_assets_qc_tasks_results'>assets_qc_tasks_results</span><span class='period'>.</span><span class='id identifier rubyid_uniq'>uniq</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;</span> <span class='int'>1</span>
    <span class='id identifier rubyid_answer'>answer</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_answer'>answer</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_answer'>answer</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="submit_to_qc_queue-instance_method">
  
    #<strong>submit_to_qc_queue</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>POST /batches/submit_to_qc_queue/:id.xml</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sequencing_qc_batch.rb', line 125</span>

<span class='kw'>def</span> <span class='id identifier rubyid_submit_to_qc_queue'>submit_to_qc_queue</span>
  <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Batch </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_content'> attempting to be added to QC queue. State is </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_qc_state'>qc_state</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='comment'># Get QC workflow and its tasks
</span>  <span class='id identifier rubyid_workflow'>workflow</span> <span class='op'>=</span> <span class='const'>LabInterface</span><span class='op'>::</span><span class='const'>Workflow</span><span class='period'>.</span><span class='id identifier rubyid_find_by_name'>find_by_name</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>quality control</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>include:</span> <span class='lbracket'>[</span><span class='symbol'>:tasks</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_tasks'>tasks</span>    <span class='op'>=</span> <span class='id identifier rubyid_workflow'>workflow</span><span class='period'>.</span><span class='id identifier rubyid_tasks'>tasks</span>
  <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_qc_state'>qc_state</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>qc_pending</span><span class='tstring_end'>&quot;</span></span>
    <span class='comment'># Submit requests for all tasks in the workflow
</span>    <span class='id identifier rubyid_tasks'>tasks</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_task'>task</span><span class='op'>|</span>
      <span class='comment'># Constructing the XML file to use in sending the request
</span>      <span class='id identifier rubyid_h_doc'>h_doc</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
      <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_batch_requests'>batch_requests</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_b_request'>b_request</span><span class='op'>|</span>
        <span class='id identifier rubyid_h_doc'>h_doc</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>lane_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_b_request'>b_request</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_b_request'>b_request</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_h_doc'>h_doc</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>task_id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
      <span class='id identifier rubyid_h_doc'>h_doc</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>batch</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
      <span class='id identifier rubyid_h_doc'>h_doc</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>keys</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
      <span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_descriptors'>descriptors</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
        <span class='id identifier rubyid_h_doc'>h_doc</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>keys</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='lparen'>(</span><span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_key'>key</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_doc'>doc</span> <span class='op'>=</span> <span class='id identifier rubyid_h_doc'>h_doc</span><span class='period'>.</span><span class='id identifier rubyid_to_xml'>to_xml</span><span class='lparen'>(</span><span class='label'>root:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>criteria</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>skip_types:</span> <span class='kw'>true</span><span class='rparen'>)</span>
      <span class='comment'># A *Hacky* solution to get the XML readable for Chainlink
</span>      <span class='id identifier rubyid_doc'>doc</span> <span class='op'>=</span> <span class='id identifier rubyid_doc'>doc</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_tr!'>tr!</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>_</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_gsub!'>gsub!</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>UTF_8</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>UTF-8</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
      <span class='comment'># logger.debug doc
</span>      <span class='comment'># Publishing the request to AMQ
</span>      <span class='id identifier rubyid_publish'>publish</span> <span class='symbol'>:qc_requests</span><span class='comma'>,</span> <span class='id identifier rubyid_doc'>doc</span>
    <span class='kw'>end</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_qc_submitted'>qc_submitted</span>
    <span class='kw'>return</span> <span class='kw'>true</span>
  <span class='kw'>else</span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Mon Dec 19 11:16:25 2016 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.5 (ruby-2.3.3).
</div>

    </div>
  </body>
</html>