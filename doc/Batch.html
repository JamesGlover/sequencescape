<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: Batch
  
    &mdash; Documentation by YARD 0.9.5
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "Batch";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index (B)</a> &raquo;
    
    
    <span class="title">Batch</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <iframe id="search_frame" src="class_list.html"></iframe>

      <div id="content"><h1>Class: Batch
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName"><span class='object_link'><a href="ActiveRecord/Base.html" title="ActiveRecord::Base (class)">ActiveRecord::Base</a></span></span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next"><span class='object_link'><a href="ActiveRecord/Base.html" title="ActiveRecord::Base (class)">ActiveRecord::Base</a></span></li>
          
            <li class="next">Batch</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  <dl>
      <dt>Extended by:</dt>
      <dd><span class='object_link'><a href="EventfulRecord.html" title="EventfulRecord (module)">EventfulRecord</a></span></dd>
  </dl>
  
  
  
  <dl>
      <dt>Includes:</dt>
      <dd>AASM, <span class='object_link'><a href="Api/BatchIO/Extensions.html" title="Api::BatchIO::Extensions (module)">Api::BatchIO::Extensions</a></span>, Api::Messages::FlowcellIO::Extensions, <span class='object_link'><a href="Batch/PipelineBehaviour.html" title="Batch::PipelineBehaviour (module)">PipelineBehaviour</a></span>, <span class='object_link'><a href="Batch/StateMachineBehaviour.html" title="Batch::StateMachineBehaviour (module)">StateMachineBehaviour</a></span>, <span class='object_link'><a href="Batch/TecanBehaviour.html" title="Batch::TecanBehaviour (module)">TecanBehaviour</a></span>, <span class='object_link'><a href="Commentable.html" title="Commentable (module)">Commentable</a></span>, ModelExtensions::Batch, <span class='object_link'><a href="SequencingQcBatch.html" title="SequencingQcBatch (module)">SequencingQcBatch</a></span>, <span class='object_link'><a href="StandardNamedScopes.html" title="StandardNamedScopes (module)">StandardNamedScopes</a></span>, <span class='object_link'><a href="Uuid/Uuidable.html" title="Uuid::Uuidable (module)">Uuid::Uuidable</a></span></dd>
  </dl>
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>app/models/batch.rb</dd>
  </dl>
  
</div>

<h2>Defined Under Namespace</h2>
<p class="children">
  
    
      <strong class="modules">Modules:</strong> <span class='object_link'><a href="Batch/PipelineBehaviour.html" title="Batch::PipelineBehaviour (module)">PipelineBehaviour</a></span>, <span class='object_link'><a href="Batch/RequestBehaviour.html" title="Batch::RequestBehaviour (module)">RequestBehaviour</a></span>, <span class='object_link'><a href="Batch/StateMachineBehaviour.html" title="Batch::StateMachineBehaviour (module)">StateMachineBehaviour</a></span>, <span class='object_link'><a href="Batch/TecanBehaviour.html" title="Batch::TecanBehaviour (module)">TecanBehaviour</a></span>
    
  
    
  
</p>

  <h2>Constant Summary</h2>
  <dl class="constants">
    
      <dt id="DEFAULT_VOLUME-constant" class="">DEFAULT_VOLUME =
        
      </dt>
      <dd><pre class="code"><span class='int'>13</span></pre></dd>
    
  </dl>



  
  
  <h3 class="inherited">Constants included
     from <span class='object_link'><a href="SequencingQcBatch.html" title="SequencingQcBatch (module)">SequencingQcBatch</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="SequencingQcBatch.html#VALID_QC_STATES-constant" title="SequencingQcBatch::VALID_QC_STATES (constant)">SequencingQcBatch::VALID_QC_STATES</a></span></p>





  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#find_from_barcode-class_method" title="find_from_barcode (class method)">.<strong>find_from_barcode</strong>(code)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#prefix-class_method" title="prefix (class method)">.<strong>prefix</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#valid_barcode%3F-class_method" title="valid_barcode? (class method)">.<strong>valid_barcode?</strong>(code)  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#add_control-instance_method" title="#add_control (instance method)">#<strong>add_control</strong>(control_name, control_count)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#all_requests_are_ready%3F-instance_method" title="#all_requests_are_ready? (instance method)">#<strong>all_requests_are_ready?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#assign_positions_to_requests%21-instance_method" title="#assign_positions_to_requests! (instance method)">#<strong>assign_positions_to_requests!</strong>(request_ids_in_position_order)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Sets the position of the requests in the batch to their index in the array.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#assigned_user-instance_method" title="#assigned_user (instance method)">#<strong>assigned_user</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#cluster_formation_requests_must_be_over_minimum-instance_method" title="#cluster_formation_requests_must_be_over_minimum (instance method)">#<strong>cluster_formation_requests_must_be_over_minimum</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#control-instance_method" title="#control (instance method)">#<strong>control</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#detach_request-instance_method" title="#detach_request (instance method)">#<strong>detach_request</strong>(request, current_user = nil)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Remove a request from the batch and reset it to a point where it can be put
back into the pending queue.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#display_tags%3F-instance_method" title="#display_tags? (instance method)">#<strong>display_tags?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#fail-instance_method" title="#fail (instance method)">#<strong>fail</strong>(reason, comment, ignore_requests = false)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Fail was removed from State Machine (as a state) to allow the addition of
qc_state column and features.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#fail_batch_items-instance_method" title="#fail_batch_items (instance method)">#<strong>fail_batch_items</strong>(requests, reason, comment, fail_but_charge = false)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Fail specific items on this batch.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#failed%3F-instance_method" title="#failed? (instance method)">#<strong>failed?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#first_output_plate-instance_method" title="#first_output_plate (instance method)">#<strong>first_output_plate</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#formatted_events-instance_method" title="#formatted_events (instance method)">#<strong>formatted_events</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns meaningful events excluding discriptors/descriptor_fields clutter.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#has_control%3F-instance_method" title="#has_control? (instance method)">#<strong>has_control?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#has_event-instance_method" title="#has_event (instance method)">#<strong>has_event</strong>(event_name)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Tests whether this Batch has any associated LabEvents.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#in_process%3F-instance_method" title="#in_process? (instance method)">#<strong>in_process?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Used in auto_batch view to disable the submit button if the batch was
already passed to Auto QC.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#input_group-instance_method" title="#input_group (instance method)">#<strong>input_group</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#input_group_sorted_by_map_id-instance_method" title="#input_group_sorted_by_map_id (instance method)">#<strong>input_group_sorted_by_map_id</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#input_plate_group-instance_method" title="#input_plate_group (instance method)">#<strong>input_plate_group</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#mpx_library_name-instance_method" title="#mpx_library_name (instance method)">#<strong>mpx_library_name</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#multiplexed_items_with_unique_library_ids-instance_method" title="#multiplexed_items_with_unique_library_ids (instance method)">#<strong>multiplexed_items_with_unique_library_ids</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#npg_set_state-instance_method" title="#npg_set_state (instance method)">#<strong>npg_set_state</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#output_group-instance_method" title="#output_group (instance method)">#<strong>output_group</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#output_group_by_holder-instance_method" title="#output_group_by_holder (instance method)">#<strong>output_group_by_holder</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#output_plate_group-instance_method" title="#output_plate_group (instance method)">#<strong>output_plate_group</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>This looks odd.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#output_plate_in_batch%3F-instance_method" title="#output_plate_in_batch? (instance method)">#<strong>output_plate_in_batch?</strong>(barcode)  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#output_plate_purpose-instance_method" title="#output_plate_purpose (instance method)">#<strong>output_plate_purpose</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>WARNING! This method is used in the sanger barcode gem.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#output_plate_role-instance_method" title="#output_plate_role (instance method)">#<strong>output_plate_role</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#output_plates-instance_method" title="#output_plates (instance method)">#<strong>output_plates</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#parent_of_purpose-instance_method" title="#parent_of_purpose (instance method)">#<strong>parent_of_purpose</strong>(name)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#plate_barcode-instance_method" title="#plate_barcode (instance method)">#<strong>plate_barcode</strong>(barcode)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#plate_group_barcodes-instance_method" title="#plate_group_barcodes (instance method)">#<strong>plate_group_barcodes</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#plate_ids_in_study-instance_method" title="#plate_ids_in_study (instance method)">#<strong>plate_ids_in_study</strong>(study)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#pulldown_batch_report-instance_method" title="#pulldown_batch_report (instance method)">#<strong>pulldown_batch_report</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#pulldown_report_headers-instance_method" title="#pulldown_report_headers (instance method)">#<strong>pulldown_report_headers</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#release_pending_requests-instance_method" title="#release_pending_requests (instance method)">#<strong>release_pending_requests</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#remove_link-instance_method" title="#remove_link (instance method)">#<strong>remove_link</strong>(request)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#remove_request_ids-instance_method" title="#remove_request_ids (instance method)">#<strong>remove_request_ids</strong>(request_ids, reason = nil, comment = nil)  &#x21d2; Object </a>
    

    
      (also: #recycle_request_ids)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Remove the request from the batch and remove asset information.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#request_count-instance_method" title="#request_count (instance method)">#<strong>request_count</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#requests_have_same_read_length-instance_method" title="#requests_have_same_read_length (instance method)">#<strong>requests_have_same_read_length</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#reset%21-instance_method" title="#reset! (instance method)">#<strong>reset!</strong>(current_user)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#return_request_to_inbox-instance_method" title="#return_request_to_inbox (instance method)">#<strong>return_request_to_inbox</strong>(request, current_user = nil)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#robot_verified%21-instance_method" title="#robot_verified! (instance method)">#<strong>robot_verified!</strong>(user_id)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#shift_item_positions-instance_method" title="#shift_item_positions (instance method)">#<strong>shift_item_positions</strong>(position, number)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#show_actions%3F-instance_method" title="#show_actions? (instance method)">#<strong>show_actions?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#show_fail_link%3F-instance_method" title="#show_fail_link? (instance method)">#<strong>show_fail_link?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#source_labware-instance_method" title="#source_labware (instance method)">#<strong>source_labware</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Source Labware returns the physical pieces of lawbare (ie. a plate for
wells, but stubes for tubes).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#space_left-instance_method" title="#space_left (instance method)">#<strong>space_left</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#start_requests-instance_method" title="#start_requests (instance method)">#<strong>start_requests</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#study-instance_method" title="#study (instance method)">#<strong>study</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#swap-instance_method" title="#swap (instance method)">#<strong>swap</strong>(current_user, batch_info = {})  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#total_volume_to_cherrypick-instance_method" title="#total_volume_to_cherrypick (instance method)">#<strong>total_volume_to_cherrypick</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#underrun-instance_method" title="#underrun (instance method)">#<strong>underrun</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_batch_state-instance_method" title="#update_batch_state (instance method)">#<strong>update_batch_state</strong>(reason, comment)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#verify_tube_layout-instance_method" title="#verify_tube_layout (instance method)">#<strong>verify_tube_layout</strong>(barcodes, user = nil)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="EventfulRecord.html" title="EventfulRecord (module)">EventfulRecord</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="EventfulRecord.html#has_many_events-instance_method" title="EventfulRecord#has_many_events (method)">has_many_events</a></span>, <span class='object_link'><a href="EventfulRecord.html#has_many_lab_events-instance_method" title="EventfulRecord#has_many_lab_events (method)">has_many_lab_events</a></span>, <span class='object_link'><a href="EventfulRecord.html#has_one_event_with_family-instance_method" title="EventfulRecord#has_one_event_with_family (method)">has_one_event_with_family</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Batch/TecanBehaviour.html" title="Batch::TecanBehaviour (module)">TecanBehaviour</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Batch/TecanBehaviour.html#generate_tecan_data-instance_method" title="Batch::TecanBehaviour#generate_tecan_data (method)">#generate_tecan_data</a></span>, <span class='object_link'><a href="Batch/TecanBehaviour.html#tecan_gwl_file-instance_method" title="Batch::TecanBehaviour#tecan_gwl_file (method)">#tecan_gwl_file</a></span>, <span class='object_link'><a href="Batch/TecanBehaviour.html#tecan_gwl_file_as_text-instance_method" title="Batch::TecanBehaviour#tecan_gwl_file_as_text (method)">#tecan_gwl_file_as_text</a></span>, <span class='object_link'><a href="Batch/TecanBehaviour.html#tecan_layout_plate_barcodes-instance_method" title="Batch::TecanBehaviour#tecan_layout_plate_barcodes (method)">#tecan_layout_plate_barcodes</a></span>, <span class='object_link'><a href="Batch/TecanBehaviour.html#validate_for_tecan-instance_method" title="Batch::TecanBehaviour#validate_for_tecan (method)">#validate_for_tecan</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Batch/StateMachineBehaviour.html" title="Batch::StateMachineBehaviour (module)">StateMachineBehaviour</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Batch/StateMachineBehaviour.html#complete_with_user%21-instance_method" title="Batch::StateMachineBehaviour#complete_with_user! (method)">#complete_with_user!</a></span>, <span class='object_link'><a href="Batch/StateMachineBehaviour.html#editable%3F-instance_method" title="Batch::StateMachineBehaviour#editable? (method)">#editable?</a></span>, <span class='object_link'><a href="Batch/StateMachineBehaviour.html#finished%3F-instance_method" title="Batch::StateMachineBehaviour#finished? (method)">#finished?</a></span>, <span class='object_link'><a href="Batch/StateMachineBehaviour.html#included-class_method" title="Batch::StateMachineBehaviour.included (method)">included</a></span>, <span class='object_link'><a href="Batch/StateMachineBehaviour.html#release_with_user%21-instance_method" title="Batch::StateMachineBehaviour#release_with_user! (method)">#release_with_user!</a></span>, <span class='object_link'><a href="Batch/StateMachineBehaviour.html#start_with_user%21-instance_method" title="Batch::StateMachineBehaviour#start_with_user! (method)">#start_with_user!</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Batch/PipelineBehaviour.html" title="Batch::PipelineBehaviour (module)">PipelineBehaviour</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Batch/PipelineBehaviour.html#complete_events-instance_method" title="Batch::PipelineBehaviour#complete_events (method)">#complete_events</a></span>, <span class='object_link'><a href="Batch/PipelineBehaviour.html#completed_task_ids-instance_method" title="Batch::PipelineBehaviour#completed_task_ids (method)">#completed_task_ids</a></span>, <span class='object_link'><a href="Batch/PipelineBehaviour.html#externally_released%3F-instance_method" title="Batch::PipelineBehaviour#externally_released? (method)">#externally_released?</a></span>, <span class='object_link'><a href="Batch/PipelineBehaviour.html#has_item_limit%3F-instance_method" title="Batch::PipelineBehaviour#has_item_limit? (method)">#has_item_limit?</a></span>, <span class='object_link'><a href="Batch/PipelineBehaviour.html#included-class_method" title="Batch::PipelineBehaviour.included (method)">included</a></span>, <span class='object_link'><a href="Batch/PipelineBehaviour.html#internally_released%3F-instance_method" title="Batch::PipelineBehaviour#internally_released? (method)">#internally_released?</a></span>, <span class='object_link'><a href="Batch/PipelineBehaviour.html#last_completed_task-instance_method" title="Batch::PipelineBehaviour#last_completed_task (method)">#last_completed_task</a></span>, <span class='object_link'><a href="Batch/PipelineBehaviour.html#task_for_event-instance_method" title="Batch::PipelineBehaviour#task_for_event (method)">#task_for_event</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="StandardNamedScopes.html" title="StandardNamedScopes (module)">StandardNamedScopes</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="StandardNamedScopes.html#included-class_method" title="StandardNamedScopes.included (method)">included</a></span></p>

  
  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Uuid/Uuidable.html" title="Uuid::Uuidable (module)">Uuid::Uuidable</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Uuid/Uuidable.html#included-class_method" title="Uuid::Uuidable.included (method)">included</a></span>, <span class='object_link'><a href="Uuid/Uuidable.html#unsaved_uuid%21-instance_method" title="Uuid::Uuidable#unsaved_uuid! (method)">#unsaved_uuid!</a></span>, <span class='object_link'><a href="Uuid/Uuidable.html#uuid-instance_method" title="Uuid::Uuidable#uuid (method)">#uuid</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Commentable.html" title="Commentable (module)">Commentable</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Commentable.html#included-class_method" title="Commentable.included (method)">included</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="SequencingQcBatch.html" title="SequencingQcBatch (module)">SequencingQcBatch</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="SequencingQcBatch.html#adjacent_state_helper-class_method" title="SequencingQcBatch.adjacent_state_helper (method)">adjacent_state_helper</a></span>, <span class='object_link'><a href="SequencingQcBatch.html#formatted_batch_qc_details-instance_method" title="SequencingQcBatch#formatted_batch_qc_details (method)">#formatted_batch_qc_details</a></span>, <span class='object_link'><a href="SequencingQcBatch.html#included-class_method" title="SequencingQcBatch.included (method)">included</a></span>, <span class='object_link'><a href="SequencingQcBatch.html#migrate_to_manual_qc%3F-instance_method" title="SequencingQcBatch#migrate_to_manual_qc? (method)">#migrate_to_manual_qc?</a></span>, <span class='object_link'><a href="SequencingQcBatch.html#processing_in_manual_qc%3F-instance_method" title="SequencingQcBatch#processing_in_manual_qc? (method)">#processing_in_manual_qc?</a></span>, <span class='object_link'><a href="SequencingQcBatch.html#qc_manual_in_progress-instance_method" title="SequencingQcBatch#qc_manual_in_progress (method)">#qc_manual_in_progress</a></span>, <span class='object_link'><a href="SequencingQcBatch.html#qc_pipeline_workflow_id-instance_method" title="SequencingQcBatch#qc_pipeline_workflow_id (method)">#qc_pipeline_workflow_id</a></span>, <span class='object_link'><a href="SequencingQcBatch.html#qc_previous_state%21-instance_method" title="SequencingQcBatch#qc_previous_state! (method)">#qc_previous_state!</a></span>, <span class='object_link'><a href="SequencingQcBatch.html#qc_ready_for_manual-instance_method" title="SequencingQcBatch#qc_ready_for_manual (method)">#qc_ready_for_manual</a></span>, <span class='object_link'><a href="SequencingQcBatch.html#qc_states-instance_method" title="SequencingQcBatch#qc_states (method)">#qc_states</a></span>, <span class='object_link'><a href="SequencingQcBatch.html#show_in_manual_qc%3F-instance_method" title="SequencingQcBatch#show_in_manual_qc? (method)">#show_in_manual_qc?</a></span>, <span class='object_link'><a href="SequencingQcBatch.html#state_transition_helper-class_method" title="SequencingQcBatch.state_transition_helper (method)">state_transition_helper</a></span>, <span class='object_link'><a href="SequencingQcBatch.html#submit_to_qc_queue-instance_method" title="SequencingQcBatch#submit_to_qc_queue (method)">#submit_to_qc_queue</a></span></p>

  
  
  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Api/BatchIO/Extensions.html" title="Api::BatchIO::Extensions (module)">Api::BatchIO::Extensions</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Api/BatchIO/Extensions.html#included-class_method" title="Api::BatchIO::Extensions.included (method)">included</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="ActiveRecord/Base.html" title="ActiveRecord::Base (class)">ActiveRecord::Base</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="ActiveRecord/Base.html#find_by_id_or_name-class_method" title="ActiveRecord::Base.find_by_id_or_name (method)">find_by_id_or_name</a></span>, <span class='object_link'><a href="ActiveRecord/Base.html#find_by_id_or_name%21-class_method" title="ActiveRecord::Base.find_by_id_or_name! (method)">find_by_id_or_name!</a></span>, <span class='object_link'><a href="ActiveRecord/Base.html#routing_key-instance_method" title="ActiveRecord::Base#routing_key (method)">#routing_key</a></span>, <span class='object_link'><a href="ActiveRecord/Base.html#transaction_with_amqp-class_method" title="ActiveRecord::Base.transaction_with_amqp (method)">transaction_with_amqp</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="ApiTools.html" title="ApiTools (module)">ApiTools</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="ApiTools.html#as_json-instance_method" title="ApiTools#as_json (method)">#as_json</a></span>, <span class='object_link'><a href="ApiTools.html#for_api-instance_method" title="ApiTools#for_api (method)">#for_api</a></span>, <span class='object_link'><a href="ApiTools.html#included-class_method" title="ApiTools.included (method)">included</a></span>, <span class='object_link'><a href="ApiTools.html#list_json-instance_method" title="ApiTools#list_json (method)">#list_json</a></span>, <span class='object_link'><a href="ApiTools.html#to_xml-instance_method" title="ApiTools#to_xml (method)">#to_xml</a></span>, <span class='object_link'><a href="ApiTools.html#to_yaml-instance_method" title="ApiTools#to_yaml (method)">#to_yaml</a></span>, <span class='object_link'><a href="ApiTools.html#url-instance_method" title="ApiTools#url (method)">#url</a></span>, <span class='object_link'><a href="ApiTools.html#url_name-instance_method" title="ApiTools#url_name (method)">#url_name</a></span></p>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="find_from_barcode-class_method">
  
    .<strong>find_from_barcode</strong>(code)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


482
483
484
485
486
487
488</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 482</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_find_from_barcode'>find_from_barcode</span><span class='lparen'>(</span><span class='id identifier rubyid_code'>code</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_human_batch_barcode'>human_batch_barcode</span> <span class='op'>=</span> <span class='const'>Barcode</span><span class='period'>.</span><span class='id identifier rubyid_number_to_human'>number_to_human</span><span class='lparen'>(</span><span class='id identifier rubyid_code'>code</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_batch'>batch</span> <span class='op'>=</span> <span class='const'>Batch</span><span class='period'>.</span><span class='id identifier rubyid_find_by_barcode'>find_by_barcode</span><span class='lparen'>(</span><span class='id identifier rubyid_human_batch_barcode'>human_batch_barcode</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_batch'>batch</span> <span class='op'>||=</span> <span class='const'>Batch</span><span class='period'>.</span><span class='id identifier rubyid_find_by_id'>find_by_id</span><span class='lparen'>(</span><span class='id identifier rubyid_human_batch_barcode'>human_batch_barcode</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_batch'>batch</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="prefix-class_method">
  
    .<strong>prefix</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


464
465
466</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 464</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_prefix'>prefix</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BA</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="valid_barcode?-class_method">
  
    .<strong>valid_barcode?</strong>(code)  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


468
469
470
471
472
473
474
475
476
477
478
479
480</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 468</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_valid_barcode?'>valid_barcode?</span><span class='lparen'>(</span><span class='id identifier rubyid_code'>code</span><span class='rparen'>)</span>
  <span class='kw'>begin</span>
    <span class='const'>Barcode</span><span class='period'>.</span><span class='id identifier rubyid_barcode_to_human!'>barcode_to_human!</span><span class='lparen'>(</span><span class='id identifier rubyid_code'>code</span><span class='comma'>,</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_prefix'>prefix</span><span class='rparen'>)</span>
  <span class='kw'>rescue</span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_find_from_barcode'>find_from_barcode</span><span class='lparen'>(</span><span class='id identifier rubyid_code'>code</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>end</span>

  <span class='kw'>true</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="add_control-instance_method">
  
    #<strong>add_control</strong>(control_name, control_count)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 432</span>

<span class='kw'>def</span> <span class='id identifier rubyid_add_control'>add_control</span><span class='lparen'>(</span><span class='id identifier rubyid_control_name'>control_name</span><span class='comma'>,</span> <span class='id identifier rubyid_control_count'>control_count</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_asset'>asset</span> <span class='op'>=</span> <span class='const'>Asset</span><span class='period'>.</span><span class='id identifier rubyid_find_by_name_and_resource'>find_by_name_and_resource</span><span class='lparen'>(</span><span class='id identifier rubyid_control_name'>control_name</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_control_count'>control_count</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_space_left'>space_left</span> <span class='kw'>if</span> <span class='id identifier rubyid_control_count'>control_count</span> <span class='op'>==</span> <span class='int'>0</span>

  <span class='id identifier rubyid_first_control'>first_control</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='int'>3</span><span class='comma'>,</span> <span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_item_limit'>item_limit</span> <span class='op'>-</span> <span class='id identifier rubyid_control_count'>control_count</span><span class='rparen'>)</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_min'>min</span>

  <span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>Base</span><span class='period'>.</span><span class='id identifier rubyid_transaction'>transaction</span> <span class='kw'>do</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_shift_item_positions'>shift_item_positions</span><span class='lparen'>(</span><span class='id identifier rubyid_first_control'>first_control</span> <span class='op'>+</span> <span class='int'>1</span><span class='comma'>,</span> <span class='id identifier rubyid_control_count'>control_count</span><span class='rparen'>)</span>
    <span class='lparen'>(</span><span class='int'>1</span><span class='op'>..</span><span class='id identifier rubyid_control_count'>control_count</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_index'>index</span><span class='op'>|</span>
      <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_batch_requests'>batch_requests</span><span class='period'>.</span><span class='id identifier rubyid_create!'>create!</span><span class='lparen'>(</span>
        <span class='label'>request:</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_pipeline'>pipeline</span><span class='period'>.</span><span class='id identifier rubyid_control_request_type'>control_request_type</span><span class='period'>.</span><span class='id identifier rubyid_create_control!'>create_control!</span><span class='lparen'>(</span><span class='label'>asset:</span> <span class='id identifier rubyid_asset'>asset</span><span class='comma'>,</span> <span class='label'>study_id:</span> <span class='int'>198</span><span class='rparen'>)</span><span class='comma'>,</span>
        <span class='label'>position:</span> <span class='id identifier rubyid_first_control'>first_control</span> <span class='op'>+</span> <span class='id identifier rubyid_index'>index</span>
      <span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_control_count'>control_count</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="all_requests_are_ready?-instance_method">
  
    #<strong>all_requests_are_ready?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


45
46
47
48
49
50</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 45</span>

<span class='kw'>def</span> <span class='id identifier rubyid_all_requests_are_ready?'>all_requests_are_ready?</span>
  <span class='comment'># Checks that SequencingRequests have at least one LibraryCreationRequest in passed status before being processed (as refered by #75102998)
</span>  <span class='kw'>unless</span> <span class='id identifier rubyid_requests'>requests</span><span class='period'>.</span><span class='id identifier rubyid_all?'>all?</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:ready?</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_errors'>errors</span><span class='period'>.</span><span class='id identifier rubyid_add'>add</span> <span class='symbol'>:base</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>All requests must be ready to be added to a batch</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="assign_positions_to_requests!-instance_method">
  
    #<strong>assign_positions_to_requests!</strong>(request_ids_in_position_order)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Sets the position of the requests in the batch to their index in the array.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>StandardError</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


174
175
176
177
178
179
180
181
182
183</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 174</span>

<span class='kw'>def</span> <span class='id identifier rubyid_assign_positions_to_requests!'>assign_positions_to_requests!</span><span class='lparen'>(</span><span class='id identifier rubyid_request_ids_in_position_order'>request_ids_in_position_order</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_disparate_ids'>disparate_ids</span> <span class='op'>=</span> <span class='id identifier rubyid_batch_requests'>batch_requests</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:request_id</span><span class='rparen'>)</span> <span class='op'>-</span> <span class='id identifier rubyid_request_ids_in_position_order'>request_ids_in_position_order</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>StandardError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Can only sort all requests at once</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_disparate_ids'>disparate_ids</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>

  <span class='const'>BatchRequest</span><span class='period'>.</span><span class='id identifier rubyid_transaction'>transaction</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_batch_requests'>batch_requests</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_batch_request'>batch_request</span><span class='op'>|</span>
      <span class='id identifier rubyid_batch_request'>batch_request</span><span class='period'>.</span><span class='id identifier rubyid_move_to_position!'>move_to_position!</span><span class='lparen'>(</span><span class='id identifier rubyid_request_ids_in_position_order'>request_ids_in_position_order</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_batch_request'>batch_request</span><span class='period'>.</span><span class='id identifier rubyid_request_id'>request_id</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='int'>1</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="assigned_user-instance_method">
  
    #<strong>assigned_user</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


198
199
200</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 198</span>

<span class='kw'>def</span> <span class='id identifier rubyid_assigned_user'>assigned_user</span>
  <span class='id identifier rubyid_assignee'>assignee</span><span class='period'>.</span><span class='id identifier rubyid_try'>try</span><span class='lparen'>(</span><span class='symbol'>:login</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="cluster_formation_requests_must_be_over_minimum-instance_method">
  
    #<strong>cluster_formation_requests_must_be_over_minimum</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


52
53
54
55
56</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 52</span>

<span class='kw'>def</span> <span class='id identifier rubyid_cluster_formation_requests_must_be_over_minimum'>cluster_formation_requests_must_be_over_minimum</span>
  <span class='kw'>if</span> <span class='lparen'>(</span><span class='op'>!</span><span class='id identifier rubyid_pipeline'>pipeline</span><span class='period'>.</span><span class='id identifier rubyid_min_size'>min_size</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='id identifier rubyid_requests'>requests</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_pipeline'>pipeline</span><span class='period'>.</span><span class='id identifier rubyid_min_size'>min_size</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_errors'>errors</span><span class='period'>.</span><span class='id identifier rubyid_add'>add</span> <span class='symbol'>:base</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>You must create batches of at least </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_pipeline'>pipeline</span><span class='period'>.</span><span class='id identifier rubyid_min_size'>min_size</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> requests in the pipeline </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_pipeline'>pipeline</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="control-instance_method">
  
    #<strong>control</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


165
166
167</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 165</span>

<span class='kw'>def</span> <span class='id identifier rubyid_control'>control</span>
  <span class='id identifier rubyid_requests'>requests</span><span class='period'>.</span><span class='id identifier rubyid_detect'>detect</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_request'>request</span><span class='op'>|</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_try'>try</span><span class='lparen'>(</span><span class='symbol'>:asset</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_try'>try</span><span class='lparen'>(</span><span class='symbol'>:resource?</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="detach_request-instance_method">
  
    #<strong>detach_request</strong>(request, current_user = nil)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Remove a request from the batch and reset it to a point where it can be put
back into the pending queue.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


352
353
354
355
356
357</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 352</span>

<span class='kw'>def</span> <span class='id identifier rubyid_detach_request'>detach_request</span><span class='lparen'>(</span><span class='id identifier rubyid_request'>request</span><span class='comma'>,</span> <span class='id identifier rubyid_current_user'>current_user</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>Base</span><span class='period'>.</span><span class='id identifier rubyid_transaction'>transaction</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_add_comment'>add_comment</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Used to belong to Batch </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_content'> removed at </span><span class='embexpr_beg'>#{</span><span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='lparen'>(</span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_pipeline'>pipeline</span><span class='period'>.</span><span class='id identifier rubyid_detach_request_from_batch'>detach_request_from_batch</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_request'>request</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="display_tags?-instance_method">
  
    #<strong>display_tags?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


282
283
284</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 282</span>

<span class='kw'>def</span> <span class='id identifier rubyid_display_tags?'>display_tags?</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_multiplexed?'>multiplexed?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="fail-instance_method">
  
    #<strong>fail</strong>(reason, comment, ignore_requests = false)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Fail was removed from State Machine (as a state) to allow the addition of
qc_state column and features</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>StandardError</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 96</span>

<span class='kw'>def</span> <span class='id identifier rubyid_fail'>fail</span><span class='lparen'>(</span><span class='id identifier rubyid_reason'>reason</span><span class='comma'>,</span> <span class='id identifier rubyid_comment'>comment</span><span class='comma'>,</span> <span class='id identifier rubyid_ignore_requests'>ignore_requests</span> <span class='op'>=</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='comment'># We&#39;ve deprecated the ability to fail a batch but not its requests.
</span>  <span class='comment'># Keep this check here until we&#39;re sure we haven&#39;t missed anything.
</span>  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>StandardError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Can not fail batch without failing requests</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_ignore_requests'>ignore_requests</span>
  <span class='comment'># create failures
</span>  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='label'>reason:</span> <span class='id identifier rubyid_reason'>reason</span><span class='comma'>,</span> <span class='label'>comment:</span> <span class='id identifier rubyid_comment'>comment</span><span class='comma'>,</span> <span class='label'>notify_remote:</span> <span class='kw'>false</span><span class='rparen'>)</span>

  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_requests'>requests</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_request'>request</span><span class='op'>|</span>
    <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='label'>reason:</span> <span class='id identifier rubyid_reason'>reason</span><span class='comma'>,</span> <span class='label'>comment:</span> <span class='id identifier rubyid_comment'>comment</span><span class='comma'>,</span> <span class='label'>notify_remote:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_asset'>asset</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_asset'>asset</span><span class='period'>.</span><span class='id identifier rubyid_resource?'>resource?</span>
      <span class='const'>EventSender</span><span class='period'>.</span><span class='id identifier rubyid_send_fail_event'>send_fail_event</span><span class='lparen'>(</span><span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_reason'>reason</span><span class='comma'>,</span> <span class='id identifier rubyid_comment'>comment</span><span class='comma'>,</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_production_state'>production_state</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>fail</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="fail_batch_items-instance_method">
  
    #<strong>fail_batch_items</strong>(requests, reason, comment, fail_but_charge = false)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Fail specific items on this batch</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 115</span>

<span class='kw'>def</span> <span class='id identifier rubyid_fail_batch_items'>fail_batch_items</span><span class='lparen'>(</span><span class='id identifier rubyid_requests'>requests</span><span class='comma'>,</span> <span class='id identifier rubyid_reason'>reason</span><span class='comma'>,</span> <span class='id identifier rubyid_comment'>comment</span><span class='comma'>,</span> <span class='id identifier rubyid_fail_but_charge'>fail_but_charge</span> <span class='op'>=</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_checkpoint'>checkpoint</span> <span class='op'>=</span> <span class='kw'>true</span>

  <span class='id identifier rubyid_requests'>requests</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_value'>value</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SENDING FAIL FOR REQUEST </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_key'>key</span><span class='embexpr_end'>}</span><span class='tstring_content'>, BATCH </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_content'>, WITH REASON </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_reason'>reason</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>unless</span> <span class='id identifier rubyid_key'>key</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>control</span><span class='tstring_end'>&quot;</span></span>
        <span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>Base</span><span class='period'>.</span><span class='id identifier rubyid_transaction'>transaction</span> <span class='kw'>do</span>
          <span class='id identifier rubyid_request'>request</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_requests'>requests</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_customer_accepts_responsibility!'>customer_accepts_responsibility!</span> <span class='kw'>if</span> <span class='id identifier rubyid_fail_but_charge'>fail_but_charge</span>
          <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='label'>reason:</span> <span class='id identifier rubyid_reason'>reason</span><span class='comma'>,</span> <span class='label'>comment:</span> <span class='id identifier rubyid_comment'>comment</span><span class='comma'>,</span> <span class='label'>notify_remote:</span> <span class='kw'>true</span><span class='rparen'>)</span>
          <span class='const'>EventSender</span><span class='period'>.</span><span class='id identifier rubyid_send_fail_event'>send_fail_event</span><span class='lparen'>(</span><span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_reason'>reason</span><span class='comma'>,</span> <span class='id identifier rubyid_comment'>comment</span><span class='comma'>,</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_checkpoint'>checkpoint</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_update_batch_state'>update_batch_state</span><span class='lparen'>(</span><span class='id identifier rubyid_reason'>reason</span><span class='comma'>,</span> <span class='id identifier rubyid_comment'>comment</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_checkpoint'>checkpoint</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="failed?-instance_method">
  
    #<strong>failed?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


145
146
147</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 145</span>

<span class='kw'>def</span> <span class='id identifier rubyid_failed?'>failed?</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_production_state'>production_state</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>fail</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="first_output_plate-instance_method">
  
    #<strong>first_output_plate</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


236
237
238</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 236</span>

<span class='kw'>def</span> <span class='id identifier rubyid_first_output_plate'>first_output_plate</span>
  <span class='const'>Plate</span><span class='period'>.</span><span class='id identifier rubyid_output_by_batch'>output_by_batch</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_with_wells_and_requests'>with_wells_and_requests</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="formatted_events-instance_method">
  
    #<strong>formatted_events</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns meaningful events excluding discriptors/descriptor_fields clutter</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


287
288
289
290
291
292
293
294
295
296
297
298
299
300</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 287</span>

<span class='kw'>def</span> <span class='id identifier rubyid_formatted_events'>formatted_events</span>
  <span class='id identifier rubyid_ev'>ev</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_lab_events'>lab_events</span>
  <span class='id identifier rubyid_d'>d</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='kw'>unless</span> <span class='id identifier rubyid_ev'>ev</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_ev'>ev</span><span class='period'>.</span><span class='id identifier rubyid_sort_by'>sort_by</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='id identifier rubyid_i'>i</span><span class='lbracket'>[</span><span class='symbol'>:created_at</span><span class='rbracket'>]</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_descriptors'>descriptors</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_g'>g</span> <span class='op'>=</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_descriptor_value'>descriptor_value</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>task</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
          <span class='id identifier rubyid_d'>d</span> <span class='op'>&lt;&lt;</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>task</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_g'>g</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>description</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_description'>description</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>message</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>data</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_data'>data</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>created_at</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_created_at'>created_at</span> <span class='rbrace'>}</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_d'>d</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="has_control?-instance_method">
  
    #<strong>has_control?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


169
170
171</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 169</span>

<span class='kw'>def</span> <span class='id identifier rubyid_has_control?'>has_control?</span>
  <span class='id identifier rubyid_control'>control</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="has_event-instance_method">
  
    #<strong>has_event</strong>(event_name)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Tests whether this Batch has any associated LabEvents</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


157
158
159</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 157</span>

<span class='kw'>def</span> <span class='id identifier rubyid_has_event'>has_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event_name'>event_name</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_lab_events'>lab_events</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span> <span class='id identifier rubyid_event_name'>event_name</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span> <span class='op'>==</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_description'>description</span><span class='period'>.</span><span class='id identifier rubyid_try'>try</span><span class='lparen'>(</span><span class='symbol'>:downcase</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="in_process?-instance_method">
  
    #<strong>in_process?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Used in auto_batch view to disable the submit button if the batch was
already passed to Auto QC</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


150
151
152
153
154</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 150</span>

<span class='kw'>def</span> <span class='id identifier rubyid_in_process?'>in_process?</span>
  <span class='id identifier rubyid_statuses'>statuses</span> <span class='op'>=</span> <span class='id identifier rubyid_qc_states'>qc_states</span>
  <span class='id identifier rubyid_statuses'>statuses</span><span class='period'>.</span><span class='id identifier rubyid_delete_at'>delete_at</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_statuses'>statuses</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_qc_state'>qc_state</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="input_group-instance_method">
  
    #<strong>input_group</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


206
207
208</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 206</span>

<span class='kw'>def</span> <span class='id identifier rubyid_input_group'>input_group</span>
  <span class='id identifier rubyid_pipeline'>pipeline</span><span class='period'>.</span><span class='id identifier rubyid_group_requests'>group_requests</span> <span class='id identifier rubyid_requests'>requests</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="input_group_sorted_by_map_id-instance_method">
  
    #<strong>input_group_sorted_by_map_id</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


214
215
216</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 214</span>

<span class='kw'>def</span> <span class='id identifier rubyid_input_group_sorted_by_map_id'>input_group_sorted_by_map_id</span>
  <span class='id identifier rubyid_source_assets'>source_assets</span><span class='period'>.</span><span class='id identifier rubyid_sort_by'>sort_by</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:map_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_group_by'>group_by</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:parent</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="input_plate_group-instance_method">
  
    #<strong>input_plate_group</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


210
211
212</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 210</span>

<span class='kw'>def</span> <span class='id identifier rubyid_input_plate_group'>input_plate_group</span>
  <span class='id identifier rubyid_source_assets'>source_assets</span><span class='period'>.</span><span class='id identifier rubyid_group_by'>group_by</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:plate</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="mpx_library_name-instance_method">
  
    #<strong>mpx_library_name</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


271
272
273
274
275
276
277
278
279
280</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 271</span>

<span class='kw'>def</span> <span class='id identifier rubyid_mpx_library_name'>mpx_library_name</span>
  <span class='id identifier rubyid_mpx_name'>mpx_name</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_multiplexed?'>multiplexed?</span> <span class='op'>&amp;&amp;</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_requests'>requests</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;</span> <span class='int'>0</span>
    <span class='id identifier rubyid_mpx_library_tube'>mpx_library_tube</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_requests'>requests</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_target_asset'>target_asset</span><span class='period'>.</span><span class='id identifier rubyid_child'>child</span>
    <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_mpx_library_tube'>mpx_library_tube</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_mpx_name'>mpx_name</span> <span class='op'>=</span> <span class='id identifier rubyid_mpx_library_tube'>mpx_library_tube</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_mpx_name'>mpx_name</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="multiplexed_items_with_unique_library_ids-instance_method">
  
    #<strong>multiplexed_items_with_unique_library_ids</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


302
303
304</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 302</span>

<span class='kw'>def</span> <span class='id identifier rubyid_multiplexed_items_with_unique_library_ids'>multiplexed_items_with_unique_library_ids</span>
  <span class='id identifier rubyid_requests'>requests</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_r'>r</span><span class='op'>|</span> <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_target_asset'>target_asset</span><span class='period'>.</span><span class='id identifier rubyid_children'>children</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_flatten'>flatten</span><span class='period'>.</span><span class='id identifier rubyid_uniq'>uniq</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="npg_set_state-instance_method">
  
    #<strong>npg_set_state</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 544</span>

<span class='kw'>def</span> <span class='id identifier rubyid_npg_set_state'>npg_set_state</span>
  <span class='id identifier rubyid_complete'>complete</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_requests'>requests</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_request'>request</span><span class='op'>|</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_asset'>asset</span><span class='period'>.</span><span class='id identifier rubyid_is_a_resource'>is_a_resource</span>
      <span class='id identifier rubyid_event'>event</span> <span class='op'>=</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_family_pass_and_fail'>family_pass_and_fail</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
      <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_complete'>complete</span> <span class='op'>=</span> <span class='kw'>false</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_complete'>complete</span>
   <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>released</span><span class='tstring_end'>&quot;</span></span>
   <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_qc_complete'>qc_complete</span>
   <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="output_group-instance_method">
  
    #<strong>output_group</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


218
219
220</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 218</span>

<span class='kw'>def</span> <span class='id identifier rubyid_output_group'>output_group</span>
  <span class='id identifier rubyid_pipeline'>pipeline</span><span class='period'>.</span><span class='id identifier rubyid_group_requests'>group_requests</span> <span class='id identifier rubyid_requests'>requests</span><span class='period'>.</span><span class='id identifier rubyid_with_target'>with_target</span><span class='comma'>,</span> <span class='label'>by_target:</span> <span class='kw'>true</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="output_group_by_holder-instance_method">
  
    #<strong>output_group_by_holder</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


222
223
224</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 222</span>

<span class='kw'>def</span> <span class='id identifier rubyid_output_group_by_holder'>output_group_by_holder</span>
  <span class='id identifier rubyid_pipeline'>pipeline</span><span class='period'>.</span><span class='id identifier rubyid_group_requests'>group_requests</span> <span class='id identifier rubyid_requests'>requests</span><span class='period'>.</span><span class='id identifier rubyid_with_target'>with_target</span><span class='comma'>,</span> <span class='label'>by_target:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>group_by_holder_only:</span> <span class='kw'>true</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="output_plate_group-instance_method">
  
    #<strong>output_plate_group</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>This looks odd. Why would a request have the same asset as target asset?
Why are we filtering them out here?</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


227
228
229</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 227</span>

<span class='kw'>def</span> <span class='id identifier rubyid_output_plate_group'>output_plate_group</span>
  <span class='id identifier rubyid_requests'>requests</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_r'>r</span><span class='op'>|</span> <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_target_asset'>target_asset</span> <span class='op'>!=</span> <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_asset'>asset</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:target_asset</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:present?</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_group_by'>group_by</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:plate</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="output_plate_in_batch?-instance_method">
  
    #<strong>output_plate_in_batch?</strong>(barcode)  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


250
251
252
253
254</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 250</span>

<span class='kw'>def</span> <span class='id identifier rubyid_output_plate_in_batch?'>output_plate_in_batch?</span><span class='lparen'>(</span><span class='id identifier rubyid_barcode'>barcode</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='id identifier rubyid_barcode'>barcode</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='const'>Plate</span><span class='period'>.</span><span class='id identifier rubyid_find_by_barcode'>find_by_barcode</span><span class='lparen'>(</span><span class='id identifier rubyid_barcode'>barcode</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='id identifier rubyid_output_plates'>output_plates</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_plate'>plate</span><span class='op'>|</span> <span class='id identifier rubyid_plate'>plate</span><span class='period'>.</span><span class='id identifier rubyid_barcode'>barcode</span> <span class='op'>==</span> <span class='id identifier rubyid_barcode'>barcode</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="output_plate_purpose-instance_method">
  
    #<strong>output_plate_purpose</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>WARNING! This method is used in the sanger barcode gem. Do not remove it
without refactoring the sanger barcode gem.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


242
243
244</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 242</span>

<span class='kw'>def</span> <span class='id identifier rubyid_output_plate_purpose'>output_plate_purpose</span>
  <span class='id identifier rubyid_output_plates'>output_plates</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_plate_purpose'>plate_purpose</span> <span class='kw'>unless</span> <span class='id identifier rubyid_output_plates'>output_plates</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="output_plate_role-instance_method">
  
    #<strong>output_plate_role</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


246
247
248</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 246</span>

<span class='kw'>def</span> <span class='id identifier rubyid_output_plate_role'>output_plate_role</span>
  <span class='id identifier rubyid_requests'>requests</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_try'>try</span><span class='lparen'>(</span><span class='symbol'>:role</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="output_plates-instance_method">
  
    #<strong>output_plates</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


231
232
233
234</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 231</span>

<span class='kw'>def</span> <span class='id identifier rubyid_output_plates'>output_plates</span>
  <span class='id identifier rubyid_holder_ids'>holder_ids</span> <span class='op'>=</span> <span class='const'>Request</span><span class='period'>.</span><span class='id identifier rubyid_get_target_plate_ids'>get_target_plate_ids</span><span class='lparen'>(</span><span class='id identifier rubyid_request_ids'>request_ids</span><span class='rparen'>)</span>
  <span class='const'>Plate</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_holder_ids'>holder_ids</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="parent_of_purpose-instance_method">
  
    #<strong>parent_of_purpose</strong>(name)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


389
390
391
392
393
394</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 389</span>

<span class='kw'>def</span> <span class='id identifier rubyid_parent_of_purpose'>parent_of_purpose</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='id identifier rubyid_requests'>requests</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
  <span class='id identifier rubyid_requests'>requests</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_asset'>asset</span><span class='period'>.</span><span class='id identifier rubyid_ancestors'>ancestors</span><span class='period'>.</span><span class='id identifier rubyid_joins'>joins</span><span class='lparen'>(</span>
    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>INNER JOIN plate_purposes ON assets.plate_purpose_id = plate_purposes.id</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span>
    <span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>plate_purposes:</span> <span class='lbrace'>{</span> <span class='label'>name:</span> <span class='id identifier rubyid_name'>name</span> <span class='rbrace'>}</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="plate_barcode-instance_method">
  
    #<strong>plate_barcode</strong>(barcode)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


263
264
265
266
267
268
269</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 263</span>

<span class='kw'>def</span> <span class='id identifier rubyid_plate_barcode'>plate_barcode</span><span class='lparen'>(</span><span class='id identifier rubyid_barcode'>barcode</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_barcode'>barcode</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_barcode'>barcode</span>
  <span class='kw'>else</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_requests'>requests</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_target_asset'>target_asset</span><span class='period'>.</span><span class='id identifier rubyid_plate'>plate</span><span class='period'>.</span><span class='id identifier rubyid_barcode'>barcode</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="plate_group_barcodes-instance_method">
  
    #<strong>plate_group_barcodes</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


256
257
258
259
260
261</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 256</span>

<span class='kw'>def</span> <span class='id identifier rubyid_plate_group_barcodes'>plate_group_barcodes</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='id identifier rubyid_pipeline'>pipeline</span><span class='period'>.</span><span class='id identifier rubyid_group_by_parent'>group_by_parent</span> <span class='op'>||</span> <span class='id identifier rubyid_requests'>requests</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_target_asset'>target_asset</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Well</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_latest_plate_group'>latest_plate_group</span> <span class='op'>=</span> <span class='id identifier rubyid_output_plate_group'>output_plate_group</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_latest_plate_group'>latest_plate_group</span> <span class='kw'>unless</span> <span class='id identifier rubyid_latest_plate_group'>latest_plate_group</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_input_plate_group'>input_plate_group</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="plate_ids_in_study-instance_method">
  
    #<strong>plate_ids_in_study</strong>(study)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


424
425
426</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 424</span>

<span class='kw'>def</span> <span class='id identifier rubyid_plate_ids_in_study'>plate_ids_in_study</span><span class='lparen'>(</span><span class='id identifier rubyid_study'>study</span><span class='rparen'>)</span>
  <span class='const'>Plate</span><span class='period'>.</span><span class='id identifier rubyid_plate_ids_from_requests'>plate_ids_from_requests</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_requests'>requests</span><span class='period'>.</span><span class='id identifier rubyid_for_studies'>for_studies</span><span class='lparen'>(</span><span class='id identifier rubyid_study'>study</span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="pulldown_batch_report-instance_method">
  
    #<strong>pulldown_batch_report</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 494</span>

<span class='kw'>def</span> <span class='id identifier rubyid_pulldown_batch_report'>pulldown_batch_report</span>
  <span class='id identifier rubyid_report_data'>report_data</span> <span class='op'>=</span> <span class='const'>CSV</span><span class='period'>.</span><span class='id identifier rubyid_generate'>generate</span><span class='lparen'>(</span><span class='label'>row_sep:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\r\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_csv'>csv</span><span class='op'>|</span>
    <span class='id identifier rubyid_csv'>csv</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_pulldown_report_headers'>pulldown_report_headers</span>

    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_requests'>requests</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_request'>request</span><span class='op'>|</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Invalid request data</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_valid_request_for_pulldown_report?'>valid_request_for_pulldown_report?</span>
      <span class='id identifier rubyid_well'>well</span> <span class='op'>=</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_asset'>asset</span>
      <span class='comment'># TODO[mb14] DRY it
</span>      <span class='id identifier rubyid_tagged_well'>tagged_well</span> <span class='op'>=</span> <span class='id identifier rubyid_well'>well</span>
      <span class='kw'>while</span> <span class='id identifier rubyid_transfer_requests'>transfer_requests</span> <span class='op'>=</span> <span class='id identifier rubyid_tagged_well'>tagged_well</span><span class='period'>.</span><span class='id identifier rubyid_requests'>requests</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_r'>r</span><span class='op'>|</span> <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>TransferRequest</span><span class='rparen'>)</span> <span class='rbrace'>}</span> <span class='kw'>and</span> <span class='id identifier rubyid_transfer_requests'>transfer_requests</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>==</span> <span class='int'>1</span>
        <span class='id identifier rubyid_target_well'>target_well</span> <span class='op'>=</span> <span class='id identifier rubyid_transfer_requests'>transfer_requests</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_target_asset'>target_asset</span>
        <span class='kw'>break</span> <span class='kw'>unless</span> <span class='id identifier rubyid_target_well'>target_well</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Well</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_tagged_well'>tagged_well</span> <span class='op'>=</span> <span class='id identifier rubyid_target_well'>target_well</span>
        <span class='id identifier rubyid_tag_on_well'>tag_on_well</span> <span class='op'>=</span> <span class='id identifier rubyid_tagged_well'>tagged_well</span><span class='period'>.</span><span class='id identifier rubyid_primary_aliquot'>primary_aliquot</span><span class='period'>.</span><span class='id identifier rubyid_try'>try</span><span class='lparen'>(</span><span class='symbol'>:tag</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_tag_on_well'>tag_on_well</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
          <span class='id identifier rubyid_tag_name'>tag_name</span>              <span class='op'>=</span> <span class='id identifier rubyid_tag_on_well'>tag_on_well</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
          <span class='id identifier rubyid_tag_expected_sequence'>tag_expected_sequence</span> <span class='op'>=</span> <span class='id identifier rubyid_tag_on_well'>tag_on_well</span><span class='period'>.</span><span class='id identifier rubyid_oligo'>oligo</span>
          <span class='id identifier rubyid_tag_group_name'>tag_group_name</span>        <span class='op'>=</span> <span class='id identifier rubyid_tag_on_well'>tag_on_well</span><span class='period'>.</span><span class='id identifier rubyid_tag_group'>tag_group</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='kw'>if</span> <span class='id identifier rubyid_tag_on_well'>tag_on_well</span><span class='period'>.</span><span class='id identifier rubyid_tag_group'>tag_group</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
          <span class='kw'>break</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_sample'>sample</span> <span class='op'>=</span> <span class='id identifier rubyid_well'>well</span><span class='period'>.</span><span class='id identifier rubyid_primary_aliquot'>primary_aliquot</span><span class='period'>.</span><span class='id identifier rubyid_try'>try</span><span class='lparen'>(</span><span class='symbol'>:sample</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_csv'>csv</span> <span class='op'>&lt;&lt;</span> <span class='lbracket'>[</span>
        <span class='id identifier rubyid_well'>well</span><span class='period'>.</span><span class='id identifier rubyid_plate'>plate</span><span class='period'>.</span><span class='id identifier rubyid_sanger_human_barcode'>sanger_human_barcode</span><span class='comma'>,</span>
        <span class='id identifier rubyid_well'>well</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='period'>.</span><span class='id identifier rubyid_description'>description</span><span class='comma'>,</span>
        <span class='id identifier rubyid_well'>well</span><span class='period'>.</span><span class='id identifier rubyid_study'>study</span><span class='period'>.</span><span class='id identifier rubyid_try'>try</span><span class='lparen'>(</span><span class='symbol'>:name</span><span class='rparen'>)</span><span class='comma'>,</span>
        <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_target_asset'>target_asset</span><span class='period'>.</span><span class='id identifier rubyid_try'>try</span><span class='lparen'>(</span><span class='symbol'>:barcode</span><span class='rparen'>)</span><span class='comma'>,</span>
        <span class='id identifier rubyid_tag_group_name'>tag_group_name</span><span class='comma'>,</span>
        <span class='id identifier rubyid_tag_name'>tag_name</span><span class='comma'>,</span>
        <span class='id identifier rubyid_tag_expected_sequence'>tag_expected_sequence</span><span class='comma'>,</span>
        <span class='id identifier rubyid_sample'>sample</span><span class='period'>.</span><span class='id identifier rubyid_sanger_sample_id'>sanger_sample_id</span> <span class='op'>||</span> <span class='id identifier rubyid_sample'>sample</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span>
        <span class='id identifier rubyid_well'>well</span><span class='period'>.</span><span class='id identifier rubyid_parent'>parent</span><span class='period'>.</span><span class='id identifier rubyid_well_attribute'>well_attribute</span><span class='period'>.</span><span class='id identifier rubyid_measured_volume'>measured_volume</span><span class='comma'>,</span>
        <span class='id identifier rubyid_well'>well</span><span class='period'>.</span><span class='id identifier rubyid_parent'>parent</span><span class='period'>.</span><span class='id identifier rubyid_well_attribute'>well_attribute</span><span class='period'>.</span><span class='id identifier rubyid_concentration'>concentration</span>
      <span class='rbracket'>]</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_report_data'>report_data</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="pulldown_report_headers-instance_method">
  
    #<strong>pulldown_report_headers</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


535
536
537</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 535</span>

<span class='kw'>def</span> <span class='id identifier rubyid_pulldown_report_headers'>pulldown_report_headers</span>
  <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Plate</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Well</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Study</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Pooled Tube</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Tag Group</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Tag</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Expected Sequence</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Sample Name</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Measured Volume</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Measured Concentration</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="release_pending_requests-instance_method">
  
    #<strong>release_pending_requests</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


328
329
330
331
332
333
334</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 328</span>

<span class='kw'>def</span> <span class='id identifier rubyid_release_pending_requests'>release_pending_requests</span>
  <span class='comment'># We set the unusued requests to pendind.
</span>  <span class='comment'># this is to allow unused well to be cherry-picked again
</span>  <span class='id identifier rubyid_requests'>requests</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_request'>request</span><span class='op'>|</span>
    <span class='id identifier rubyid_detach_request'>detach_request</span><span class='lparen'>(</span><span class='id identifier rubyid_request'>request</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_started?'>started?</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="remove_link-instance_method">
  
    #<strong>remove_link</strong>(request)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


366
367
368</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 366</span>

<span class='kw'>def</span> <span class='id identifier rubyid_remove_link'>remove_link</span><span class='lparen'>(</span><span class='id identifier rubyid_request'>request</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_batch'>batch</span> <span class='op'>=</span> <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="remove_request_ids-instance_method">
  
    #<strong>remove_request_ids</strong>(request_ids, reason = nil, comment = nil)  &#x21d2; <tt>Object</tt> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='recycle_request_ids-instance_method'>recycle_request_ids</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Remove the request from the batch and remove asset information</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


337
338
339
340
341
342
343
344
345
346
347</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 337</span>

<span class='kw'>def</span> <span class='id identifier rubyid_remove_request_ids'>remove_request_ids</span><span class='lparen'>(</span><span class='id identifier rubyid_request_ids'>request_ids</span><span class='comma'>,</span> <span class='id identifier rubyid_reason'>reason</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_comment'>comment</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>Base</span><span class='period'>.</span><span class='id identifier rubyid_transaction'>transaction</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_request_ids'>request_ids</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_request_id'>request_id</span><span class='op'>|</span>
      <span class='id identifier rubyid_request'>request</span> <span class='op'>=</span> <span class='const'>Request</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_request_id'>request_id</span><span class='rparen'>)</span>
      <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='label'>reason:</span> <span class='id identifier rubyid_reason'>reason</span><span class='comma'>,</span> <span class='label'>comment:</span> <span class='id identifier rubyid_comment'>comment</span><span class='comma'>,</span> <span class='label'>notify_remote:</span> <span class='kw'>true</span><span class='rparen'>)</span>
      <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_detach_request'>detach_request</span><span class='lparen'>(</span><span class='id identifier rubyid_request'>request</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_update_batch_state'>update_batch_state</span><span class='lparen'>(</span><span class='id identifier rubyid_reason'>reason</span><span class='comma'>,</span> <span class='id identifier rubyid_comment'>comment</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="request_count-instance_method">
  
    #<strong>request_count</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


490
491
492</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 490</span>

<span class='kw'>def</span> <span class='id identifier rubyid_request_count'>request_count</span>
  <span class='id identifier rubyid_requests'>requests</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="requests_have_same_read_length-instance_method">
  
    #<strong>requests_have_same_read_length</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


58
59
60
61
62</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 58</span>

<span class='kw'>def</span> <span class='id identifier rubyid_requests_have_same_read_length'>requests_have_same_read_length</span>
  <span class='kw'>unless</span> <span class='id identifier rubyid_pipeline'>pipeline</span><span class='period'>.</span><span class='id identifier rubyid_is_read_length_consistent_for_batch?'>is_read_length_consistent_for_batch?</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_errors'>errors</span><span class='period'>.</span><span class='id identifier rubyid_add'>add</span> <span class='symbol'>:base</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The selected requests must have the same values in their &#39;Read length&#39; field.</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="reset!-instance_method">
  
    #<strong>reset!</strong>(current_user)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 370</span>

<span class='kw'>def</span> <span class='id identifier rubyid_reset!'>reset!</span><span class='lparen'>(</span><span class='id identifier rubyid_current_user'>current_user</span><span class='rparen'>)</span>
  <span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>Base</span><span class='period'>.</span><span class='id identifier rubyid_transaction'>transaction</span> <span class='kw'>do</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_discard!'>discard!</span>

    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_requests'>requests</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_request'>request</span><span class='op'>|</span>
      <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_remove_link'>remove_link</span><span class='lparen'>(</span><span class='id identifier rubyid_request'>request</span><span class='rparen'>)</span> <span class='comment'># Remove link in all types of pipelines
</span>      <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_return_request_to_inbox'>return_request_to_inbox</span><span class='lparen'>(</span><span class='id identifier rubyid_request'>request</span><span class='comma'>,</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_requests'>requests</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='period'>.</span><span class='id identifier rubyid_submission_id'>submission_id</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
      <span class='const'>Request</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>submission_id:</span> <span class='id identifier rubyid_requests'>requests</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='period'>.</span><span class='id identifier rubyid_submission_id'>submission_id</span><span class='comma'>,</span> <span class='label'>state:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>pending</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span>
        <span class='id identifier rubyid_where'>where</span><span class='period'>.</span><span class='id identifier rubyid_not'>not</span><span class='lparen'>(</span><span class='label'>request_type_id:</span> <span class='id identifier rubyid_pipeline'>pipeline</span><span class='period'>.</span><span class='id identifier rubyid_request_type_ids'>request_type_ids</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_find_each'>find_each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_request'>request</span><span class='op'>|</span>
          <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_asset_id'>asset_id</span> <span class='op'>=</span> <span class='kw'>nil</span>
          <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="return_request_to_inbox-instance_method">
  
    #<strong>return_request_to_inbox</strong>(request, current_user = nil)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


359
360
361
362
363
364</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 359</span>

<span class='kw'>def</span> <span class='id identifier rubyid_return_request_to_inbox'>return_request_to_inbox</span><span class='lparen'>(</span><span class='id identifier rubyid_request'>request</span><span class='comma'>,</span> <span class='id identifier rubyid_current_user'>current_user</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>Base</span><span class='period'>.</span><span class='id identifier rubyid_transaction'>transaction</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_add_comment'>add_comment</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Used to belong to Batch </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_content'> returned to inbox unstarted at </span><span class='embexpr_beg'>#{</span><span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_return_pending_to_inbox!'>return_pending_to_inbox!</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="robot_verified!-instance_method">
  
    #<strong>robot_verified!</strong>(user_id)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


458
459
460
461
462</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 458</span>

<span class='kw'>def</span> <span class='id identifier rubyid_robot_verified!'>robot_verified!</span><span class='lparen'>(</span><span class='id identifier rubyid_user_id'>user_id</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>if</span> <span class='id identifier rubyid_has_event'>has_event</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>robot verified</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_pipeline'>pipeline</span><span class='period'>.</span><span class='id identifier rubyid_robot_verified!'>robot_verified!</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_lab_events'>lab_events</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='label'>description:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Robot verified</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>message:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Robot verification completed and source volumes updated.</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>user_id:</span> <span class='id identifier rubyid_user_id'>user_id</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="shift_item_positions-instance_method">
  
    #<strong>shift_item_positions</strong>(position, number)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


187
188
189
190
191
192
193
194
195
196</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 187</span>

<span class='kw'>def</span> <span class='id identifier rubyid_shift_item_positions'>shift_item_positions</span><span class='lparen'>(</span><span class='id identifier rubyid_position'>position</span><span class='comma'>,</span> <span class='id identifier rubyid_number'>number</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_number'>number</span>
  <span class='const'>BatchRequest</span><span class='period'>.</span><span class='id identifier rubyid_transaction'>transaction</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_batch_requests'>batch_requests</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_batch_request'>batch_request</span><span class='op'>|</span>
      <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_batch_request'>batch_request</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span> <span class='op'>&gt;=</span> <span class='id identifier rubyid_position'>position</span>
      <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_batch_request'>batch_request</span><span class='period'>.</span><span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_asset'>asset</span><span class='period'>.</span><span class='id identifier rubyid_try'>try</span><span class='lparen'>(</span><span class='symbol'>:resource?</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_batch_request'>batch_request</span><span class='period'>.</span><span class='id identifier rubyid_move_to_position!'>move_to_position!</span><span class='lparen'>(</span><span class='id identifier rubyid_batch_request'>batch_request</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span> <span class='op'>+</span> <span class='id identifier rubyid_number'>number</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="show_actions?-instance_method">
  
    #<strong>show_actions?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


539
540
541
542</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 539</span>

<span class='kw'>def</span> <span class='id identifier rubyid_show_actions?'>show_actions?</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_released?'>released?</span> <span class='op'>==</span> <span class='kw'>false</span> <span class='kw'>or</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_pipeline'>pipeline</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_const_get'>const_get</span><span class='lparen'>(</span><span class='symbol'>:ALWAYS_SHOW_RELEASE_ACTIONS</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="show_fail_link?-instance_method">
  
    #<strong>show_fail_link?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


562
563
564</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 562</span>

<span class='kw'>def</span> <span class='id identifier rubyid_show_fail_link?'>show_fail_link?</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_released?'>released?</span> <span class='op'>&amp;&amp;</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_pipeline'>pipeline</span><span class='period'>.</span><span class='id identifier rubyid_sequencing?'>sequencing?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="source_labware-instance_method">
  
    #<strong>source_labware</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Source Labware returns the physical pieces of lawbare (ie. a plate for
wells, but stubes for tubes)</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


307
308
309</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 307</span>

<span class='kw'>def</span> <span class='id identifier rubyid_source_labware'>source_labware</span>
  <span class='id identifier rubyid_requests'>requests</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:asset</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:labware</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_uniq'>uniq</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="space_left-instance_method">
  
    #<strong>space_left</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


428
429
430</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 428</span>

<span class='kw'>def</span> <span class='id identifier rubyid_space_left'>space_left</span>
  <span class='lbracket'>[</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_item_limit'>item_limit</span> <span class='op'>-</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_batch_requests'>batch_requests</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span><span class='comma'>,</span> <span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_max'>max</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="start_requests-instance_method">
  
    #<strong>start_requests</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


202
203
204</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 202</span>

<span class='kw'>def</span> <span class='id identifier rubyid_start_requests'>start_requests</span>
  <span class='id identifier rubyid_requests'>requests</span><span class='period'>.</span><span class='id identifier rubyid_with_assets_for_starting_requests'>with_assets_for_starting_requests</span><span class='period'>.</span><span class='id identifier rubyid_not_failed'>not_failed</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:start!</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="study-instance_method">
  
    #<strong>study</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


30
31
32</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 30</span>

<span class='kw'>def</span> <span class='id identifier rubyid_study'>study</span>
  <span class='id identifier rubyid_studies'>studies</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="swap-instance_method">
  
    #<strong>swap</strong>(current_user, batch_info = {})  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 396</span>

<span class='kw'>def</span> <span class='id identifier rubyid_swap'>swap</span><span class='lparen'>(</span><span class='id identifier rubyid_current_user'>current_user</span><span class='comma'>,</span> <span class='id identifier rubyid_batch_info'>batch_info</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='id identifier rubyid_batch_info'>batch_info</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>

  <span class='comment'># Find the two lanes that are to be swapped
</span>  <span class='id identifier rubyid_batch_request_left'>batch_request_left</span>  <span class='op'>=</span> <span class='const'>BatchRequest</span><span class='period'>.</span><span class='id identifier rubyid_find_by_batch_id_and_position'>find_by_batch_id_and_position</span><span class='lparen'>(</span><span class='id identifier rubyid_batch_info'>batch_info</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>batch_1</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_batch_info'>batch_info</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>batch_1</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>lane</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_errors'>errors</span><span class='period'>.</span><span class='id identifier rubyid_add'>add</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Swap: </span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The first lane cannot be found</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_batch_request_right'>batch_request_right</span> <span class='op'>=</span> <span class='const'>BatchRequest</span><span class='period'>.</span><span class='id identifier rubyid_find_by_batch_id_and_position'>find_by_batch_id_and_position</span><span class='lparen'>(</span><span class='id identifier rubyid_batch_info'>batch_info</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>batch_2</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_batch_info'>batch_info</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>batch_2</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>lane</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_errors'>errors</span><span class='period'>.</span><span class='id identifier rubyid_add'>add</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Swap: </span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The second lane cannot be found</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_batch_request_left'>batch_request_left</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='kw'>and</span> <span class='id identifier rubyid_batch_request_right'>batch_request_right</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>

  <span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>Base</span><span class='period'>.</span><span class='id identifier rubyid_transaction'>transaction</span> <span class='kw'>do</span>
    <span class='comment'># Update the lab events for the request so that they reference the batch that the request is moving to
</span>    <span class='id identifier rubyid_batch_request_left'>batch_request_left</span><span class='period'>.</span><span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_lab_events'>lab_events</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span>  <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_update_attributes!'>update_attributes!</span><span class='lparen'>(</span><span class='label'>batch_id:</span> <span class='id identifier rubyid_batch_request_right'>batch_request_right</span><span class='period'>.</span><span class='id identifier rubyid_batch_id'>batch_id</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_batch_id'>batch_id</span> <span class='op'>==</span> <span class='id identifier rubyid_batch_request_left'>batch_request_left</span><span class='period'>.</span><span class='id identifier rubyid_batch_id'>batch_id</span>  <span class='rbrace'>}</span>
    <span class='id identifier rubyid_batch_request_right'>batch_request_right</span><span class='period'>.</span><span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_lab_events'>lab_events</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_update_attributes!'>update_attributes!</span><span class='lparen'>(</span><span class='label'>batch_id:</span> <span class='id identifier rubyid_batch_request_left'>batch_request_left</span><span class='period'>.</span><span class='id identifier rubyid_batch_id'>batch_id</span><span class='rparen'>)</span>  <span class='kw'>if</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_batch_id'>batch_id</span> <span class='op'>==</span> <span class='id identifier rubyid_batch_request_right'>batch_request_right</span><span class='period'>.</span><span class='id identifier rubyid_batch_id'>batch_id</span> <span class='rbrace'>}</span>

    <span class='comment'># Swap the two batch requests so that they are correct.  This involves swapping both the batch and the lane but ensuring that the
</span>    <span class='comment'># two requests don&#39;t clash on position by removing one of them.
</span>    <span class='id identifier rubyid_original_left_batch_id'>original_left_batch_id</span><span class='comma'>,</span> <span class='id identifier rubyid_original_left_position'>original_left_position</span><span class='comma'>,</span> <span class='id identifier rubyid_original_right_request_id'>original_right_request_id</span> <span class='op'>=</span> <span class='id identifier rubyid_batch_request_left'>batch_request_left</span><span class='period'>.</span><span class='id identifier rubyid_batch_id'>batch_id</span><span class='comma'>,</span> <span class='id identifier rubyid_batch_request_left'>batch_request_left</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span><span class='comma'>,</span> <span class='id identifier rubyid_batch_request_right'>batch_request_right</span><span class='period'>.</span><span class='id identifier rubyid_request_id'>request_id</span>
    <span class='id identifier rubyid_batch_request_right'>batch_request_right</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span>
    <span class='id identifier rubyid_batch_request_left'>batch_request_left</span><span class='period'>.</span><span class='id identifier rubyid_update_attributes!'>update_attributes!</span><span class='lparen'>(</span><span class='label'>batch_id:</span> <span class='id identifier rubyid_batch_request_right'>batch_request_right</span><span class='period'>.</span><span class='id identifier rubyid_batch_id'>batch_id</span><span class='comma'>,</span> <span class='label'>position:</span> <span class='id identifier rubyid_batch_request_right'>batch_request_right</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_batch_request_right'>batch_request_right</span> <span class='op'>=</span> <span class='const'>BatchRequest</span><span class='period'>.</span><span class='id identifier rubyid_create!'>create!</span><span class='lparen'>(</span><span class='label'>batch_id:</span> <span class='id identifier rubyid_original_left_batch_id'>original_left_batch_id</span><span class='comma'>,</span> <span class='label'>position:</span> <span class='id identifier rubyid_original_left_position'>original_left_position</span><span class='comma'>,</span> <span class='label'>request_id:</span> <span class='id identifier rubyid_original_right_request_id'>original_right_request_id</span><span class='rparen'>)</span>

    <span class='comment'># Finally record the fact that the batch was swapped
</span>    <span class='id identifier rubyid_batch_request_left'>batch_request_left</span><span class='period'>.</span><span class='id identifier rubyid_batch'>batch</span><span class='period'>.</span><span class='id identifier rubyid_lab_events'>lab_events</span><span class='period'>.</span><span class='id identifier rubyid_create!'>create!</span><span class='lparen'>(</span><span class='label'>description:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Lane swap</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>message:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Lane </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_batch_request_right'>batch_request_right</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span><span class='embexpr_end'>}</span><span class='tstring_content'> moved to </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_batch_request_left'>batch_request_left</span><span class='period'>.</span><span class='id identifier rubyid_batch_id'>batch_id</span><span class='embexpr_end'>}</span><span class='tstring_content'> lane </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_batch_request_left'>batch_request_left</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>user_id:</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_batch_request_right'>batch_request_right</span><span class='period'>.</span><span class='id identifier rubyid_batch'>batch</span><span class='period'>.</span><span class='id identifier rubyid_lab_events'>lab_events</span><span class='period'>.</span><span class='id identifier rubyid_create!'>create!</span><span class='lparen'>(</span><span class='label'>description:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Lane swap</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>message:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Lane </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_batch_request_left'>batch_request_left</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span><span class='embexpr_end'>}</span><span class='tstring_content'> moved to </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_batch_request_right'>batch_request_right</span><span class='period'>.</span><span class='id identifier rubyid_batch_id'>batch_id</span><span class='embexpr_end'>}</span><span class='tstring_content'> lane </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_batch_request_right'>batch_request_right</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>user_id:</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>return</span> <span class='kw'>true</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="total_volume_to_cherrypick-instance_method">
  
    #<strong>total_volume_to_cherrypick</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


451
452
453
454
455
456</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 451</span>

<span class='kw'>def</span> <span class='id identifier rubyid_total_volume_to_cherrypick'>total_volume_to_cherrypick</span>
  <span class='id identifier rubyid_request'>request</span> <span class='op'>=</span> <span class='id identifier rubyid_requests'>requests</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
  <span class='kw'>return</span> <span class='const'>DEFAULT_VOLUME</span> <span class='kw'>unless</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_asset'>asset</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Well</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='const'>DEFAULT_VOLUME</span> <span class='kw'>unless</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_target_asset'>target_asset</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Well</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_target_asset'>target_asset</span><span class='period'>.</span><span class='id identifier rubyid_get_requested_volume'>get_requested_volume</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="underrun-instance_method">
  
    #<strong>underrun</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


161
162
163</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 161</span>

<span class='kw'>def</span> <span class='id identifier rubyid_underrun'>underrun</span>
  <span class='id identifier rubyid_has_limit?'>has_limit?</span> <span class='op'>?</span> <span class='lparen'>(</span><span class='id identifier rubyid_item_limit'>item_limit</span> <span class='op'>-</span> <span class='id identifier rubyid_batch_requests'>batch_requests</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='int'>0</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_batch_state-instance_method">
  
    #<strong>update_batch_state</strong>(reason, comment)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


137
138
139
140
141
142
143</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 137</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update_batch_state'>update_batch_state</span><span class='lparen'>(</span><span class='id identifier rubyid_reason'>reason</span><span class='comma'>,</span> <span class='id identifier rubyid_comment'>comment</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_requests'>requests</span><span class='period'>.</span><span class='id identifier rubyid_all?'>all?</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:terminated?</span><span class='rparen'>)</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_failures'>failures</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='label'>reason:</span> <span class='id identifier rubyid_reason'>reason</span><span class='comma'>,</span> <span class='label'>comment:</span> <span class='id identifier rubyid_comment'>comment</span><span class='comma'>,</span> <span class='label'>notify_remote:</span> <span class='kw'>false</span><span class='rparen'>)</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_production_state'>production_state</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>fail</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="verify_tube_layout-instance_method">
  
    #<strong>verify_tube_layout</strong>(barcodes, user = nil)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/batch.rb', line 311</span>

<span class='kw'>def</span> <span class='id identifier rubyid_verify_tube_layout'>verify_tube_layout</span><span class='lparen'>(</span><span class='id identifier rubyid_barcodes'>barcodes</span><span class='comma'>,</span> <span class='id identifier rubyid_user'>user</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_requests'>requests</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_request'>request</span><span class='op'>|</span>
    <span class='id identifier rubyid_barcode'>barcode</span> <span class='op'>=</span> <span class='id identifier rubyid_barcodes'>barcodes</span><span class='lbracket'>[</span><span class='lparen'>(</span><span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rbracket'>]</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_barcode'>barcode</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span> <span class='op'>||</span> <span class='id identifier rubyid_barcode'>barcode</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>0</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>unless</span> <span class='id identifier rubyid_barcode'>barcode</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>==</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_asset'>asset</span><span class='period'>.</span><span class='id identifier rubyid_barcode'>barcode</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_errors'>errors</span><span class='period'>.</span><span class='id identifier rubyid_add'>add</span><span class='lparen'>(</span><span class='symbol'>:base</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The tube at position </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span><span class='embexpr_end'>}</span><span class='tstring_content'> is incorrect.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_errors'>errors</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_lab_events'>lab_events</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='label'>description:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Tube layout verified</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>user:</span> <span class='id identifier rubyid_user'>user</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>true</span>
  <span class='kw'>else</span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Mon Dec 19 11:16:43 2016 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.5 (ruby-2.3.3).
</div>

    </div>
  </body>
</html>