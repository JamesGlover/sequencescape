<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: Tasks::CherrypickHandler
  
    &mdash; Documentation by YARD 0.9.5
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "Tasks::CherrypickHandler";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../class_list.html"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (C)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../Tasks.html" title="Tasks (module)">Tasks</a></span></span>
     &raquo; 
    <span class="title">CherrypickHandler</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <iframe id="search_frame" src="../class_list.html"></iframe>

      <div id="content"><h1>Module: Tasks::CherrypickHandler
  
  
  
</h1>
<div class="box_info">
  

  
  
  
  
  

  
  <dl>
    <dt>Included in:</dt>
    <dd><span class='object_link'><a href="../WorkflowsController.html" title="WorkflowsController (class)">WorkflowsController</a></span></dd>
  </dl>
  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>app/models/tasks/cherrypick_handler.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>This file is part of SEQUENCESCAPE; it is distributed under the terms of
GNU General Public License version 1 or later; Please refer to the LICENSE
and README files for information on licensing and authorship of this file.
Copyright (C) 2007-2011,2012,2013,2014,2015 Genome Research Ltd.</p>


  </div>
</div>
<div class="tags">
  

</div>






  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#included-class_method" title="included (class method)">.<strong>included</strong>(base)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create_control_request_and_add_to_batch-instance_method" title="#create_control_request_and_add_to_batch (instance method)">#<strong>create_control_request_and_add_to_batch</strong>(task, control_param)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#do_cherrypick_task-instance_method" title="#do_cherrypick_task (instance method)">#<strong>do_cherrypick_task</strong>(task, params)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#render_cherrypick_task-instance_method" title="#render_cherrypick_task (instance method)">#<strong>render_cherrypick_task</strong>(task, params)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#setup_input_params_for_pass_through-instance_method" title="#setup_input_params_for_pass_through (instance method)">#<strong>setup_input_params_for_pass_through</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  



  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="included-class_method">
  
    .<strong>included</strong>(base)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


8
9
10
11
12</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/tasks/cherrypick_handler.rb', line 8</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'>Cherrypick</span><span class='op'>::</span><span class='const'>Task</span><span class='op'>::</span><span class='const'>PickHelpers</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="create_control_request_and_add_to_batch-instance_method">
  
    #<strong>create_control_request_and_add_to_batch</strong>(task, control_param)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


192
193
194
195
196</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/tasks/cherrypick_handler.rb', line 192</span>

<span class='kw'>def</span> <span class='id identifier rubyid_create_control_request_and_add_to_batch'>create_control_request_and_add_to_batch</span><span class='lparen'>(</span><span class='id identifier rubyid_task'>task</span><span class='comma'>,</span> <span class='id identifier rubyid_control_param'>control_param</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_control_request'>control_request</span> <span class='op'>=</span> <span class='id identifier rubyid_task'>task</span><span class='period'>.</span><span class='id identifier rubyid_create_control_request_from_well'>create_control_request_from_well</span><span class='lparen'>(</span><span class='id identifier rubyid_control_param'>control_param</span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='id identifier rubyid_raise'>raise</span> <span class='const'>StandardError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Control request not created!</span><span class='tstring_end'>&quot;</span></span>
  <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_requests'>requests</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_control_request'>control_request</span>
  <span class='lbracket'>[</span><span class='id identifier rubyid_control_request'>control_request</span><span class='comma'>,</span> <span class='id identifier rubyid_control_request'>control_request</span><span class='period'>.</span><span class='id identifier rubyid_target_asset'>target_asset</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="do_cherrypick_task-instance_method">
  
    #<strong>do_cherrypick_task</strong>(task, params)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/tasks/cherrypick_handler.rb', line 89</span>

<span class='kw'>def</span> <span class='id identifier rubyid_do_cherrypick_task'>do_cherrypick_task</span><span class='lparen'>(</span><span class='id identifier rubyid_task'>task</span><span class='comma'>,</span> <span class='id identifier rubyid_params'>params</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_plates'>plates</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:plate</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_size'>size</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:plate_size</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_plate_type'>plate_type</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:plate_type</span><span class='rbracket'>]</span>

  <span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>Base</span><span class='period'>.</span><span class='id identifier rubyid_transaction'>transaction</span> <span class='kw'>do</span>
    <span class='comment'># Determine if there is a standard plate to use.
</span>    <span class='id identifier rubyid_partial_plate'>partial_plate</span><span class='comma'>,</span> <span class='id identifier rubyid_plate_barcode'>plate_barcode</span><span class='comma'>,</span> <span class='id identifier rubyid_fluidigm_plate'>fluidigm_plate</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:plate_barcode</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:fluidigm_plate</span><span class='rbracket'>]</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_plate_barcode'>plate_barcode</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_partial_plate'>partial_plate</span> <span class='op'>=</span> <span class='const'>Plate</span><span class='period'>.</span><span class='id identifier rubyid_find_by_barcode'>find_by_barcode</span><span class='lparen'>(</span><span class='id identifier rubyid_plate_barcode'>plate_barcode</span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>RecordNotFound</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No plate with barcode </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_plate_barcode'>plate_barcode</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_fluidigm_plate'>fluidigm_plate</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
      <span class='id identifier rubyid_partial_plate'>partial_plate</span> <span class='op'>=</span> <span class='const'>Plate</span><span class='op'>::</span><span class='const'>Metadata</span><span class='period'>.</span><span class='id identifier rubyid_find_by_fluidigm_barcode'>find_by_fluidigm_barcode</span><span class='lparen'>(</span><span class='id identifier rubyid_fluidigm_plate'>fluidigm_plate</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_try'>try</span><span class='lparen'>(</span><span class='symbol'>:plate</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># Ensure that we have a plate purpose for any plates we are creating
</span>    <span class='id identifier rubyid_plate_purpose'>plate_purpose</span> <span class='op'>=</span> <span class='const'>PlatePurpose</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:plate_purpose_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_asset_shape_id'>asset_shape_id</span> <span class='op'>=</span> <span class='id identifier rubyid_plate_purpose'>plate_purpose</span><span class='period'>.</span><span class='id identifier rubyid_asset_shape_id'>asset_shape_id</span>

    <span class='comment'># Configure the cherrypicking action based on the parameters
</span>    <span class='id identifier rubyid_cherrypicker'>cherrypicker</span> <span class='op'>=</span> <span class='kw'>case</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:cherrypick_action</span><span class='rbracket'>]</span>
      <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>nano_grams_per_micro_litre</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>then</span> <span class='id identifier rubyid_create_nano_grams_per_micro_litre_picker'>create_nano_grams_per_micro_litre_picker</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='rparen'>)</span>
      <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>nano_grams</span><span class='tstring_end'>&#39;</span></span>                 <span class='kw'>then</span> <span class='id identifier rubyid_create_nano_grams_picker'>create_nano_grams_picker</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='rparen'>)</span>
      <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>micro_litre</span><span class='tstring_end'>&#39;</span></span>                <span class='kw'>then</span> <span class='id identifier rubyid_create_micro_litre_picker'>create_micro_litre_picker</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='rparen'>)</span>
      <span class='kw'>else</span> <span class='id identifier rubyid_raise'>raise</span> <span class='const'>StandardError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid cherrypicking type </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:cherrypick_action</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='comment'># We can preload the well locations so that we can do efficient lookup later.
</span>    <span class='id identifier rubyid_well_locations'>well_locations</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='lbracket'>[</span><span class='const'>Map</span><span class='period'>.</span><span class='id identifier rubyid_where_plate_size'>where_plate_size</span><span class='lparen'>(</span><span class='id identifier rubyid_partial_plate'>partial_plate</span><span class='period'>.</span><span class='id identifier rubyid_try'>try</span><span class='lparen'>(</span><span class='symbol'>:size</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='id identifier rubyid_size'>size</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_where_plate_shape'>where_plate_shape</span><span class='lparen'>(</span><span class='id identifier rubyid_partial_plate'>partial_plate</span><span class='period'>.</span><span class='id identifier rubyid_try'>try</span><span class='lparen'>(</span><span class='symbol'>:asset_shape</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='id identifier rubyid_asset_shape_id'>asset_shape_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_in_row_major_order'>in_row_major_order</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_location'>location</span><span class='op'>|</span>
      <span class='lbracket'>[</span><span class='id identifier rubyid_location'>location</span><span class='period'>.</span><span class='id identifier rubyid_description'>description</span><span class='comma'>,</span> <span class='id identifier rubyid_location'>location</span><span class='rbracket'>]</span>
    <span class='kw'>end</span><span class='rbracket'>]</span>

    <span class='comment'># All of the requests we&#39;re going to be using should be part of the batch.  If they are not
</span>    <span class='comment'># then we have an error, so we can pre-map them for quick lookup.  We&#39;re going to pre-cache a
</span>    <span class='comment'># whole load of wells so that they can be retrieved quickly and easily.
</span>    <span class='id identifier rubyid_wells'>wells</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='lbracket'>[</span><span class='const'>Well</span><span class='period'>.</span><span class='id identifier rubyid_includes'>includes</span><span class='lparen'>(</span><span class='symbol'>:well_attribute</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_requests'>requests</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:target_asset_id</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_w'>w</span><span class='op'>|</span> <span class='lbracket'>[</span><span class='id identifier rubyid_w'>w</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_w'>w</span><span class='rbracket'>]</span> <span class='rbrace'>}</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_request_and_well'>request_and_well</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='lbracket'>[</span><span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_requests'>requests</span><span class='period'>.</span><span class='id identifier rubyid_includes'>includes</span><span class='lparen'>(</span><span class='symbol'>:request_metadata</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_r'>r</span><span class='op'>|</span> <span class='lbracket'>[</span><span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_r'>r</span><span class='comma'>,</span> <span class='id identifier rubyid_wells'>wells</span><span class='lbracket'>[</span><span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_target_asset_id'>target_asset_id</span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='rbrace'>}</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_used_requests'>used_requests</span><span class='comma'>,</span> <span class='id identifier rubyid_plates_and_wells'>plates_and_wells</span><span class='comma'>,</span> <span class='id identifier rubyid_plate_and_requests'>plate_and_requests</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_h'>h</span><span class='comma'>,</span> <span class='id identifier rubyid_k'>k</span><span class='op'>|</span> <span class='id identifier rubyid_h'>h</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='rbrace'>}</span><span class='comma'>,</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_h'>h</span><span class='comma'>,</span> <span class='id identifier rubyid_k'>k</span><span class='op'>|</span> <span class='id identifier rubyid_h'>h</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='rbrace'>}</span>

    <span class='comment'># If we overflow the plate we create a new one, even if we subsequently clear the fields.
</span>    <span class='id identifier rubyid_plates_with_samples'>plates_with_samples</span> <span class='op'>=</span> <span class='id identifier rubyid_plates'>plates</span><span class='period'>.</span><span class='id identifier rubyid_reject'>reject</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_pid'>pid</span><span class='comma'>,</span> <span class='id identifier rubyid_rows'>rows</span><span class='op'>|</span> <span class='id identifier rubyid_rows'>rows</span><span class='period'>.</span><span class='id identifier rubyid_values'>values</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:values</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_flatten'>flatten</span><span class='period'>.</span><span class='id identifier rubyid_all?'>all?</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:empty?</span><span class='rparen'>)</span> <span class='rbrace'>}</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_fluidigm_plate'>fluidigm_plate</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_plates_with_samples'>plates_with_samples</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span> <span class='op'>&gt;</span> <span class='int'>1</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Cherrypick</span><span class='op'>::</span><span class='const'>Error</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Sorry, You cannot pick to multiple fluidigm plates in one batch.</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_plates_with_samples'>plates_with_samples</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_plate_params'>plate_params</span><span class='op'>|</span>
      <span class='comment'># The first time round this loop we&#39;ll either have a plate, from the partial_plate, or we&#39;ll
</span>      <span class='comment'># be needing to create a new one.
</span>      <span class='id identifier rubyid_plate'>plate</span> <span class='op'>=</span> <span class='id identifier rubyid_partial_plate'>partial_plate</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_plate'>plate</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='id identifier rubyid_barcode'>barcode</span> <span class='op'>=</span> <span class='const'>PlateBarcode</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='period'>.</span><span class='id identifier rubyid_barcode'>barcode</span>
        <span class='id identifier rubyid_plate'>plate</span>   <span class='op'>=</span> <span class='id identifier rubyid_plate_purpose'>plate_purpose</span><span class='period'>.</span><span class='id identifier rubyid_create!'>create!</span><span class='lparen'>(</span><span class='symbol'>:do_not_create_wells</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Cherrypicked </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_barcode'>barcode</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>size:</span> <span class='id identifier rubyid_size'>size</span><span class='comma'>,</span> <span class='label'>barcode:</span> <span class='id identifier rubyid_barcode'>barcode</span><span class='comma'>,</span> <span class='label'>plate_metadata_attributes:</span> <span class='lbrace'>{</span> <span class='label'>fluidigm_barcode:</span> <span class='id identifier rubyid_fluidigm_plate'>fluidigm_plate</span> <span class='rbrace'>}</span><span class='rparen'>)</span>
      <span class='kw'>end</span>

      <span class='comment'># Set the plate type, regardless of what it was.  This may change the standard plate.
</span>      <span class='id identifier rubyid_plate'>plate</span><span class='period'>.</span><span class='id identifier rubyid_set_plate_type'>set_plate_type</span><span class='lparen'>(</span><span class='id identifier rubyid_plate_type'>plate_type</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_plate_type'>plate_type</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

      <span class='id identifier rubyid_plate_params'>plate_params</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_row'>row</span><span class='comma'>,</span> <span class='id identifier rubyid_row_params'>row_params</span><span class='op'>|</span>
        <span class='id identifier rubyid_row'>row</span> <span class='op'>=</span> <span class='id identifier rubyid_row'>row</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
        <span class='id identifier rubyid_row_params'>row_params</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_col'>col</span><span class='comma'>,</span> <span class='id identifier rubyid_request_id'>request_id</span><span class='op'>|</span>
          <span class='id identifier rubyid_request'>request</span><span class='comma'>,</span> <span class='id identifier rubyid_well'>well</span> <span class='op'>=</span> <span class='kw'>case</span>
            <span class='kw'>when</span> <span class='id identifier rubyid_request_id'>request_id</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>           <span class='kw'>then</span> <span class='kw'>next</span>
            <span class='kw'>when</span> <span class='id identifier rubyid_request_id'>request_id</span><span class='period'>.</span><span class='id identifier rubyid_match'>match</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>control</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span> <span class='kw'>then</span> <span class='id identifier rubyid_create_control_request_and_add_to_batch'>create_control_request_and_add_to_batch</span><span class='lparen'>(</span><span class='id identifier rubyid_task'>task</span><span class='comma'>,</span> <span class='id identifier rubyid_request_id'>request_id</span><span class='rparen'>)</span>
            <span class='kw'>else</span> <span class='id identifier rubyid_request_and_well'>request_and_well</span><span class='lbracket'>[</span><span class='id identifier rubyid_request_id'>request_id</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>well_</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='rbracket'>]</span> <span class='kw'>or</span> <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>RecordNotFound</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Cannot find request </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_request_id'>request_id</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
          <span class='kw'>end</span>

          <span class='comment'># NOTE: Performance enhancement here
</span>          <span class='comment'># This collects the wells together for the plate they should be on, and modifies
</span>          <span class='comment'># the values in the well data.  It *does not* save either of these, which means that
</span>          <span class='comment'># SELECT &amp; INSERT/UPDATE are not interleaved, which affects the cache
</span>          <span class='id identifier rubyid_well'>well</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='op'>=</span> <span class='id identifier rubyid_well_locations'>well_locations</span><span class='lbracket'>[</span><span class='id identifier rubyid_plate'>plate</span><span class='period'>.</span><span class='id identifier rubyid_asset_shape'>asset_shape</span><span class='period'>.</span><span class='id identifier rubyid_location_from_row_and_column'>location_from_row_and_column</span><span class='lparen'>(</span><span class='id identifier rubyid_row'>row</span><span class='comma'>,</span> <span class='id identifier rubyid_col'>col</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>+</span> <span class='int'>1</span><span class='comma'>,</span> <span class='id identifier rubyid_plate'>plate</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='rparen'>)</span><span class='rbracket'>]</span>
          <span class='id identifier rubyid_cherrypicker'>cherrypicker</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_well'>well</span><span class='comma'>,</span> <span class='id identifier rubyid_request'>request</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_plates_and_wells'>plates_and_wells</span><span class='lbracket'>[</span><span class='id identifier rubyid_plate'>plate</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_well'>well</span>
          <span class='id identifier rubyid_plate_and_requests'>plate_and_requests</span><span class='lbracket'>[</span><span class='id identifier rubyid_plate'>plate</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_request'>request</span>
          <span class='id identifier rubyid_used_requests'>used_requests</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_request'>request</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>

      <span class='comment'># At this point we can consider ourselves finished with the partial plate
</span>      <span class='id identifier rubyid_partial_plate'>partial_plate</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='kw'>end</span>

    <span class='comment'># Attach the wells into their plate for maximum efficiency.
</span>    <span class='id identifier rubyid_plates_and_wells'>plates_and_wells</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_plate'>plate</span><span class='comma'>,</span> <span class='id identifier rubyid_wells'>wells</span><span class='op'>|</span>
      <span class='id identifier rubyid_wells'>wells</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_w'>w</span><span class='op'>|</span> <span class='id identifier rubyid_w'>w</span><span class='period'>.</span><span class='id identifier rubyid_well_attribute'>well_attribute</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span><span class='semicolon'>;</span> <span class='id identifier rubyid_w'>w</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span> <span class='rbrace'>}</span>
      <span class='id identifier rubyid_plate'>plate</span><span class='period'>.</span><span class='id identifier rubyid_wells'>wells</span><span class='period'>.</span><span class='id identifier rubyid_attach'>attach</span><span class='lparen'>(</span><span class='id identifier rubyid_wells'>wells</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_plate_and_requests'>plate_and_requests</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_target_plate'>target_plate</span><span class='comma'>,</span> <span class='id identifier rubyid_requests'>requests</span><span class='op'>|</span>
      <span class='const'>Plate</span><span class='period'>.</span><span class='id identifier rubyid_with_requests'>with_requests</span><span class='lparen'>(</span><span class='id identifier rubyid_requests'>requests</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_source_plate'>source_plate</span><span class='op'>|</span>
        <span class='const'>AssetLink</span><span class='op'>::</span><span class='const'>Job</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='id identifier rubyid_source_plate'>source_plate</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_target_plate'>target_plate</span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># Now pass each of the requests we used and ditch any there weren&#39;t back into the inbox.
</span>    <span class='id identifier rubyid_used_requests'>used_requests</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:pass!</span><span class='rparen'>)</span>
    <span class='lparen'>(</span><span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_requests'>requests</span> <span class='op'>-</span> <span class='id identifier rubyid_used_requests'>used_requests</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_unused_request'>unused_request</span><span class='op'>|</span>
      <span class='id identifier rubyid_unused_request'>unused_request</span><span class='period'>.</span><span class='id identifier rubyid_recycle_from_batch!'>recycle_from_batch!</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="render_cherrypick_task-instance_method">
  
    #<strong>render_cherrypick_task</strong>(task, params)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/tasks/cherrypick_handler.rb', line 14</span>

<span class='kw'>def</span> <span class='id identifier rubyid_render_cherrypick_task'>render_cherrypick_task</span><span class='lparen'>(</span><span class='id identifier rubyid_task'>task</span><span class='comma'>,</span> <span class='id identifier rubyid_params'>params</span><span class='rparen'>)</span>
  <span class='kw'>unless</span> <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:error</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
    <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='label'>action:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>stage</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>batch_id:</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='label'>workflow_id:</span> <span class='ivar'>@workflow</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='label'>id:</span> <span class='lparen'>(</span><span class='ivar'>@stage</span> <span class='op'>-</span> <span class='int'>1</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
    <span class='kw'>return</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_plate_template'>plate_template</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>unless</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:plate_template</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
    <span class='id identifier rubyid_plate_template'>plate_template</span> <span class='op'>=</span> <span class='const'>PlateTemplate</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:plate_template</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>0</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_plate_template'>plate_template</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:error</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Please select a template</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='label'>action:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>stage</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>batch_id:</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='label'>workflow_id:</span> <span class='ivar'>@workflow</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='label'>id:</span> <span class='lparen'>(</span><span class='ivar'>@stage</span> <span class='op'>-</span> <span class='int'>1</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
    <span class='kw'>return</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_setup_input_params_for_pass_through'>setup_input_params_for_pass_through</span>

  <span class='ivar'>@batch</span> <span class='op'>=</span> <span class='const'>Batch</span><span class='period'>.</span><span class='id identifier rubyid_includes'>includes</span><span class='lparen'>(</span><span class='symbol'>:requests</span><span class='comma'>,</span> <span class='symbol'>:pipeline</span><span class='comma'>,</span> <span class='symbol'>:lab_events</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:batch_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='ivar'>@requests</span> <span class='op'>=</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_ordered_requests'>ordered_requests</span>

  <span class='ivar'>@plate</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@plate_barcode</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:existing_plate</span><span class='rbracket'>]</span>
  <span class='ivar'>@fluidigm_plate</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:fluidigm_plate</span><span class='rbracket'>]</span>

  <span class='kw'>if</span> <span class='ivar'>@plate_barcode</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
    <span class='id identifier rubyid_plate_barcode_id'>plate_barcode_id</span> <span class='op'>=</span> <span class='ivar'>@plate_barcode</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>&gt;</span> <span class='int'>11</span> <span class='op'>?</span> <span class='const'>Barcode</span><span class='period'>.</span><span class='id identifier rubyid_number_to_human'>number_to_human</span><span class='lparen'>(</span><span class='ivar'>@plate_barcode</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='ivar'>@plate_barcode</span>
    <span class='ivar'>@plate</span> <span class='op'>=</span> <span class='const'>Plate</span><span class='period'>.</span><span class='id identifier rubyid_find_by_barcode'>find_by_barcode</span><span class='lparen'>(</span><span class='id identifier rubyid_plate_barcode_id'>plate_barcode_id</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='ivar'>@plate</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:error</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid plate barcode</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='label'>action:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>stage</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>batch_id:</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='label'>workflow_id:</span> <span class='ivar'>@workflow</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='label'>id:</span> <span class='lparen'>(</span><span class='ivar'>@stage</span> <span class='op'>-</span> <span class='int'>1</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
      <span class='kw'>return</span>
    <span class='kw'>end</span>
  <span class='kw'>elsif</span> <span class='ivar'>@fluidigm_plate</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
    <span class='kw'>if</span> <span class='ivar'>@fluidigm_plate</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;</span> <span class='int'>10</span>
      <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:error</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid fluidigm barcode</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='label'>action:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>stage</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>batch_id:</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='label'>workflow_id:</span> <span class='ivar'>@workflow</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='label'>id:</span> <span class='lparen'>(</span><span class='ivar'>@stage</span> <span class='op'>-</span> <span class='int'>1</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
      <span class='kw'>return</span>
    <span class='kw'>end</span>
    <span class='ivar'>@plate</span> <span class='op'>=</span> <span class='const'>Plate</span><span class='op'>::</span><span class='const'>Metadata</span><span class='period'>.</span><span class='id identifier rubyid_includes'>includes</span><span class='lparen'>(</span><span class='symbol'>:plate</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>fluidigm_barcode:</span> <span class='ivar'>@fluidigm_barcode</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_try'>try</span><span class='lparen'>(</span><span class='symbol'>:plate</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='ivar'>@plate_purpose</span> <span class='op'>=</span> <span class='const'>PlatePurpose</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:plate_purpose_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_flash'>flash</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='lbracket'>[</span><span class='symbol'>:warning</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>I18n</span><span class='period'>.</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cherrypick.picking_by_row</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='ivar'>@plate_purpose</span><span class='period'>.</span><span class='id identifier rubyid_cherrypick_in_rows?'>cherrypick_in_rows?</span>

  <span class='ivar'>@workflow</span> <span class='op'>=</span> <span class='const'>LabInterface</span><span class='op'>::</span><span class='const'>Workflow</span><span class='period'>.</span><span class='id identifier rubyid_includes'>includes</span><span class='lparen'>(</span><span class='symbol'>:tasks</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:workflow_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='ivar'>@map_info</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='ivar'>@spreadsheet_layout</span>
    <span class='ivar'>@spreadsheet_layout</span>
              <span class='kw'>elsif</span> <span class='ivar'>@plate</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
    <span class='ivar'>@task</span><span class='period'>.</span><span class='id identifier rubyid_pick_onto_partial_plate'>pick_onto_partial_plate</span><span class='lparen'>(</span><span class='ivar'>@requests</span><span class='comma'>,</span> <span class='id identifier rubyid_plate_template'>plate_template</span><span class='comma'>,</span> <span class='ivar'>@robot</span><span class='comma'>,</span> <span class='ivar'>@batch</span><span class='comma'>,</span> <span class='ivar'>@plate</span><span class='rparen'>)</span>
              <span class='kw'>else</span>
    <span class='ivar'>@task</span><span class='period'>.</span><span class='id identifier rubyid_pick_new_plate'>pick_new_plate</span><span class='lparen'>(</span><span class='ivar'>@requests</span><span class='comma'>,</span> <span class='id identifier rubyid_plate_template'>plate_template</span><span class='comma'>,</span> <span class='ivar'>@robot</span><span class='comma'>,</span> <span class='ivar'>@batch</span><span class='comma'>,</span> <span class='ivar'>@plate_purpose</span><span class='rparen'>)</span>
              <span class='kw'>end</span>
  <span class='ivar'>@plates</span> <span class='op'>=</span> <span class='ivar'>@map_info</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
  <span class='ivar'>@source_plate_ids</span> <span class='op'>=</span> <span class='ivar'>@map_info</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>

  <span class='ivar'>@plate_cols</span> <span class='op'>=</span> <span class='ivar'>@plate</span><span class='period'>.</span><span class='id identifier rubyid_try'>try</span><span class='lparen'>(</span><span class='symbol'>:width</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='ivar'>@plate_purpose</span><span class='period'>.</span><span class='id identifier rubyid_plate_width'>plate_width</span>
  <span class='ivar'>@plate_rows</span> <span class='op'>=</span> <span class='ivar'>@plate</span><span class='period'>.</span><span class='id identifier rubyid_try'>try</span><span class='lparen'>(</span><span class='symbol'>:height</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='ivar'>@plate_purpose</span><span class='period'>.</span><span class='id identifier rubyid_plate_height'>plate_height</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="setup_input_params_for_pass_through-instance_method">
  
    #<strong>setup_input_params_for_pass_through</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


74
75
76
77
78
79
80
81
82
83
84
85
86
87</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/tasks/cherrypick_handler.rb', line 74</span>

<span class='kw'>def</span> <span class='id identifier rubyid_setup_input_params_for_pass_through'>setup_input_params_for_pass_through</span>
  <span class='ivar'>@robot_id</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:robot_id</span><span class='rbracket'>]</span>
  <span class='ivar'>@robot</span> <span class='op'>=</span> <span class='const'>Robot</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='ivar'>@robot_id</span><span class='rparen'>)</span>
  <span class='ivar'>@plate_type</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:plate_type</span><span class='rbracket'>]</span>
  <span class='ivar'>@volume_required</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:volume_required</span><span class='rbracket'>]</span>
  <span class='ivar'>@micro_litre_volume_required</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:micro_litre_volume_required</span><span class='rbracket'>]</span>
  <span class='ivar'>@concentration_required</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:concentration_required</span><span class='rbracket'>]</span>
  <span class='ivar'>@minimum_volume</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:minimum_volume</span><span class='rbracket'>]</span>
  <span class='ivar'>@maximum_volume</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:maximum_volume</span><span class='rbracket'>]</span>
  <span class='ivar'>@total_nano_grams</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:total_nano_grams</span><span class='rbracket'>]</span>
  <span class='ivar'>@cherrypick_action</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:cherrypick</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:action</span><span class='rbracket'>]</span>
  <span class='ivar'>@plate_purpose_id</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:plate_purpose_id</span><span class='rbracket'>]</span>
  <span class='ivar'>@fluidigm_barcode</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:fluidigm_plate</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Mon Dec 19 11:16:29 2016 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.5 (ruby-2.3.3).
</div>

    </div>
  </body>
</html>