<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: BatchesController
  
    &mdash; Documentation by YARD 0.9.5
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "BatchesController";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index (B)</a> &raquo;
    
    
    <span class="title">BatchesController</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <iframe id="search_frame" src="class_list.html"></iframe>

      <div id="content"><h1>Class: BatchesController
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName"><span class='object_link'><a href="ApplicationController.html" title="ApplicationController (class)">ApplicationController</a></span></span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">ActionController::Base</li>
          
            <li class="next"><span class='object_link'><a href="ApplicationController.html" title="ApplicationController (class)">ApplicationController</a></span></li>
          
            <li class="next">BatchesController</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  <dl>
      <dt>Includes:</dt>
      <dd><span class='object_link'><a href="XmlCacheHelper/ControllerHelper.html" title="XmlCacheHelper::ControllerHelper (module)">XmlCacheHelper::ControllerHelper</a></span></dd>
  </dl>
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>app/controllers/batches_controller.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>This file is part of SEQUENCESCAPE; it is distributed under the terms of
GNU General Public License version 1 or later; Please refer to the LICENSE
and README files for information on licensing and authorship of this file.
Copyright (C) 2007-2011,2012,2013,2014,2015 Genome Research Ltd.</p>


  </div>
</div>
<div class="tags">
  

</div>






  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#add_control-instance_method" title="#add_control (instance method)">#<strong>add_control</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#batch_parameters-instance_method" title="#batch_parameters (instance method)">#<strong>batch_parameters</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#completed-instance_method" title="#completed (instance method)">#<strong>completed</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#control-instance_method" title="#control (instance method)">#<strong>control</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create-instance_method" title="#create (instance method)">#<strong>create</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create_training_batch-instance_method" title="#create_training_batch (instance method)">#<strong>create_training_batch</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#download_spreadsheet-instance_method" title="#download_spreadsheet (instance method)">#<strong>download_spreadsheet</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#edit-instance_method" title="#edit (instance method)">#<strong>edit</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#edit_volume_and_concentration-instance_method" title="#edit_volume_and_concentration (instance method)">#<strong>edit_volume_and_concentration</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#evaluations_counter-instance_method" title="#evaluations_counter (instance method)">#<strong>evaluations_counter</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#fail-instance_method" title="#fail (instance method)">#<strong>fail</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#fail_items-instance_method" title="#fail_items (instance method)">#<strong>fail_items</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#failed-instance_method" title="#failed (instance method)">#<strong>failed</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#filtered-instance_method" title="#filtered (instance method)">#<strong>filtered</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#find_batch_by_barcode-instance_method" title="#find_batch_by_barcode (instance method)">#<strong>find_batch_by_barcode</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#find_batch_by_batch_id-instance_method" title="#find_batch_by_batch_id (instance method)">#<strong>find_batch_by_batch_id</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#find_batch_by_id-instance_method" title="#find_batch_by_id (instance method)">#<strong>find_batch_by_id</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#gwl_file-instance_method" title="#gwl_file (instance method)">#<strong>gwl_file</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#index-instance_method" title="#index (instance method)">#<strong>index</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#new_stock_assets-instance_method" title="#new_stock_assets (instance method)">#<strong>new_stock_assets</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#pacbio_sample_sheet-instance_method" title="#pacbio_sample_sheet (instance method)">#<strong>pacbio_sample_sheet</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#pending-instance_method" title="#pending (instance method)">#<strong>pending</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#pipeline-instance_method" title="#pipeline (instance method)">#<strong>pipeline</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#previous_qc_state-instance_method" title="#previous_qc_state (instance method)">#<strong>previous_qc_state</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#print-instance_method" title="#print (instance method)">#<strong>print</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#print_barcodes-instance_method" title="#print_barcodes (instance method)">#<strong>print_barcodes</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#print_labels-instance_method" title="#print_labels (instance method)">#<strong>print_labels</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#print_multiplex_barcodes-instance_method" title="#print_multiplex_barcodes (instance method)">#<strong>print_multiplex_barcodes</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#print_multiplex_labels-instance_method" title="#print_multiplex_labels (instance method)">#<strong>print_multiplex_labels</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#print_plate_barcodes-instance_method" title="#print_plate_barcodes (instance method)">#<strong>print_plate_barcodes</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#print_plate_labels-instance_method" title="#print_plate_labels (instance method)">#<strong>print_plate_labels</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#print_stock_labels-instance_method" title="#print_stock_labels (instance method)">#<strong>print_stock_labels</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#print_stock_multiplex_labels-instance_method" title="#print_stock_multiplex_labels (instance method)">#<strong>print_stock_multiplex_labels</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#pulldown_batch_report-instance_method" title="#pulldown_batch_report (instance method)">#<strong>pulldown_batch_report</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#qc_batch-instance_method" title="#qc_batch (instance method)">#<strong>qc_batch</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Deals with QC failures leaving batches and items statuses intact.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#qc_information-instance_method" title="#qc_information (instance method)">#<strong>qc_information</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#quality_control-instance_method" title="#quality_control (instance method)">#<strong>quality_control</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#released-instance_method" title="#released (instance method)">#<strong>released</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#reset_batch-instance_method" title="#reset_batch (instance method)">#<strong>reset_batch</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#sample_prep_worksheet-instance_method" title="#sample_prep_worksheet (instance method)">#<strong>sample_prep_worksheet</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#save-instance_method" title="#save (instance method)">#<strong>save</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#show-instance_method" title="#show (instance method)">#<strong>show</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#sort-instance_method" title="#sort (instance method)">#<strong>sort</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#start_automatic_qc-instance_method" title="#start_automatic_qc (instance method)">#<strong>start_automatic_qc</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Used by Quality Control Pipeline view or remote sources to add a Batch ID
to QC queue.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#started-instance_method" title="#started (instance method)">#<strong>started</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#swap-instance_method" title="#swap (instance method)">#<strong>swap</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update-instance_method" title="#update (instance method)">#<strong>update</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_volume_and_concentration-instance_method" title="#update_volume_and_concentration (instance method)">#<strong>update_volume_and_concentration</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#verify-instance_method" title="#verify (instance method)">#<strong>verify</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#verify_tube_layout-instance_method" title="#verify_tube_layout (instance method)">#<strong>verify_tube_layout</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="ApplicationController.html" title="ApplicationController (class)">ApplicationController</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="ApplicationController.html#block_api_access-instance_method" title="ApplicationController#block_api_access (method)">#block_api_access</a></span>, <span class='object_link'><a href="ApplicationController.html#clean_params_from_check-instance_method" title="ApplicationController#clean_params_from_check (method)">#clean_params_from_check</a></span>, <span class='object_link'><a href="ApplicationController.html#evil_parameter_hack%21-instance_method" title="ApplicationController#evil_parameter_hack! (method)">#evil_parameter_hack!</a></span>, <span class='object_link'><a href="ApplicationController.html#extract_header_info-instance_method" title="ApplicationController#extract_header_info (method)">#extract_header_info</a></span>, <span class='object_link'><a href="ApplicationController.html#first_param-instance_method" title="ApplicationController#first_param (method)">#first_param</a></span>, <span class='object_link'><a href="ApplicationController.html#set_cache_disabled%21-instance_method" title="ApplicationController#set_cache_disabled! (method)">#set_cache_disabled!</a></span></p>

  
  
  
  
  
  
  

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="add_control-instance_method">
  
    #<strong>add_control</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 301</span>

<span class='kw'>def</span> <span class='id identifier rubyid_add_control'>add_control</span>
  <span class='ivar'>@control</span> <span class='op'>=</span> <span class='const'>Control</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:control</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_control_count'>control_count</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:control</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:count</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_control_count'>control_count</span> <span class='op'>&gt;</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_space_left'>space_left</span>
    <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:error</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Can&#39;t assign more than </span><span class='embexpr_beg'>#{</span><span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_space_left'>space_left</span><span class='embexpr_end'>}</span><span class='tstring_content'> control to this batch</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='label'>action:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>control</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>id:</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
    <span class='kw'>return</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_control_count'>control_count</span> <span class='op'>&lt;</span> <span class='int'>0</span>
    <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:error</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>This batch needs at least one control</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='label'>action:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>control</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>id:</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
    <span class='kw'>return</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_control_count'>control_count</span> <span class='op'>=</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_add_control'>add_control</span><span class='lparen'>(</span><span class='ivar'>@control</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_control_count'>control_count</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_batch_path'>batch_path</span><span class='lparen'>(</span><span class='ivar'>@batch</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="batch_parameters-instance_method">
  
    #<strong>batch_parameters</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


79
80
81</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 79</span>

<span class='kw'>def</span> <span class='id identifier rubyid_batch_parameters'>batch_parameters</span>
  <span class='ivar'>@bp</span> <span class='op'>||=</span> <span class='id identifier rubyid_params'>params</span><span class='period'>.</span><span class='id identifier rubyid_require'>require</span><span class='lparen'>(</span><span class='symbol'>:batch</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_permit'>permit</span><span class='lparen'>(</span><span class='symbol'>:assignee_id</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="completed-instance_method">
  
    #<strong>completed</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


217
218
219
220
221
222</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 217</span>

<span class='kw'>def</span> <span class='id identifier rubyid_completed'>completed</span>
  <span class='comment'># The params fallback here reflects an older route where pipeline got passed in as :id. It should be removed
</span>  <span class='comment'># in the near future.
</span>  <span class='ivar'>@pipeline</span> <span class='op'>=</span> <span class='const'>Pipeline</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:pipeline_id</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='ivar'>@batches</span> <span class='op'>=</span> <span class='ivar'>@pipeline</span><span class='period'>.</span><span class='id identifier rubyid_batches'>batches</span><span class='period'>.</span><span class='id identifier rubyid_completed'>completed</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>id:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_includes'>includes</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='symbol'>:user</span><span class='comma'>,</span> <span class='symbol'>:pipeline</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_page'>page</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:page</span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="control-instance_method">
  
    #<strong>control</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


296
297
298
299</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 296</span>

<span class='kw'>def</span> <span class='id identifier rubyid_control'>control</span>
  <span class='ivar'>@rits</span> <span class='op'>=</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_pipeline'>pipeline</span><span class='period'>.</span><span class='id identifier rubyid_request_information_types'>request_information_types</span>
  <span class='ivar'>@controls</span> <span class='op'>=</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_pipeline'>pipeline</span><span class='period'>.</span><span class='id identifier rubyid_controls'>controls</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="create-instance_method">
  
    #<strong>create</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 83</span>

<span class='kw'>def</span> <span class='id identifier rubyid_create'>create</span>
    <span class='ivar'>@pipeline</span> <span class='op'>=</span> <span class='const'>Pipeline</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>

    <span class='comment'># TODO: These should be different endpoints
</span>    <span class='id identifier rubyid_requests'>requests</span> <span class='op'>=</span> <span class='ivar'>@pipeline</span><span class='period'>.</span><span class='id identifier rubyid_extract_requests_from_input_params'>extract_requests_from_input_params</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='rparen'>)</span>

    <span class='kw'>case</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:action_on_requests</span><span class='rbracket'>]</span>
    <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cancel_requests</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>return</span> <span class='id identifier rubyid_cancel_requests'>cancel_requests</span><span class='lparen'>(</span><span class='id identifier rubyid_requests'>requests</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>hide_from_inbox</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>return</span> <span class='id identifier rubyid_hide_from_inbox'>hide_from_inbox</span><span class='lparen'>(</span><span class='id identifier rubyid_requests'>requests</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='comment'># This is the standard create action
</span>      <span class='id identifier rubyid_standard_create'>standard_create</span><span class='lparen'>(</span><span class='id identifier rubyid_requests'>requests</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
<span class='kw'>rescue</span> <span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>RecordInvalid</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_exception'>exception</span>
  <span class='id identifier rubyid_respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
    <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_html'>html</span> <span class='lbrace'>{</span>
      <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:error</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_exception'>exception</span><span class='period'>.</span><span class='id identifier rubyid_record'>record</span><span class='period'>.</span><span class='id identifier rubyid_errors'>errors</span><span class='period'>.</span><span class='id identifier rubyid_full_messages'>full_messages</span>
      <span class='id identifier rubyid_redirect_to'>redirect_to</span><span class='lparen'>(</span><span class='id identifier rubyid_pipeline_path'>pipeline_path</span><span class='lparen'>(</span><span class='ivar'>@pipeline</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='rbrace'>}</span>
    <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_xml'>xml</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_render'>render</span> <span class='label'>xml:</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_errors'>errors</span><span class='period'>.</span><span class='id identifier rubyid_to_xml'>to_xml</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="create_training_batch-instance_method">
  
    #<strong>create_training_batch</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


319
320
321
322
323
324
325
326
327
328
329</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 319</span>

<span class='kw'>def</span> <span class='id identifier rubyid_create_training_batch'>create_training_batch</span>
  <span class='id identifier rubyid_control'>control</span> <span class='op'>=</span> <span class='const'>Control</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:control</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_pipeline'>pipeline</span> <span class='op'>=</span> <span class='id identifier rubyid_control'>control</span><span class='period'>.</span><span class='id identifier rubyid_pipeline'>pipeline</span>
  <span class='id identifier rubyid_limit'>limit</span> <span class='op'>=</span> <span class='id identifier rubyid_pipeline'>pipeline</span><span class='period'>.</span><span class='id identifier rubyid_item_limit'>item_limit</span>

  <span class='id identifier rubyid_batch'>batch</span> <span class='op'>=</span> <span class='id identifier rubyid_pipeline'>pipeline</span><span class='period'>.</span><span class='id identifier rubyid_batches'>batches</span><span class='period'>.</span><span class='id identifier rubyid_create!'>create!</span><span class='lparen'>(</span><span class='label'>item_limit:</span> <span class='id identifier rubyid_limit'>limit</span><span class='comma'>,</span> <span class='label'>user_id:</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_batch'>batch</span><span class='period'>.</span><span class='id identifier rubyid_add_control'>add_control</span><span class='lparen'>(</span><span class='id identifier rubyid_control'>control</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_pipeline'>pipeline</span><span class='period'>.</span><span class='id identifier rubyid_item_limit'>item_limit</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:notice</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Training batch created</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='label'>action:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>show</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>id:</span> <span class='id identifier rubyid_batch'>batch</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="download_spreadsheet-instance_method">
  
    #<strong>download_spreadsheet</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


525
526
527
528
529
530</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 525</span>

<span class='kw'>def</span> <span class='id identifier rubyid_download_spreadsheet'>download_spreadsheet</span>
  <span class='id identifier rubyid_csv_string'>csv_string</span> <span class='op'>=</span> <span class='const'>Tasks</span><span class='op'>::</span><span class='const'>PlateTemplateHandler</span><span class='period'>.</span><span class='id identifier rubyid_generate_spreadsheet'>generate_spreadsheet</span><span class='lparen'>(</span><span class='ivar'>@batch</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_send_data'>send_data</span> <span class='id identifier rubyid_csv_string'>csv_string</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>text/plain</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
   <span class='label'>filename:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_content'>_cherrypick_layout.csv</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
   <span class='label'>disposition:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>attachment</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="edit-instance_method">
  
    #<strong>edit</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


52
53
54
55
56
57</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 52</span>

<span class='kw'>def</span> <span class='id identifier rubyid_edit'>edit</span>
  <span class='ivar'>@rits</span> <span class='op'>=</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_pipeline'>pipeline</span><span class='period'>.</span><span class='id identifier rubyid_request_information_types'>request_information_types</span>
  <span class='ivar'>@requests</span> <span class='op'>=</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_ordered_requests'>ordered_requests</span>
  <span class='ivar'>@users</span> <span class='op'>=</span> <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
  <span class='ivar'>@controls</span> <span class='op'>=</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_pipeline'>pipeline</span><span class='period'>.</span><span class='id identifier rubyid_controls'>controls</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="edit_volume_and_concentration-instance_method">
  
    #<strong>edit_volume_and_concentration</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


583
584
585</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 583</span>

<span class='kw'>def</span> <span class='id identifier rubyid_edit_volume_and_concentration'>edit_volume_and_concentration</span>
  <span class='ivar'>@batch</span> <span class='op'>=</span> <span class='const'>Batch</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="evaluations_counter-instance_method">
  
    #<strong>evaluations_counter</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


331
332
333
334</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 331</span>

<span class='kw'>def</span> <span class='id identifier rubyid_evaluations_counter'>evaluations_counter</span>
  <span class='ivar'>@ev</span> <span class='op'>=</span> <span class='const'>BatchStatus</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_render'>render</span> <span class='label'>partial:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>evaluations_counter</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="fail-instance_method">
  
    #<strong>fail</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


231
232
233
234
235
236
237</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 231</span>

<span class='kw'>def</span> <span class='id identifier rubyid_fail'>fail</span>
  <span class='kw'>if</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span><span class='period'>.</span><span class='id identifier rubyid_source_is_internal?'>source_is_internal?</span>
    <span class='ivar'>@fail_reasons</span> <span class='op'>=</span> <span class='const'>FAILURE_REASONS</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>internal</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
  <span class='kw'>else</span>
    <span class='ivar'>@fail_reasons</span> <span class='op'>=</span> <span class='const'>FAILURE_REASONS</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>external</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="fail_items-instance_method">
  
    #<strong>fail_items</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 251</span>

<span class='kw'>def</span> <span class='id identifier rubyid_fail_items'>fail_items</span>
  <span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>Base</span><span class='period'>.</span><span class='id identifier rubyid_transaction'>transaction</span> <span class='kw'>do</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:failure</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:reason</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
      <span class='id identifier rubyid_reason'>reason</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:failure</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:reason</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_comment'>comment</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:failure</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:comment</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_requests'>requests</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:requested_fail</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
      <span class='id identifier rubyid_fail_but_charge'>fail_but_charge</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:failure</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:fail_but_charge</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>1</span><span class='tstring_end'>&#39;</span></span>
      <span class='id identifier rubyid_requests_for_removal'>requests_for_removal</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:requested_remove</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
      <span class='comment'># Check to see if the user is trying to remove AND fail the same request.
</span>      <span class='id identifier rubyid_diff'>diff</span> <span class='op'>=</span> <span class='id identifier rubyid_requests_for_removal'>requests_for_removal</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span> <span class='op'>&amp;</span> <span class='id identifier rubyid_requests'>requests</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span>

      <span class='kw'>unless</span> <span class='id identifier rubyid_diff'>diff</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
        <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:error</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Fail and remove were both selected for the following - </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_diff'>diff</span><span class='period'>.</span><span class='id identifier rubyid_to_sentence'>to_sentence</span><span class='embexpr_end'>}</span><span class='tstring_content'> this is not supported.</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>else</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_requests'>requests</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_requests_for_removal'>requests_for_removal</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
          <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:error</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Please select an item to fail or remove</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>else</span>
          <span class='kw'>unless</span> <span class='id identifier rubyid_requests'>requests</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
            <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_fail_batch_items'>fail_batch_items</span><span class='lparen'>(</span><span class='id identifier rubyid_requests'>requests</span><span class='comma'>,</span> <span class='id identifier rubyid_reason'>reason</span><span class='comma'>,</span> <span class='id identifier rubyid_comment'>comment</span><span class='comma'>,</span> <span class='id identifier rubyid_fail_but_charge'>fail_but_charge</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:notice</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_requests'>requests</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_to_sentence'>to_sentence</span><span class='embexpr_end'>}</span><span class='tstring_content'> set to failed.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_fail_but_charge'>fail_but_charge</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> The customer will still be charged.</span><span class='tstring_end'>&#39;</span></span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
          <span class='kw'>end</span>

          <span class='kw'>unless</span> <span class='id identifier rubyid_requests_for_removal'>requests_for_removal</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
            <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_remove_request_ids'>remove_request_ids</span><span class='lparen'>(</span><span class='id identifier rubyid_requests_for_removal'>requests_for_removal</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='comma'>,</span> <span class='id identifier rubyid_reason'>reason</span><span class='comma'>,</span> <span class='id identifier rubyid_comment'>comment</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:notice</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_requests_for_removal'>requests_for_removal</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_to_sentence'>to_sentence</span><span class='embexpr_end'>}</span><span class='tstring_content'> removed.</span><span class='tstring_end'>&quot;</span></span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='label'>action:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>fail</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>id:</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:error</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Please specify a failure reason for this batch</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='label'>action:</span> <span class='symbol'>:fail</span><span class='comma'>,</span> <span class='label'>id:</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="failed-instance_method">
  
    #<strong>failed</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


224
225
226
227
228
229</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 224</span>

<span class='kw'>def</span> <span class='id identifier rubyid_failed'>failed</span>
  <span class='comment'># The params fallback here reflects an older route where pipeline got passed in as :id. It should be removed
</span>  <span class='comment'># in the near future.
</span>  <span class='ivar'>@pipeline</span> <span class='op'>=</span> <span class='const'>Pipeline</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:pipeline_id</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='ivar'>@batches</span> <span class='op'>=</span> <span class='ivar'>@pipeline</span><span class='period'>.</span><span class='id identifier rubyid_batches'>batches</span><span class='period'>.</span><span class='id identifier rubyid_failed'>failed</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>id:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_includes'>includes</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='symbol'>:user</span><span class='comma'>,</span> <span class='symbol'>:pipeline</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_page'>page</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:page</span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="filtered-instance_method">
  
    #<strong>filtered</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


510
511</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 510</span>

<span class='kw'>def</span> <span class='id identifier rubyid_filtered'>filtered</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="find_batch_by_barcode-instance_method">
  
    #<strong>find_batch_by_barcode</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


621
622
623
624
625
626
627
628
629
630
631
632</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 621</span>

<span class='kw'>def</span> <span class='id identifier rubyid_find_batch_by_barcode'>find_batch_by_barcode</span>
  <span class='comment'># Caution! This isn&#39;t actually a rails finder.
</span>  <span class='id identifier rubyid_batch_id'>batch_id</span> <span class='op'>=</span> <span class='const'>LabEvent</span><span class='period'>.</span><span class='id identifier rubyid_find_by_barcode'>find_by_barcode</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_batch_id'>batch_id</span><span class='period'>.</span><span class='id identifier rubyid_zero?'>zero?</span>
    <span class='ivar'>@batch_error</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Batch id not found.</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_render'>render</span> <span class='label'>action:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>batch_error</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>format:</span> <span class='symbol'>:xml</span>
    <span class='kw'>return</span>
  <span class='kw'>else</span>
    <span class='ivar'>@batch</span> <span class='op'>=</span> <span class='const'>Batch</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_batch_id'>batch_id</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_render'>render</span> <span class='label'>action:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>show</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>format:</span> <span class='symbol'>:xml</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="find_batch_by_batch_id-instance_method">
  
    #<strong>find_batch_by_batch_id</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


546
547
548</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 546</span>

<span class='kw'>def</span> <span class='id identifier rubyid_find_batch_by_batch_id'>find_batch_by_batch_id</span>
  <span class='ivar'>@batch</span> <span class='op'>=</span> <span class='const'>Batch</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:batch_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="find_batch_by_id-instance_method">
  
    #<strong>find_batch_by_id</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


542
543
544</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 542</span>

<span class='kw'>def</span> <span class='id identifier rubyid_find_batch_by_id'>find_batch_by_id</span>
  <span class='ivar'>@batch</span> <span class='op'>=</span> <span class='const'>Batch</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="gwl_file-instance_method">
  
    #<strong>gwl_file</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


532
533
534
535
536
537
538
539
540</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 532</span>

<span class='kw'>def</span> <span class='id identifier rubyid_gwl_file'>gwl_file</span>
  <span class='ivar'>@plate_barcode</span> <span class='op'>=</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_plate_barcode'>plate_barcode</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:barcode</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_tecan_gwl_file_as_string'>tecan_gwl_file_as_string</span> <span class='op'>=</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_tecan_gwl_file_as_text'>tecan_gwl_file_as_text</span><span class='lparen'>(</span><span class='ivar'>@plate_barcode</span><span class='comma'>,</span>
                                                           <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_total_volume_to_cherrypick'>total_volume_to_cherrypick</span><span class='comma'>,</span>
                                                           <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:plate_type</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_send_data'>send_data</span> <span class='id identifier rubyid_tecan_gwl_file_as_string'>tecan_gwl_file_as_string</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>text/plain</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
   <span class='label'>filename:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_content'>_batch_</span><span class='embexpr_beg'>#{</span><span class='ivar'>@plate_barcode</span><span class='embexpr_end'>}</span><span class='tstring_content'>.gwl</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
   <span class='label'>disposition:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>attachment</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="index-instance_method">
  
    #<strong>index</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 18</span>

<span class='kw'>def</span> <span class='id identifier rubyid_index'>index</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_logged_in?'>logged_in?</span>
    <span class='ivar'>@user</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span>
    <span class='ivar'>@batches</span> <span class='op'>=</span> <span class='const'>Batch</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>assignee_id = :user OR user_id = :user</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>user:</span> <span class='ivar'>@user</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>id:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_page'>page</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:page</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='comment'># Can end up here with XML. And it causes pain.
</span>    <span class='ivar'>@batches</span> <span class='op'>=</span> <span class='const'>Batch</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>id:</span> <span class='symbol'>:asc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_page'>page</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:page</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_limit'>limit</span><span class='lparen'>(</span><span class='int'>10</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
    <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_html'>html</span>
    <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_xml'>xml</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_render'>render</span> <span class='label'>xml:</span> <span class='ivar'>@batches</span><span class='period'>.</span><span class='id identifier rubyid_to_xml'>to_xml</span> <span class='rbrace'>}</span>
    <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_json'>json</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_render'>render</span> <span class='label'>json:</span> <span class='ivar'>@batches</span><span class='period'>.</span><span class='id identifier rubyid_to_json'>to_json</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>null</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\&quot;\&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="new_stock_assets-instance_method">
  
    #<strong>new_stock_assets</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 550</span>

<span class='kw'>def</span> <span class='id identifier rubyid_new_stock_assets'>new_stock_assets</span>
  <span class='ivar'>@batch</span> <span class='op'>=</span> <span class='const'>Batch</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='kw'>unless</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_requests'>requests</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='ivar'>@batch_assets</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='kw'>unless</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_multiplexed?'>multiplexed?</span>
      <span class='ivar'>@batch_assets</span> <span class='op'>=</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_requests'>requests</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:target_asset</span><span class='rparen'>)</span>
      <span class='ivar'>@batch_assets</span><span class='period'>.</span><span class='id identifier rubyid_delete_if'>delete_if</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_a'>a</span><span class='op'>|</span> <span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_has_stock_asset?'>has_stock_asset?</span> <span class='rbrace'>}</span>
      <span class='kw'>if</span> <span class='ivar'>@batch_assets</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
        <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:error</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Stock tubes already exist for everything.</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_batch_path'>batch_path</span><span class='lparen'>(</span><span class='ivar'>@batch</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='kw'>unless</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_requests'>requests</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_target_asset'>target_asset</span><span class='period'>.</span><span class='id identifier rubyid_children'>children</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
        <span class='id identifier rubyid_multiplexed_library'>multiplexed_library</span> <span class='op'>=</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_requests'>requests</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_target_asset'>target_asset</span><span class='period'>.</span><span class='id identifier rubyid_children'>children</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>

        <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_multiplexed_library'>multiplexed_library</span><span class='period'>.</span><span class='id identifier rubyid_has_stock_asset?'>has_stock_asset?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_multiplexed_library'>multiplexed_library</span><span class='period'>.</span><span class='id identifier rubyid_is_a_stock_asset?'>is_a_stock_asset?</span>
          <span class='ivar'>@batch_assets</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_multiplexed_library'>multiplexed_library</span><span class='rbracket'>]</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:error</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Already has a Stock tube.</span><span class='tstring_end'>&quot;</span></span>
          <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_batch_path'>batch_path</span><span class='lparen'>(</span><span class='ivar'>@batch</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:error</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>There&#39;s no multiplexed library tube available to have a stock tube.</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_batch_path'>batch_path</span><span class='lparen'>(</span><span class='ivar'>@batch</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='ivar'>@assets</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
    <span class='ivar'>@batch_assets</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_batch_asset'>batch_asset</span><span class='op'>|</span>
      <span class='ivar'>@assets</span><span class='lbracket'>[</span><span class='id identifier rubyid_batch_asset'>batch_asset</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_batch_asset'>batch_asset</span><span class='period'>.</span><span class='id identifier rubyid_new_stock_asset'>new_stock_asset</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="pacbio_sample_sheet-instance_method">
  
    #<strong>pacbio_sample_sheet</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


607
608
609
610
611
612</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 607</span>

<span class='kw'>def</span> <span class='id identifier rubyid_pacbio_sample_sheet'>pacbio_sample_sheet</span>
  <span class='id identifier rubyid_csv_string'>csv_string</span> <span class='op'>=</span> <span class='const'>PacBio</span><span class='op'>::</span><span class='const'>SampleSheet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='period'>.</span><span class='id identifier rubyid_create_csv_from_batch'>create_csv_from_batch</span><span class='lparen'>(</span><span class='ivar'>@batch</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_send_data'>send_data</span> <span class='id identifier rubyid_csv_string'>csv_string</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>text/plain</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
   <span class='label'>filename:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>batch_</span><span class='embexpr_beg'>#{</span><span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_content'>_sample_sheet.csv</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
   <span class='label'>disposition:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>attachment</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="pending-instance_method">
  
    #<strong>pending</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


191
192
193
194
195
196</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 191</span>

<span class='kw'>def</span> <span class='id identifier rubyid_pending'>pending</span>
  <span class='comment'># The params fallback here reflects an older route where pipeline got passed in as :id. It should be removed
</span>  <span class='comment'># in the near future.
</span>  <span class='ivar'>@pipeline</span> <span class='op'>=</span> <span class='const'>Pipeline</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:pipeline_id</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='ivar'>@batches</span> <span class='op'>=</span> <span class='ivar'>@pipeline</span><span class='period'>.</span><span class='id identifier rubyid_batches'>batches</span><span class='period'>.</span><span class='id identifier rubyid_pending'>pending</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>id:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_includes'>includes</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='symbol'>:user</span><span class='comma'>,</span> <span class='symbol'>:pipeline</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_page'>page</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:page</span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="pipeline-instance_method">
  
    #<strong>pipeline</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


108
109
110
111</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 108</span>

<span class='kw'>def</span> <span class='id identifier rubyid_pipeline'>pipeline</span>
  <span class='comment'># All pipline batches routes should just direct to batches#index with pipeline and state as filter parameters
</span>  <span class='ivar'>@batches</span> <span class='op'>=</span> <span class='const'>Batch</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>pipeline_id:</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:pipeline_id</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>id:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_includes'>includes</span><span class='lparen'>(</span><span class='symbol'>:user</span><span class='comma'>,</span> <span class='symbol'>:pipeline</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_page'>page</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:page</span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="previous_qc_state-instance_method">
  
    #<strong>previous_qc_state</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


503
504
505
506
507
508</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 503</span>

<span class='kw'>def</span> <span class='id identifier rubyid_previous_qc_state'>previous_qc_state</span>
  <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_qc_previous_state!'>qc_previous_state!</span><span class='lparen'>(</span><span class='id identifier rubyid_current_user'>current_user</span><span class='rparen'>)</span>
  <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>
  <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:notice</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Batch </span><span class='embexpr_beg'>#{</span><span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_content'> reset to state </span><span class='embexpr_beg'>#{</span><span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_qc_state'>qc_state</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_batch_url'>batch_url</span><span class='lparen'>(</span><span class='ivar'>@batch</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="print-instance_method">
  
    #<strong>print</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 449</span>

<span class='kw'>def</span> <span class='id identifier rubyid_print'>print</span>
  <span class='ivar'>@task</span>     <span class='op'>=</span> <span class='const'>Task</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:task_id</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:task_id</span><span class='rbracket'>]</span>
  <span class='ivar'>@workflow</span> <span class='op'>=</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_workflow'>workflow</span>
  <span class='ivar'>@pipeline</span> <span class='op'>=</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_pipeline'>pipeline</span>
  <span class='ivar'>@comments</span> <span class='op'>=</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_comments'>comments</span>

  <span class='comment'># TODO: Re-factor this.
</span>  <span class='kw'>if</span> <span class='ivar'>@pipeline</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>PulldownMultiplexLibraryPreparationPipeline</span><span class='rparen'>)</span>
    <span class='ivar'>@plate</span> <span class='op'>=</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_requests'>requests</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_asset'>asset</span><span class='period'>.</span><span class='id identifier rubyid_plate'>plate</span>
  <span class='kw'>elsif</span> <span class='ivar'>@pipeline</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>CherrypickingPipeline</span><span class='rparen'>)</span>
    <span class='ivar'>@plates</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:barcode</span><span class='rbracket'>]</span>
                <span class='lbracket'>[</span><span class='const'>Plate</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>barcode:</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:barcode</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rbracket'>]</span>
              <span class='kw'>else</span>
                <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_output_plates'>output_plates</span>
              <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_template'>template</span> <span class='op'>=</span> <span class='ivar'>@pipeline</span><span class='period'>.</span><span class='id identifier rubyid_batch_worksheet'>batch_worksheet</span>
  <span class='id identifier rubyid_render'>render</span> <span class='label'>action:</span> <span class='id identifier rubyid_template'>template</span><span class='comma'>,</span> <span class='label'>layout:</span> <span class='kw'>false</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="print_barcodes-instance_method">
  
    #<strong>print_barcodes</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 432</span>

<span class='kw'>def</span> <span class='id identifier rubyid_print_barcodes'>print_barcodes</span>
  <span class='kw'>unless</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_requests'>requests</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_print_job'>print_job</span> <span class='op'>=</span> <span class='const'>LabelPrinter</span><span class='op'>::</span><span class='const'>PrintJob</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:printer</span><span class='rbracket'>]</span><span class='comma'>,</span>
                                        <span class='const'>LabelPrinter</span><span class='op'>::</span><span class='const'>Label</span><span class='op'>::</span><span class='const'>BatchTube</span><span class='comma'>,</span>
                                        <span class='label'>stock:</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:stock</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>count:</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:count</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>printable:</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:printable</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>batch:</span> <span class='ivar'>@batch</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_print_job'>print_job</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span>
      <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:notice</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_print_job'>print_job</span><span class='period'>.</span><span class='id identifier rubyid_success'>success</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:error</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_print_job'>print_job</span><span class='period'>.</span><span class='id identifier rubyid_errors'>errors</span><span class='period'>.</span><span class='id identifier rubyid_full_messages'>full_messages</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

  <span class='kw'>else</span>
    <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:notice</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Your batch contains no requests.</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='label'>controller:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>batches</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>action:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>show</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>id:</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="print_labels-instance_method">
  
    #<strong>print_labels</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


336
337</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 336</span>

<span class='kw'>def</span> <span class='id identifier rubyid_print_labels'>print_labels</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="print_multiplex_barcodes-instance_method">
  
    #<strong>print_multiplex_barcodes</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


406
407
408
409
410
411
412
413
414
415
416
417</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 406</span>

<span class='kw'>def</span> <span class='id identifier rubyid_print_multiplex_barcodes'>print_multiplex_barcodes</span>
  <span class='id identifier rubyid_print_job'>print_job</span> <span class='op'>=</span> <span class='const'>LabelPrinter</span><span class='op'>::</span><span class='const'>PrintJob</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:printer</span><span class='rbracket'>]</span><span class='comma'>,</span>
                                      <span class='const'>LabelPrinter</span><span class='op'>::</span><span class='const'>Label</span><span class='op'>::</span><span class='const'>BatchMultiplex</span><span class='comma'>,</span>
                                      <span class='label'>count:</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:count</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>printable:</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:printable</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>batch:</span> <span class='ivar'>@batch</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_print_job'>print_job</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span>
    <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:notice</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_print_job'>print_job</span><span class='period'>.</span><span class='id identifier rubyid_success'>success</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:error</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_print_job'>print_job</span><span class='period'>.</span><span class='id identifier rubyid_errors'>errors</span><span class='period'>.</span><span class='id identifier rubyid_full_messages'>full_messages</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='label'>controller:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>batches</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>action:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>show</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>id:</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="print_multiplex_labels-instance_method">
  
    #<strong>print_multiplex_labels</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 365</span>

<span class='kw'>def</span> <span class='id identifier rubyid_print_multiplex_labels'>print_multiplex_labels</span>
  <span class='id identifier rubyid_request'>request</span> <span class='op'>=</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_requests'>requests</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
  <span class='kw'>unless</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_tag_number'>tag_number</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_target_asset'>target_asset</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_target_asset'>target_asset</span><span class='period'>.</span><span class='id identifier rubyid_children'>children</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
      <span class='comment'># We are trying to find the MX library tube or the stock MX library
</span>      <span class='comment'># tube. I&#39;ve added a filter so it doesn&#39;t pick up Lanes.
</span>      <span class='id identifier rubyid_children'>children</span> <span class='op'>=</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_target_asset'>target_asset</span><span class='period'>.</span><span class='id identifier rubyid_children'>children</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='period'>.</span><span class='id identifier rubyid_children'>children</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_a'>a</span><span class='op'>|</span> <span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Tube</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_children'>children</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
        <span class='ivar'>@asset</span> <span class='op'>=</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_target_asset'>target_asset</span><span class='period'>.</span><span class='id identifier rubyid_children'>children</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span>
      <span class='kw'>else</span>
        <span class='ivar'>@asset</span> <span class='op'>=</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_target_asset'>target_asset</span><span class='period'>.</span><span class='id identifier rubyid_children'>children</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='period'>.</span><span class='id identifier rubyid_children'>children</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:notice</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>There is no multiplexed library available.</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:error</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No tags have been assigned.</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='comment'># @assets = @batch.multiplexed_items_with_unique_library_ids
</span><span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="print_plate_barcodes-instance_method">
  
    #<strong>print_plate_barcodes</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


419
420
421
422
423
424
425
426
427
428
429
430</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 419</span>

<span class='kw'>def</span> <span class='id identifier rubyid_print_plate_barcodes'>print_plate_barcodes</span>
  <span class='id identifier rubyid_print_job'>print_job</span> <span class='op'>=</span> <span class='const'>LabelPrinter</span><span class='op'>::</span><span class='const'>PrintJob</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:printer</span><span class='rbracket'>]</span><span class='comma'>,</span>
                                         <span class='const'>LabelPrinter</span><span class='op'>::</span><span class='const'>Label</span><span class='op'>::</span><span class='const'>BatchPlate</span><span class='comma'>,</span>
                                         <span class='label'>count:</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:count</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>printable:</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:printable</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>batch:</span> <span class='ivar'>@batch</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_print_job'>print_job</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span>
    <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:notice</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_print_job'>print_job</span><span class='period'>.</span><span class='id identifier rubyid_success'>success</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:error</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_print_job'>print_job</span><span class='period'>.</span><span class='id identifier rubyid_errors'>errors</span><span class='period'>.</span><span class='id identifier rubyid_full_messages'>full_messages</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='label'>controller:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>batches</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>action:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>show</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>id:</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="print_plate_labels-instance_method">
  
    #<strong>print_plate_labels</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 343</span>

<span class='kw'>def</span> <span class='id identifier rubyid_print_plate_labels'>print_plate_labels</span>
  <span class='ivar'>@pipeline</span> <span class='op'>=</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_pipeline'>pipeline</span>
  <span class='ivar'>@output_barcodes</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>

  <span class='ivar'>@output_assets</span> <span class='op'>=</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_plate_group_barcodes'>plate_group_barcodes</span> <span class='op'>||</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>

  <span class='ivar'>@output_assets</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_parent'>parent</span><span class='comma'>,</span> <span class='id identifier rubyid_children'>children</span><span class='op'>|</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_parent'>parent</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_plate_barcode'>plate_barcode</span> <span class='op'>=</span> <span class='id identifier rubyid_parent'>parent</span><span class='period'>.</span><span class='id identifier rubyid_barcode'>barcode</span>
      <span class='kw'>unless</span> <span class='id identifier rubyid_plate_barcode'>plate_barcode</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
        <span class='ivar'>@output_barcodes</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_plate_barcode'>plate_barcode</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='ivar'>@output_barcodes</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
    <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:error</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Output plates do not have barcodes to print</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='label'>controller:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>batches</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>action:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>show</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>id:</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
  <span class='kw'>else</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="print_stock_labels-instance_method">
  
    #<strong>print_stock_labels</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


339
340
341</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 339</span>

<span class='kw'>def</span> <span class='id identifier rubyid_print_stock_labels'>print_stock_labels</span>
  <span class='ivar'>@batch</span> <span class='op'>=</span> <span class='const'>Batch</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="print_stock_multiplex_labels-instance_method">
  
    #<strong>print_stock_multiplex_labels</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 386</span>

<span class='kw'>def</span> <span class='id identifier rubyid_print_stock_multiplex_labels'>print_stock_multiplex_labels</span>
  <span class='ivar'>@batch</span> <span class='op'>=</span> <span class='const'>Batch</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_request'>request</span> <span class='op'>=</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_requests'>requests</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
  <span class='id identifier rubyid_pooled_library'>pooled_library</span> <span class='op'>=</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_target_asset'>target_asset</span><span class='period'>.</span><span class='id identifier rubyid_children'>children</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
  <span class='id identifier rubyid_stock_multiplexed_tube'>stock_multiplexed_tube</span> <span class='op'>=</span> <span class='kw'>nil</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_pooled_library'>pooled_library</span><span class='period'>.</span><span class='id identifier rubyid_is_a_stock_asset?'>is_a_stock_asset?</span>
    <span class='id identifier rubyid_stock_multiplexed_tube'>stock_multiplexed_tube</span> <span class='op'>=</span> <span class='id identifier rubyid_pooled_library'>pooled_library</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_pooled_library'>pooled_library</span><span class='period'>.</span><span class='id identifier rubyid_has_stock_asset?'>has_stock_asset?</span>
    <span class='id identifier rubyid_stock_multiplexed_tube'>stock_multiplexed_tube</span> <span class='op'>=</span> <span class='id identifier rubyid_pooled_library'>pooled_library</span><span class='period'>.</span><span class='id identifier rubyid_stock_asset'>stock_asset</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_stock_multiplexed_tube'>stock_multiplexed_tube</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:notice</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>There is no stock multiplexed library available.</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='label'>controller:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>batches</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>action:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>show</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>id:</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
  <span class='kw'>else</span>
    <span class='ivar'>@asset</span> <span class='op'>=</span> <span class='id identifier rubyid_stock_multiplexed_tube'>stock_multiplexed_tube</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="pulldown_batch_report-instance_method">
  
    #<strong>pulldown_batch_report</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


600
601
602
603
604
605</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 600</span>

<span class='kw'>def</span> <span class='id identifier rubyid_pulldown_batch_report'>pulldown_batch_report</span>
  <span class='id identifier rubyid_csv_string'>csv_string</span> <span class='op'>=</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_pulldown_batch_report'>pulldown_batch_report</span>
  <span class='id identifier rubyid_send_data'>send_data</span> <span class='id identifier rubyid_csv_string'>csv_string</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>text/plain</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
   <span class='label'>filename:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>batch_</span><span class='embexpr_beg'>#{</span><span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_content'>_report.csv</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
   <span class='label'>disposition:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>attachment</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="qc_batch-instance_method">
  
    #<strong>qc_batch</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Deals with QC failures leaving batches and items statuses intact</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 168</span>

<span class='kw'>def</span> <span class='id identifier rubyid_qc_batch'>qc_batch</span>
  <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_qc_complete'>qc_complete</span>

  <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_batch_requests'>batch_requests</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_br'>br</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_br'>br</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='lparen'>(</span><span class='id identifier rubyid_br'>br</span><span class='period'>.</span><span class='id identifier rubyid_request_id'>request_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_qc_state'>qc_state</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='lparen'>(</span><span class='id identifier rubyid_br'>br</span><span class='period'>.</span><span class='id identifier rubyid_request_id'>request_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>qc_state</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_target'>target</span> <span class='op'>=</span> <span class='id identifier rubyid_br'>br</span><span class='period'>.</span><span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_target_asset'>target_asset</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_qc_state'>qc_state</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>fail</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_target'>target</span><span class='period'>.</span><span class='id identifier rubyid_set_qc_state'>set_qc_state</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>failed</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='const'>EventSender</span><span class='period'>.</span><span class='id identifier rubyid_send_fail_event'>send_fail_event</span><span class='lparen'>(</span><span class='id identifier rubyid_br'>br</span><span class='period'>.</span><span class='id identifier rubyid_request_id'>request_id</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed manual QC</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
      <span class='kw'>elsif</span> <span class='id identifier rubyid_qc_state'>qc_state</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pass</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_target'>target</span><span class='period'>.</span><span class='id identifier rubyid_set_qc_state'>set_qc_state</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>passed</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='const'>EventSender</span><span class='period'>.</span><span class='id identifier rubyid_send_pass_event'>send_pass_event</span><span class='lparen'>(</span><span class='id identifier rubyid_br'>br</span><span class='period'>.</span><span class='id identifier rubyid_request_id'>request_id</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Passed manual QC</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_target'>target</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_release_without_user!'>release_without_user!</span>

  <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='label'>controller:</span> <span class='symbol'>:pipelines</span><span class='comma'>,</span> <span class='label'>action:</span> <span class='symbol'>:show</span><span class='comma'>,</span> <span class='label'>id:</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_qc_pipeline_id'>qc_pipeline_id</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="qc_information-instance_method">
  
    #<strong>qc_information</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


157
158
159
160
161
162
163
164
165</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 157</span>

<span class='kw'>def</span> <span class='id identifier rubyid_qc_information'>qc_information</span>
  <span class='id identifier rubyid_respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
    <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_html'>html</span>
    <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_json'>json</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_b'>b</span> <span class='op'>=</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_formatted_batch_qc_details'>formatted_batch_qc_details</span>
      <span class='id identifier rubyid_render'>render</span> <span class='label'>json:</span> <span class='id identifier rubyid_b'>b</span><span class='period'>.</span><span class='id identifier rubyid_to_json'>to_json</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>null</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\&quot;\&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="quality_control-instance_method">
  
    #<strong>quality_control</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


239
240
241
242
243
244
245
246
247
248
249</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 239</span>

<span class='kw'>def</span> <span class='id identifier rubyid_quality_control'>quality_control</span>
  <span class='ivar'>@qc_pipeline</span> <span class='op'>=</span> <span class='const'>Pipeline</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_conditions_query'>conditions_query</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>state</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_conditions_query'>conditions_query</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>state = ? AND qc_state = ? AND qc_pipeline_id = ? AND pipeline_id in (?)</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>state</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>qc_state</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='ivar'>@qc_pipeline</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='ivar'>@qc_pipeline</span><span class='period'>.</span><span class='id identifier rubyid_cluster_formation_pipeline_id'>cluster_formation_pipeline_id</span><span class='rbracket'>]</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_conditions_query'>conditions_query</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>qc_state = ? AND qc_pipeline_id = ? AND pipeline_id in (?)</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>qc_state</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='ivar'>@qc_pipeline</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='ivar'>@qc_pipeline</span><span class='period'>.</span><span class='id identifier rubyid_cluster_formation_pipeline_id'>cluster_formation_pipeline_id</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='ivar'>@batches</span> <span class='op'>=</span> <span class='const'>Batch</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='id identifier rubyid_conditions_query'>conditions_query</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_includes'>includes</span><span class='lparen'>(</span><span class='symbol'>:user</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>created_at ASC</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="released-instance_method">
  
    #<strong>released</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


205
206
207
208
209
210
211
212
213
214
215</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 205</span>

<span class='kw'>def</span> <span class='id identifier rubyid_released'>released</span>
  <span class='comment'># The params fallback here reflects an older route where pipeline got passed in as :id. It should be removed
</span>  <span class='comment'># in the near future.
</span>  <span class='ivar'>@pipeline</span> <span class='op'>=</span> <span class='const'>Pipeline</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:pipeline_id</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>

  <span class='ivar'>@batches</span> <span class='op'>=</span> <span class='ivar'>@pipeline</span><span class='period'>.</span><span class='id identifier rubyid_batches'>batches</span><span class='period'>.</span><span class='id identifier rubyid_released'>released</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>id:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_includes'>includes</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='symbol'>:user</span><span class='comma'>,</span> <span class='symbol'>:pipeline</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_page'>page</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:page</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
    <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_html'>html</span>
    <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_xml'>xml</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_render'>render</span> <span class='label'>layout:</span> <span class='kw'>false</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="reset_batch-instance_method">
  
    #<strong>reset_batch</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


496
497
498
499
500
501</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 496</span>

<span class='kw'>def</span> <span class='id identifier rubyid_reset_batch'>reset_batch</span>
  <span class='id identifier rubyid_pipeline'>pipeline</span> <span class='op'>=</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_pipeline'>pipeline</span>
  <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_reset!'>reset!</span><span class='lparen'>(</span><span class='id identifier rubyid_current_user'>current_user</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:notice</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Batch </span><span class='embexpr_beg'>#{</span><span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_content'> has been reset</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='label'>controller:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pipelines</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>action:</span> <span class='symbol'>:show</span><span class='comma'>,</span> <span class='label'>id:</span> <span class='id identifier rubyid_pipeline'>pipeline</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="sample_prep_worksheet-instance_method">
  
    #<strong>sample_prep_worksheet</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


614
615
616
617
618
619</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 614</span>

<span class='kw'>def</span> <span class='id identifier rubyid_sample_prep_worksheet'>sample_prep_worksheet</span>
  <span class='id identifier rubyid_csv_string'>csv_string</span> <span class='op'>=</span> <span class='const'>PacBio</span><span class='op'>::</span><span class='const'>Worksheet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='period'>.</span><span class='id identifier rubyid_create_csv_from_batch'>create_csv_from_batch</span><span class='lparen'>(</span><span class='ivar'>@batch</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_send_data'>send_data</span> <span class='id identifier rubyid_csv_string'>csv_string</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>text/plain</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
   <span class='label'>filename:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>batch_</span><span class='embexpr_beg'>#{</span><span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_content'>_worksheet.csv</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
   <span class='label'>disposition:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>attachment</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="save-instance_method">
  
    #<strong>save</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


292
293
294</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 292</span>

<span class='kw'>def</span> <span class='id identifier rubyid_save'>save</span>
  <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='label'>action:</span> <span class='symbol'>:show</span><span class='comma'>,</span> <span class='label'>id:</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="show-instance_method">
  
    #<strong>show</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 33</span>

<span class='kw'>def</span> <span class='id identifier rubyid_show'>show</span>
  <span class='ivar'>@submenu_presenter</span> <span class='op'>=</span> <span class='const'>Presenters</span><span class='op'>::</span><span class='const'>BatchSubmenuPresenter</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_current_user'>current_user</span><span class='comma'>,</span> <span class='ivar'>@batch</span><span class='rparen'>)</span>

  <span class='ivar'>@pipeline</span> <span class='op'>=</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_pipeline'>pipeline</span>
  <span class='ivar'>@tasks</span>    <span class='op'>=</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_tasks'>tasks</span><span class='period'>.</span><span class='id identifier rubyid_sort_by'>sort_by</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:sorted</span><span class='rparen'>)</span>
  <span class='ivar'>@rits</span> <span class='op'>=</span> <span class='ivar'>@pipeline</span><span class='period'>.</span><span class='id identifier rubyid_request_information_types'>request_information_types</span>
  <span class='ivar'>@input_assets</span><span class='comma'>,</span> <span class='ivar'>@output_assets</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>

  <span class='kw'>if</span> <span class='ivar'>@pipeline</span><span class='period'>.</span><span class='id identifier rubyid_group_by_parent'>group_by_parent</span>
    <span class='ivar'>@input_assets</span> <span class='op'>=</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_input_group'>input_group</span>
    <span class='ivar'>@output_assets</span> <span class='op'>=</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_output_group_by_holder'>output_group_by_holder</span> <span class='kw'>unless</span> <span class='ivar'>@pipeline</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>PulldownMultiplexLibraryPreparationPipeline</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
    <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_html'>html</span>
    <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_xml'>xml</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_cache_xml_response'>cache_xml_response</span><span class='lparen'>(</span><span class='ivar'>@batch</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="sort-instance_method">
  
    #<strong>sort</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


287
288
289
290</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 287</span>

<span class='kw'>def</span> <span class='id identifier rubyid_sort'>sort</span>
  <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_assign_positions_to_requests!'>assign_positions_to_requests!</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>requests_list</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:to_i</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_render'>render</span> <span class='label'>nothing:</span> <span class='kw'>true</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="start_automatic_qc-instance_method">
  
    #<strong>start_automatic_qc</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Used by Quality Control Pipeline view or remote sources to add a Batch ID
to QC queue</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 114</span>

<span class='kw'>def</span> <span class='id identifier rubyid_start_automatic_qc'>start_automatic_qc</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_post?'>post?</span>
    <span class='ivar'>@batch</span> <span class='op'>=</span> <span class='const'>Batch</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_submitted'>submitted</span> <span class='op'>=</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_submit_to_qc_queue'>submit_to_qc_queue</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_submitted'>submitted</span>
      <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_lab_events'>lab_events</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='label'>description:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Submitted to QC</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>message:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Batch </span><span class='embexpr_beg'>#{</span><span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_content'> was submitted to QC queue</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>user_id:</span> <span class='ivar'>@current_user</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
        <span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Batch </span><span class='embexpr_beg'>#{</span><span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_content'> was submitted to QC queue</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_html'>html</span> <span class='kw'>do</span>
          <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:info</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_message'>message</span>
          <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_env'>env</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>HTTP_REFERER</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>javascript:history.back()</span><span class='tstring_end'>&#39;</span></span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_xml'>xml</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_render'>render</span> <span class='label'>text:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>status:</span> <span class='symbol'>:success</span> <span class='rbrace'>}</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
        <span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Batch </span><span class='embexpr_beg'>#{</span><span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_content'> was not submitted to QC queue!</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_html'>html</span> <span class='kw'>do</span>
          <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:warning</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_message'>message</span>
          <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_env'>env</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>HTTP_REFERER</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>javascript:history.back()</span><span class='tstring_end'>&#39;</span></span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_xml'>xml</span> <span class='kw'>do</span>
          <span class='id identifier rubyid_render'>render</span> <span class='label'>xml:</span> <span class='lbrace'>{</span> <span class='label'>error:</span> <span class='id identifier rubyid_message'>message</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_to_xml'>to_xml</span><span class='lparen'>(</span><span class='label'>root:</span> <span class='symbol'>:errors</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='label'>status:</span> <span class='symbol'>:bad_request</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
      <span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>There was a problem with the request. HTTP POST method was not used.</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_html'>html</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:error</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_message'>message</span>
        <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_env'>env</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>HTTP_REFERER</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>javascript:history.back()</span><span class='tstring_end'>&#39;</span></span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_xml'>xml</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_errors'>errors</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='label'>error:</span> <span class='id identifier rubyid_message'>message</span> <span class='rbrace'>}</span>
        <span class='id identifier rubyid_render'>render</span> <span class='label'>xml:</span> <span class='id identifier rubyid_errors'>errors</span><span class='period'>.</span><span class='id identifier rubyid_to_xml'>to_xml</span><span class='lparen'>(</span><span class='label'>root:</span> <span class='symbol'>:errors</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='label'>status:</span> <span class='symbol'>:method_not_allowed</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="started-instance_method">
  
    #<strong>started</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


198
199
200
201
202
203</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 198</span>

<span class='kw'>def</span> <span class='id identifier rubyid_started'>started</span>
  <span class='comment'># The params fallback here reflects an older route where pipeline got passed in as :id. It should be removed
</span>  <span class='comment'># in the near future.
</span>  <span class='ivar'>@pipeline</span> <span class='op'>=</span> <span class='const'>Pipeline</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:pipeline_id</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='ivar'>@batches</span> <span class='op'>=</span> <span class='ivar'>@pipeline</span><span class='period'>.</span><span class='id identifier rubyid_batches'>batches</span><span class='period'>.</span><span class='id identifier rubyid_started'>started</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>id:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_includes'>includes</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='symbol'>:user</span><span class='comma'>,</span> <span class='symbol'>:pipeline</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_page'>page</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:page</span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="swap-instance_method">
  
    #<strong>swap</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


513
514
515
516
517
518
519
520
521
522
523</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 513</span>

<span class='kw'>def</span> <span class='id identifier rubyid_swap'>swap</span>
  <span class='kw'>if</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_swap'>swap</span><span class='lparen'>(</span><span class='id identifier rubyid_current_user'>current_user</span><span class='comma'>,</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>batch_1</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>batch</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>lane</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>batch</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>position</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='rbrace'>}</span><span class='comma'>,</span>
                  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>batch_2</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>batch</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>2</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>lane</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>batch</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>position</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>2</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
                <span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:notice</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Successfully swapped lane positions</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_batch_path'>batch_path</span><span class='lparen'>(</span><span class='ivar'>@batch</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:error</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_errors'>errors</span><span class='period'>.</span><span class='id identifier rubyid_full_messages'>full_messages</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;br /&gt;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='label'>action:</span> <span class='symbol'>:filtered</span><span class='comma'>,</span> <span class='label'>id:</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update-instance_method">
  
    #<strong>update</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 59</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update'>update</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_batch_parameters'>batch_parameters</span><span class='lbracket'>[</span><span class='symbol'>:assignee_id</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_user'>user</span> <span class='op'>=</span> <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_batch_parameters'>batch_parameters</span><span class='lbracket'>[</span><span class='symbol'>:assignee_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_assigned_message'>assigned_message</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Assigned to </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_login'>login</span><span class='embexpr_end'>}</span><span class='tstring_content'>).</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_assigned_message'>assigned_message</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_batch_parameters'>batch_parameters</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:notice</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Batch was successfully updated. </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_assigned_message'>assigned_message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_html'>html</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_batch_url'>batch_url</span><span class='lparen'>(</span><span class='ivar'>@batch</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
      <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_xml'>xml</span>  <span class='lbrace'>{</span> <span class='id identifier rubyid_head'>head</span> <span class='symbol'>:ok</span> <span class='rbrace'>}</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_html'>html</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_render'>render</span> <span class='label'>action:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>edit</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
      <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_xml'>xml</span>  <span class='lbrace'>{</span> <span class='id identifier rubyid_render'>render</span> <span class='label'>xml:</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_errors'>errors</span><span class='period'>.</span><span class='id identifier rubyid_to_xml'>to_xml</span> <span class='rbrace'>}</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_volume_and_concentration-instance_method">
  
    #<strong>update_volume_and_concentration</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


587
588
589
590
591
592
593
594
595
596
597
598</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 587</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update_volume_and_concentration'>update_volume_and_concentration</span>
  <span class='ivar'>@batch</span> <span class='op'>=</span> <span class='const'>Batch</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:batch_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:assets</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_values'>values</span><span class='op'>|</span>
    <span class='id identifier rubyid_asset'>asset</span> <span class='op'>=</span> <span class='const'>Asset</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_asset'>asset</span><span class='period'>.</span><span class='id identifier rubyid_volume'>volume</span> <span class='op'>=</span> <span class='id identifier rubyid_values'>values</span><span class='lbracket'>[</span><span class='symbol'>:volume</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_asset'>asset</span><span class='period'>.</span><span class='id identifier rubyid_concentration'>concentration</span> <span class='op'>=</span> <span class='id identifier rubyid_values'>values</span><span class='lbracket'>[</span><span class='symbol'>:concentration</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_asset'>asset</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_batch_path'>batch_path</span><span class='lparen'>(</span><span class='ivar'>@batch</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="verify-instance_method">
  
    #<strong>verify</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


470
471
472
473
474</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 470</span>

<span class='kw'>def</span> <span class='id identifier rubyid_verify'>verify</span>
  <span class='ivar'>@requests</span> <span class='op'>=</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_ordered_requests'>ordered_requests</span>
  <span class='ivar'>@pipeline</span> <span class='op'>=</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_pipeline'>pipeline</span>
  <span class='ivar'>@count</span> <span class='op'>=</span> <span class='int'>8</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="verify_tube_layout-instance_method">
  
    #<strong>verify_tube_layout</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/batches_controller.rb', line 476</span>

<span class='kw'>def</span> <span class='id identifier rubyid_verify_tube_layout'>verify_tube_layout</span>
  <span class='id identifier rubyid_tube_barcodes'>tube_barcodes</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>unless</span> <span class='id identifier rubyid_params'>params</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='int'>8</span><span class='period'>.</span><span class='id identifier rubyid_times'>times</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>barcode_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_i'>i</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_tube_barcodes'>tube_barcodes</span><span class='lbracket'>[</span><span class='lparen'>(</span><span class='id identifier rubyid_i'>i</span> <span class='op'>+</span> <span class='int'>1</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>Barcode</span><span class='period'>.</span><span class='id identifier rubyid_split_barcode'>split_barcode</span><span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>barcode_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_i'>i</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_verify_tube_layout'>verify_tube_layout</span><span class='lparen'>(</span><span class='id identifier rubyid_tube_barcodes'>tube_barcodes</span><span class='comma'>,</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_results'>results</span>
    <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:notice</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>All of the tubes are in their correct positions.</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_batch_path'>batch_path</span><span class='lparen'>(</span><span class='ivar'>@batch</span><span class='rparen'>)</span>
  <span class='kw'>elsif</span> <span class='op'>!</span><span class='id identifier rubyid_results'>results</span>
    <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:error</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_errors'>errors</span><span class='period'>.</span><span class='id identifier rubyid_full_messages'>full_messages</span><span class='period'>.</span><span class='id identifier rubyid_sort'>sort</span>
    <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='label'>action:</span> <span class='symbol'>:verify</span><span class='comma'>,</span> <span class='label'>id:</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Mon Dec 19 11:17:14 2016 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.5 (ruby-2.3.3).
</div>

    </div>
  </body>
</html>